(()=>{var e,t={72203:(e,t,s)=>{"use strict";var i=s(88478),n=(s(38795),s(96064));class o{constructor(){this.DBKeypoints=[["nose_x","nose_y","left_eye_x","left_eye_y","right_eye_x","right_eye_y","left_ear_x","left_ear_y","right_ear_x","right_ear_y","left_shoulder_x","left_shoulder_y","right_shoulder_x","right_shoulder_y","left_elbow_x","left_elbow_y","right_elbow_x","right_elbow_y","left_wrist_x","left_wrist_y","right_wrist_x","right_wrist_y","left_hip_x","left_hip_y","right_hip_x","right_hip_y","left_knee_x","left_knee_y","right_knee_x","right_knee_y","left_ankle_x","left_ankle_y","right_ankle_x","right_ankle_y"]]}addKeypoints=e=>{this.DBKeypoints.push(e)};saveToCSV=()=>{const e=this.DBKeypoints.map((e=>e.join(","))).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=new File([t],"datasetX.csv",{type:"text/csv"});console.log(s),this.uploadFile(s);const i=encodeURI(`data:text/csv;charset=utf-8,${e}`),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download","datasetX.csv"),document.body.appendChild(n),n.click(),this.DBKeypoints=[this.DBKeypoints[0]],document.body.removeChild(n)};uploadFile=async e=>{const t=new FormData;t.append("file",e,e.name);try{const e=await fetch("http://18.190.173.191:3000/upload",{method:"POST",body:t});if(e.ok)alert("File uploaded successfully");else{const t=await e.text();alert("File upload failed: "+t)}}catch(e){console.error("There was an error uploading the file:",e)}}}var a=s(93202);class r{constructor(){this.model=null,this.label=[],this.stdConfig=null}setup=async(e,t)=>{this.label=e.label,this.stdConfig=t,this.model=await(0,a.FB)(e.path)};standarization=e=>e.map(((e,t)=>t%2==0?e/this.stdConfig.width:e/this.stdConfig.height));predict=async e=>{if(!this.model&&!this.stdConfig)return null;const t=(0,i.XeE)([this.standarization(e)]),s=await this.model.predict(t).data();return Array.from(s).map(((e,t)=>({class:this.label[t],confidence:e})))}}class l{constructor(e){this.src=e.src,this.audioCtx=null,this.audioBuffer=null,this.isLoaded=!1}setup=async()=>{const e=window.AudioContext||window.webkitAudioContext;this.audioCtx=new e,this.audioBuffer=await this.getFile()};getFile=async()=>{const e=await fetch(this.src);if(!e.ok)throw new Error(`HTTP error${e.status}`);const t=await e.arrayBuffer(),s=await this.audioCtx.decodeAudioData(t);return this.isLoaded=!0,s};play=()=>{if(this.audioCtx&&this.audioBuffer){const e=this.audioCtx.createBufferSource();e.buffer=this.audioBuffer,e.connect(this.audioCtx.destination),e.start()}}}class c{constructor(e){this.count=0,this.rules=null,this.ctxPose=e,this.lastStage={},this.nextStage={},this.currStage={},this.sumObsPoints=0,this.obsStages=[],this.listAngles=[],this.isNewAssetsImgStages=!1,this.isPlayAudStage=!0,this.listAudStages={},this.audCount=new l({src:"./audio/count-from-pixabay.webm"}),this.audCount.setup()}initStage=()=>{this.currStage={},this.obsStages=[],this.sumObsPoints=0,this.rules.nameStage.forEach(((e,t)=>{this.obsStages.push({idStage:t,nameStage:e,sum:0,detail:{}})})),this.obsStages.push({idStage:-1,nameStage:"None",sum:0,detail:{}})};setup=e=>{this.rules=e,this.isNewAssetsImgStages=!0,this.initStage(),this.rules.nameStage.forEach(((e,t)=>{this.listAudStages[e]=new l({src:this.rules.pathAudioStage[t]}),this.listAudStages[e].setup()}))};resetCount=()=>{this.count=0};determineCurrStage=()=>{if(0!==this.obsStages.length){const e=[...this.obsStages].sort(((e,t)=>t.sum-e.sum)),t=e[0].sum===this.sumObsPoints?"FULL":"PARTIAL";if(this.currStage={statusStage:t,idStage:e[0].idStage,nameStage:e[0].nameStage},"FULL"===t&&this.currStage.nameStage!==this.lastStage.nameStage&&this.currStage.idStage===this.rules.nameStage.length-1&&(this.count+=1,this.isPlayAudStage&&this.audCount.isLoaded&&this.audCount.play()),"FULL"===t&&"None"!==e[0].nameStage&&(0===Object.keys(this.lastStage).length||this.lastStage.nameStage!==e[0].nameStage)){this.lastStage={idStage:e[0].idStage,nameStage:e[0].nameStage};const t=this.lastStage.idStage+1!==this.rules.nameStage.length?this.lastStage.idStage+1:0;this.nextStage={idStage:t,nameStage:this.rules.nameStage[t]}}}};getAdvice=()=>{if(0===Object.keys(this.nextStage).length)return"";let e="",t=1;const s=this.obsStages[this.nextStage.idStage].detail;return this.obsStages.forEach((i=>{i.nameStage!==this.nextStage.nameStage&&Object.keys(i.detail).forEach((n=>{if(n in s)return;1===t&&(e+=`<p>To move ${this.nextStage.nameStage} :</p>`);const{rangeAngle:o}=this.rules.anglePoint[n];e+=`<p>${t}) Angle <b>${i.detail[n].name.split("_").map((e=>e.charAt(0).toUpperCase()+e.substr(1))).join(" ")}</b> (${i.detail[n].angle}째) must between ${o[this.nextStage.idStage].min}째 and ${o[this.nextStage.idStage].max}째</p>`,t+=1}))})),e};detectAnglesAndStages=(e,t)=>{this.rules&&this.ctxPose&&t===this.rules.nameWorkout&&(e.forEach(((t,s)=>{if(!(s in this.rules.anglePoint))return;const{spouseIdx:i,rangeAngle:n}=this.rules.anglePoint[s],o=e[i[0]],a=e[i[1]];let r=Math.atan2(o.y-t.y,o.x-t.x),l=Math.atan2(a.y-t.y,a.x-t.x),c=parseInt((l-r)/Math.PI*180+360,10)%360;this.ctxPose.moveTo(t.x,t.y),c>180&&(c=360-c,[r,l]=[l,r]),this.ctxPose.arc(t.x,t.y,20,r,l),this.ctxPose.fill(),this.listAngles.push([c,t.x+5,t.y]),this.sumObsPoints+=1;let d=!0;n.forEach(((t,i)=>{c>=t.min&&c<=t.max&&(this.obsStages[i].sum+=1,this.obsStages[i].detail[s]={name:e[s].name,angle:c},d=!1)})),d&&(this.obsStages[this.obsStages.length-1].sum+=1,this.obsStages[this.obsStages.length-1].detail[s]={name:e[s].name,angle:c})})),this.determineCurrStage())}}class d{constructor(e,t="user"){this._webcamElement=e,this._addVideoConfig={},this._facingMode=t,this._webcamList=[],this._streamList=[],this._selectedDeviceId=""}get facingMode(){return this._facingMode}set facingMode(e){this._facingMode=e}get webcamList(){return this._webcamList}get webcamCount(){return this._webcamList.length}get selectedDeviceId(){return this._selectedDeviceId}getVideoInputs(e){return this._webcamList=[],e.forEach((e=>{"videoinput"===e.kind&&this._webcamList.push(e)})),1===this._webcamList.length&&(this._facingMode="user"),this._webcamList}getMediaConstraints(){let e={};return""===this._selectedDeviceId?e.facingMode=this._facingMode:e.deviceId={exact:this._selectedDeviceId},e={...e,...this._addVideoConfig},{video:e,audio:!1}}selectCamera(){for(const e of this._webcamList)if("user"===this._facingMode&&e.label.toLowerCase().includes("front")||"environment"===this._facingMode&&e.label.toLowerCase().includes("back")){this._selectedDeviceId=e.deviceId;break}}flip(e){this._facingMode=e,"user"===this._facingMode?this._webcamElement.style.transform="scale(-1,1)":this._webcamElement.style.transform="",this.selectCamera()}async start(e=!0){return new Promise(((t,s)=>{this.stop(),navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then((i=>{this._streamList.push(i),this.info().then((()=>{this.selectCamera(),e?this.stream().then((()=>{t(this._facingMode)})).catch((e=>{s(e)})):t(this._selectedDeviceId)})).catch((e=>{s(e)}))})).catch((e=>{s(e)}))}))}async info(){return new Promise(((e,t)=>{navigator.mediaDevices.enumerateDevices().then((t=>{this.getVideoInputs(t),e(this._webcamList)})).catch((e=>{t(e)}))}))}async stream(){return new Promise(((e,t)=>{navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then((t=>{this._streamList.push(t),this._webcamElement.srcObject=t,"user"===this._facingMode&&(this._webcamElement.style.transform="scale(-1,1)"),this._webcamElement.play(),e(this._facingMode)})).catch((e=>{console.log(e),t(e)}))}))}stop(){this._streamList.forEach((e=>{e.getTracks().forEach((e=>{e.stop()}))}))}}class h{constructor(e,t){this.DBHandler=new o,this.isExtractKeypoints=!1,this.camHandler=new d(e),this.isVideoMode=!1,this.scaler=null,this.classifier=new r,this.isClassify=!0,this.currClass="",this.frameClassify=6,this.frame=0,this.fps=0,this.times=[],this.isLoop=!1,this.additionalElem={},this.webcamElem=e,this.cnvPoseElem=t,this.ctxPose=this.cnvPoseElem.getContext?this.cnvPoseElem.getContext("2d"):null,this.nameModel="",this.model=null,this.detector=null,this.detectorConfig={},this.estimationConfig={},this.tresholdPoints=.3,this.lines={0:[[0,1],[0,2]],1:[[1,3]],2:[[2,4]],3:[],4:[],5:[[5,7],[5,6],[5,11]],6:[[6,8],[6,12]],7:[[7,9]],8:[[8,10]],9:[],10:[],11:[[11,12],[11,13]],12:[[12,14]],13:[[13,15]],14:[[14,16]],15:[],16:[]},this.counter=new c(this.ctxPose),this.isShowAdvice=!1,this.isShowDirectionSign=!0,this.tmpStage=""}setup=async e=>{this.estimationConfig=e.estimationConfig,this.nameModel===e.model&&JSON.stringify(this.detectorConfig)===JSON.stringify(e.detectorConfig)||(this.nameModel=e.model,this.model=n.oV[this.nameModel],this.detectorConfig=e.detectorConfig,this.detector=await n.cH(this.model,this.detectorConfig))};getPose=async()=>this.detector.estimatePoses(this.webcamElem,this.estimationConfig);drawSkeleton=e=>{if(!this.ctxPose)return null;this.ctxPose.clearRect(0,0,this.cnvPoseElem.width,this.cnvPoseElem.height),this.ctxPose.save(),this.ctxPose.beginPath(),"user"===this.camHandler._facingMode&&(this.ctxPose.translate(this.cnvPoseElem.width,0),this.ctxPose.scale(-1,1)),this.scaler&&this.ctxPose.scale(this.scaler.w,this.scaler.h),this.ctxPose.fillStyle="#eab308",this.counter.initStage(),this.counter.detectAnglesAndStages(e,this.currClass),this.ctxPose.stroke(),this.ctxPose.fill(),this.ctxPose.beginPath(),this.ctxPose.fillStyle="rgba(45,253,255,255)",this.ctxPose.strokeStyle="black";const t=[];return e.forEach(((s,i)=>{t.push(s.x,s.y),s.score>this.tresholdPoints&&(this.ctxPose.moveTo(s.x,s.y),this.ctxPose.arc(s.x,s.y,5,0,2*Math.PI),this.lines[i].forEach((t=>{e[t[1]].score>this.tresholdPoints&&(this.ctxPose.moveTo(s.x,s.y),this.ctxPose.lineTo(e[t[1]].x,e[t[1]].y))})))})),this.isExtractKeypoints&&this.DBHandler.addKeypoints(t),this.ctxPose.stroke(),this.ctxPose.fill(),this.ctxPose.strokeStyle="white",this.counter.listAngles.forEach((e=>{this.ctxPose.strokeText(`${e[0]}째`,e[1],e[2])})),this.counter.listAngles=[],this.ctxPose.restore(),t};drawPose=()=>{this.getPose().then((e=>{if(e&&0!==e.length){const t=this.drawSkeleton(e[0].keypoints);t&&this.isClassify&&this.additionalElem.confidenceElem&&this.frame%this.frameClassify==0&&this.classifier.predict(t).then((e=>{this.currClass=e[0].confidence>e[1].confidence?e[0].class:e[1].class,this.additionalElem.confidenceElem.style.clipPath=`inset(${100*(1-e[1].confidence.toFixed(6))}% 0 0 0)`}))}if(this.isClassify){if(this.additionalElem.countElem&&(this.additionalElem.countElem.innerText=this.counter.count),this.isShowDirectionSign&&this.additionalElem.imgDirectionSignElem&&0!==Object.keys(this.counter.nextStage).length&&this.tmpStage!==this.counter.nextStage.nameStage){if(this.tmpStage=this.counter.nextStage.nameStage,this.counter.isNewAssetsImgStages){this.counter.isNewAssetsImgStages=!1;let e="";this.counter.rules.pathImageStage.forEach((t=>{e+=`<img\n                class="animate-bounce"\n                style="width: 56px; display: none"\n                src="${t}"\n                alt="Direction Sign"\n              />`})),this.additionalElem.imgDirectionSignElem.innerHTML=e}this.additionalElem.imgDirectionSignElem.style.display=this.counter.nextStage.nameStage?"block":"none",this.additionalElem.imgDirectionSignElem.children[this.counter.lastStage.idStage].style.display="none",this.additionalElem.imgDirectionSignElem.children[this.counter.nextStage.idStage].style.display="block",this.counter.isPlayAudStage&&this.counter.listAudStages[this.counter.nextStage.nameStage].isLoaded&&this.counter.listAudStages[this.counter.nextStage.nameStage].play()}if(this.isShowAdvice&&this.additionalElem.adviceWrapElem){const e=this.counter.getAdvice();this.additionalElem.adviceWrapElem.style.display=e?"flex":"none",this.additionalElem.adviceWrapElem.children[0].innerText="Advice each frame",this.additionalElem.adviceWrapElem.children[1].innerHTML=e}}if(this.isLoop&&window.requestAnimationFrame(this.drawPose),this.additionalElem.fpsElem){const e=performance.now();for(;this.times.length>0&&this.times[0]<=e-1e3;)this.times.shift();this.times.push(e),this.fps=this.times.length-1,this.frame+=1,this.fps<15?this.frameClassify=Math.ceil(this.fps/3):this.fps>=15&&this.fps<30?this.frameClassify=Math.floor(this.fps/5):this.fps>=30&&this.fps<45?this.frameClassify=Math.floor(this.fps/7):this.frameClassify=Math.floor(this.fps/10),this.additionalElem.fpsElem.innerText=`FPS: ${this.fps}`}}))}}class u{constructor(){this.currTime=0,this.targetTime=null,this.interval=1e3,this.duration=null,this.isPaused=!0,this.runner=null,this.type="INC",this.firstDelayDuration=null,this.currDelayTime=0,this.isFirstDelay=!0,this.isPlayAudTimer=!0,this.audStart=new l({src:"./audio/start-from-google-translate.webm"}),this.audDone=new l({src:"./audio/done-from-freesound.webm"}),this.listAudCounts=[new l({src:"./audio/one-from-google-translate.webm"}),new l({src:"./audio/two-from-google-translate.webm"}),new l({src:"./audio/three-from-google-translate.webm"})],this.audStart.setup(),this.audDone.setup(),this.listAudCounts.forEach((e=>{e.setup()}))}setup=e=>{this.interval=e.interval,this.duration=e.duration,this.type=e.type,this.firstDelayDuration=e.firstDelayDuration,this.reset()};reset=()=>{this.isPaused=!1,this.currDelayTime=this.firstDelayDuration,this.targetTime="INC"===this.type?this.duration:0,this.currTime="INC"===this.type?0:this.duration};start=(e,t,s,i)=>{this.reset(),null===this.runner&&null!==this.targetTime&&(this.runner=setInterval((()=>{this.isPaused||(this.isFirstDelay?(this.isPlayAudTimer&&0!==this.currDelayTime&&this.listAudCounts[this.currDelayTime-1].isLoaded&&this.listAudCounts[this.currDelayTime-1].play(),e(this.currDelayTime),0===this.currDelayTime&&(t(),this.isFirstDelay=!1,this.isPaused=!1),this.currDelayTime-=1):(this.isPlayAudTimer&&this.audStart.isLoaded&&Math.abs(this.currTime-this.targetTime)===this.duration&&this.audStart.play(),"INC"===this.type&&(this.currTime+=1),"DEC"===this.type&&(this.currTime-=1),s(this.getCurrTime()),this.currTime===this.targetTime&&(this.isPlayAudTimer&&this.audDone.isLoaded&&this.audDone.play(),i(),this.isPaused=!1,this.remove())))}),this.interval))};resume=()=>{this.isPaused&&(this.isPaused=!1)};pause=()=>{this.isPaused||(this.isPaused=!0)};remove=()=>{clearInterval(this.runner),this.runner=null};getCurrTime=()=>({minutes:Math.floor(this.currTime/60),seconds:this.currTime%60})}class m{constructor(){this.DBWOScore=[],this.isLocalStorageAvailable=null,this.keyData="DBWOScore",this.bestScore={}}setup=e=>{if(this.bestScore={},e.nameWorkout.forEach((t=>{this.bestScore[t]={},e.duration.forEach((e=>{this.bestScore[t][e]=0}))})),"undefined"==typeof localStorage)return this.isLocalStorageAvailable=!1,void alert("Warning! Local storage unavailable. Please use newest browser");this.isLocalStorageAvailable=!0;const t=localStorage.getItem(this.keyData);null!==t?this.DBWOScore=JSON.parse(t):this.saveToLocalStorage()};saveToLocalStorage=()=>{this.isLocalStorageAvailable&&localStorage.setItem(this.keyData,JSON.stringify(this.DBWOScore))};addNewData=e=>{this.DBWOScore.push({id:+new Date,nameWorkout:e.nameWorkout,duration:e.duration,repetition:e.repetition,date:(new Date).toLocaleString()}),this.saveToLocalStorage()};getBestScoreByReps=()=>0===Object.keys(this.bestScore).length?{}:(this.DBWOScore.forEach((e=>{(0===this.bestScore[e.nameWorkout][e.duration]||e.repetition>=this.bestScore[e.nameWorkout][e.duration])&&(this.bestScore[e.nameWorkout][e.duration]=e.repetition)})),this.bestScore)}class g{constructor(){this.DBWOSettings={},this.isGetPrevSettings=!1,this.isLocalStorageAvailable=null,this.keyData="DBWOSettings"}setup=(e,t)=>{if(0!==Object.keys(this.DBWOSettings).length)return;if("undefined"==typeof localStorage)return void alert("Warning! Local storage unavailable. Please use newest browser");this.isLocalStorageAvailable=!0;const s=localStorage.getItem(this.keyData);if(null!==s){const e=JSON.parse(s);"None"!==e.currWorkout&&(this.isGetPrevSettings=!0,this.change(e,t))}else this.DBWOSettings=e,this.saveToLocalStorage()};saveToLocalStorage=()=>{this.isLocalStorageAvailable&&localStorage.setItem(this.keyData,JSON.stringify(this.DBWOSettings))};getEffectChange=(e,t)=>{const s=this.DBWOSettings,i=0===Object.keys(s).length;Object.keys(t).forEach((n=>{"currWorkoutDuration"===n&&(e.currWorkout!==s.currWorkout||e.currDuration!==s.currDuration||i&&this.isGetPrevSettings)?t[n]({nameWO:{isChange:i?e.currWorkout:e.currWorkout!==s.currWorkout,value:e.currWorkout},durationWO:{isChange:i?e.currDuration:e.currDuration!==s.currDuration,value:e.currDuration}}):(i&&this.isGetPrevSettings||e[n]!==s[n])&&t[n](e[n])}))};change=(e,t={})=>{const s={...this.DBWOSettings,...e};this.getEffectChange(s,t),this.DBWOSettings=s,this.saveToLocalStorage()}}var y=s(50835),p=s(25965);let f,S;window.adapter=y.Z,p.Z&&"function"==typeof p.Z.init?(console.log("Attempting to initialize Janus..."),p.Z.init({debug:"all",callback:function(){p.Z.isWebrtcSupported()?f=new p.Z({server:"wss://wss.airehab.sbmi.uth.edu:8989",success:function(){console.log("Connected to Janus"),f.attach({plugin:"janus.plugin.videoroom",success:function(e){S=e,console.log("VideoRoom plugin attached"),S.send({message:{request:"join",room:1234,ptype:"publisher",display:"Demo User"},success:function(e){console.log("Joined the video room!")}})},error:function(e){console.error("Error attaching Video Room plugin:",e)}})},error:function(e){console.error("Janus error:",e)},destroyed:function(){console.log("Janus session destroyed")}}):console.error("No WebRTC support...")}})):console.error("Janus is not initialized or the init method is missing."),document.addEventListener("DOMContentLoaded",(async()=>{let e=document.getElementById("webcamBox");const t=document.getElementById("cnvPoseBox"),s=document.getElementById("parentWebcamBox"),i=document.getElementById("loaderBox"),n=document.getElementById("fpsBox"),o=document.getElementById("countBox"),a=document.getElementById("timerBox"),r=document.getElementById("delayBox"),l=document.getElementById("pauseBtn"),c=document.getElementById("resumeBtn"),d=document.getElementById("accessCamBtn"),y=document.getElementById("chooseWOBox"),p=(document.getElementById("formChooseWOBox"),document.getElementById("accessCamBox")),f=document.getElementById("titleWOBox"),x=document.getElementById("confidenceBox"),b=document.getElementById("resultBox"),w=document.getElementById("resultRepBox"),v=document.getElementById("resultTitleBox"),E=document.getElementById("resultOKBtn"),B=document.getElementById("uploadVideoBtn"),D=document.getElementById("goWebcamBtn"),C=document.getElementById("settingsBtn"),k=document.getElementById("settingsBox"),_=document.getElementById("saveSettingsBtn"),L=document.getElementById("cancelSettingsBtn"),P=document.getElementById("segSettingsWOBtn"),O=document.getElementById("segSettingsAdvBtn"),W=document.getElementById("bodySettingsWOBox"),T=document.getElementById("bodySettingsAdvBox"),M=document.getElementById("helpBox"),A=document.getElementById("helpBtn"),I=document.getElementById("segHowToUseBtn"),F=document.getElementById("segAboutBtn"),V=document.getElementById("bodyHowToUseBox"),$=document.getElementById("bodyAboutBox"),j=document.getElementById("helpOKBtn"),N=document.getElementById("dismissalBtn"),H=document.getElementById("dismissalBox"),q=document.getElementById("dismissalOKBtn"),J=document.getElementById("canceldismissalBtn"),K=document.getElementById("developerModeBox"),R=document.getElementById("imgDirectionSignBox"),U=document.getElementById("goAdviceBtn"),z=document.getElementById("adviceWrapBox"),Z=document.getElementById("sliderAdviceBox"),G=document.getElementById("sliderCameraBox"),X=document.getElementById("recordKeypointsBtn"),Q=document.getElementById("pingRecordBox"),Y=document.getElementById("restartBtn");let ee=!0,te=!1,se=640,ie=360;const ne=[{h:9,w:16,name:"landscape"},{h:4,w:3,name:"portrait"},{h:23,w:16,name:"young"},{h:19.5,w:9,name:"pro"},{h:3,w:4,name:"air-hor"}],oe=new h(e,t),ae=new u,re=new m,le=new g;oe.additionalElem={fpsElem:n,countElem:o,adviceWrapElem:z,confidenceElem:x,imgDirectionSignElem:R},oe.camHandler._addVideoConfig={width:se,height:ie};const ce=()=>{const e=window.innerWidth,i=window.innerHeight;let n=0,o=0;((e,t)=>{let s=1/0,i=null;for(const n of ne){const o=Math.abs(e/t-n.w/n.h);o<s&&(s=o,i=n)}})(e,i),e>i?(e/i<16/9?(n=e>1280?1280:e,o=Math.floor(n*(9/16))):(o=i>720?720:i,n=Math.floor(o*(16/9))),oe.scaler={w:n/se,h:o/ie}):(i/e<16/9?(o=i>1280?1280:i,n=Math.floor(o*(9/16))):(n=e>720?720:e,o=Math.floor(n*(16/9))),oe.scaler={w:n/ie,h:o/se}),s.setAttribute("style",`width:${n}px;height:${o}px`);for(let e=0;e<s.children.length;e+=1){const i=s.children[e];"CANVAS"===i.tagName?(t.width=n,t.height=o):(i.style.width=`${n}px`,i.style.height=`${o}px`)}};ce(),window.addEventListener("resize",(()=>{ce()}));const de=async()=>{!e.paused&&oe.isLoop||(i.style.display="flex",await oe.camHandler.start().then((()=>{le.change({isAccessCamera:!0}),i.style.display="none",p.style.display="none"})).catch((e=>{console.log("Permission Denied: Webcam Access is Not Granted"),console.error(e)})))};d.addEventListener("click",(async()=>{await de()}));const he=()=>{const e=ae.getCurrTime();a.innerHTML=`${`0${e.minutes}`.slice(-2)}:${`0${e.seconds}`.slice(-2)}`},ue=async t=>{await fetch(t).then((e=>{if(!e.ok)throw new Error(`HTTPS error${e.status}`);return e.json()})).then((async t=>{oe.counter.setup(t.rulesCountConfig);const s=`${t.rulesCountConfig.nameWorkout} - ${le.DBWOSettings.currDuration}`;!async function(e,t){const s=t.split(" ")[0],i=await fetch(`https://airehab.sbmi.uth.edu:3000/api/${e}/${s}`,{method:"POST"});if(await i.json(),200===i.status){const t=`${window.location.protocol}//${window.location.host}/main/player?nameWorkout=${e}&duration=${s}`;window.history.pushState({path:t},"",t)}}(t.rulesCountConfig.nameWorkout,le.DBWOSettings.currDuration),f.innerText=s,v.innerText=s,ae.remove(),ae.setup({interval:1e3,duration:oe.isVideoMode?Math.floor(e.duration):60*+le.DBWOSettings.currDuration.split(" ")[0],type:"DEC",firstDelayDuration:oe.isVideoMode?0:3}),ae.isFirstDelay=!oe.isVideoMode,he(),await oe.setup(t.poseDetectorConfig).then((()=>{console.log("Detector Loaded")})).catch((e=>{console.error(e)})),await oe.classifier.setup(t.classifierConfig,{width:se,height:ie}).then((async()=>{console.log("Classifier Ready to Use"),y.style.display="none",le.DBWOSettings.isAccessCamera?oe.isVideoMode||await de():(i.style.display="none",p.style.display="flex")})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))};await(async()=>{const e=window.location.href.split("/player?")[1].split("&"),t=e[0].split("=")[1],s=e[1].split("=")[1];le.DBWOSettings.currDuration=s,await ue(`./rules/${t}.json`)})(),A.addEventListener("click",(()=>{M.style.display="flex"})),j.addEventListener("click",(()=>{M.style.display="none"})),I.addEventListener("click",(()=>{"none"===V.style.display&&($.style.display="none",V.style.display="flex",F.classList.remove("bg-amber-300","text-gray-600"),F.classList.add("bg-amber-200","text-gray-400"),I.classList.remove("bg-amber-200","text-gray-400"),I.classList.add("bg-amber-300","text-gray-600"))})),F.addEventListener("click",(()=>{"none"===$.style.display&&(V.style.display="none",$.style.display="flex",I.classList.remove("bg-amber-300","text-gray-600"),I.classList.add("bg-amber-200","text-gray-400"),F.classList.remove("bg-amber-200","text-gray-400"),F.classList.add("bg-amber-300","text-gray-600"))})),Y.addEventListener("click",(()=>{i.style.display="flex",r.innerText="",ae.setup({interval:1e3,duration:oe.isVideoMode?Math.floor(e.duration):60*+le.DBWOSettings.currDuration.split(" ")[0],type:"DEC",firstDelayDuration:oe.isVideoMode?0:3}),oe.counter.resetCount(),o.innerText="0",ae.isFirstDelay=!oe.isVideoMode,oe.isVideoMode&&0!==e.currentTime&&(e.currentTime=0,e.load()),he(),ae.pause(),e.pause(),oe.isLoop=!1,ee=!0,te=!0,oe.counter.lastStage={},oe.counter.nextStage={},R.style.display="none",z.style.display="none",c.style.display="flex",Y.style.display="none",l.style.display="none",i.style.display="none"})),X.addEventListener("click",(()=>{oe.isExtractKeypoints=!oe.isExtractKeypoints,oe.isExtractKeypoints?(Q.classList.remove("bg-gray-500"),Q.classList.add("bg-red-500"),Q.children[0].style.display="block"):(Q.classList.remove("bg-red-500"),Q.classList.add("bg-gray-500"),Q.children[0].style.display="none",oe.DBHandler.saveToCSV())})),P.addEventListener("click",(()=>{"none"===W.style.display&&(T.style.display="none",W.style.display="block",O.classList.remove("bg-amber-300","text-gray-600"),O.classList.add("bg-amber-200","text-gray-400"),P.classList.remove("bg-amber-200","text-gray-400"),P.classList.add("bg-amber-300","text-gray-600"))})),O.addEventListener("click",(()=>{"none"===T.style.display&&(W.style.display="none",T.style.display="block",P.classList.remove("bg-amber-300","text-gray-600"),P.classList.add("bg-amber-200","text-gray-400"),O.classList.remove("bg-amber-200","text-gray-400"),O.classList.add("bg-amber-300","text-gray-600"))})),C.addEventListener("click",(()=>{k.style.display="flex",document.querySelector(`input[value="${le.DBWOSettings.currWorkout}"][name="settingsNameWO"]`).checked=!0,document.querySelector(`input[value="${le.DBWOSettings.currDuration}"][name="settingsDurationWO"]`).checked=!0,document.querySelector('input[name="settingsAEBox"]').checked=void 0===le.DBWOSettings.isAudioEffect||le.DBWOSettings.isAudioEffect,document.querySelector('input[name="settingsFSBox"]').checked=void 0!==le.DBWOSettings.isFullscreen&&le.DBWOSettings.isFullscreen,document.querySelector('input[name="settingsFCBox"]').checked=void 0!==le.DBWOSettings.isFlipCamera&&le.DBWOSettings.isFlipCamera,document.querySelector('input[name="settingsDSBox"]').checked=void 0===le.DBWOSettings.isDirectionSign||le.DBWOSettings.isDirectionSign,document.querySelector('input[name="settingsDMBox"]').checked=void 0!==le.DBWOSettings.isDeveloperMode&&le.DBWOSettings.isDeveloperMode}));const me={currWorkoutDuration:async t=>{if(i.style.display="flex",r.innerText="",e.pause(),oe.isLoop=!1,ee=!0,te=!0,oe.counter.lastStage={},oe.counter.nextStage={},t.durationWO.isChange){ae.setup({interval:1e3,duration:oe.isVideoMode?Math.floor(e.duration):60*+t.durationWO.value.split(" ")[0],type:"DEC",firstDelayDuration:oe.isVideoMode?0:3}),he();const s=`${oe.counter.rules.nameWorkout} - ${t.durationWO.value}`;f.innerText=s,v.innerText=s}t.nameWO.isChange&&await ue(`./rules/${t.nameWO.value}.json`),ae.isFirstDelay=!oe.isVideoMode,oe.isVideoMode&&0!==e.currentTime&&(e.currentTime=0,e.load()),ae.pause(),R.style.display="none",z.style.display="none",c.style.display="flex",Y.style.display="none",l.style.display="none",i.style.display="none"},isAudioEffect:e=>{oe.counter.isPlayAudStage=e,ae.isPlayAudTimer=e},isFullscreen:e=>{e&&!document.fullscreenElement?document.documentElement.requestFullscreen():!e&&document.exitFullscreen&&document.fullscreenElement&&document.exitFullscreen()},isFlipCamera:e=>{const t=e?"environment":"user";oe.camHandler.flip(t)},isDirectionSign:e=>{oe.isShowDirectionSign=e,oe.isClassify&&(R.style.display=e?"block":"none")},isDeveloperMode:e=>{K.style.display=e?"flex":"none"}};_.addEventListener("click",(()=>{const e=document.querySelector('input[name="settingsNameWO"]:checked').value,t=document.querySelector('input[name="settingsDurationWO"]:checked').value,s=document.querySelector('input[name="settingsAEBox"]').checked,i=document.querySelector('input[name="settingsFSBox"]').checked,n=document.querySelector('input[name="settingsFCBox"]').checked,o=document.querySelector('input[name="settingsDSBox"]').checked,a=document.querySelector('input[name="settingsDMBox"]').checked;le.change({currWorkout:e,currDuration:t,isAudioEffect:s,isFullscreen:i,isFlipCamera:n,isDirectionSign:o,isDeveloperMode:a},me),k.style.display="none"})),L.addEventListener("click",(()=>{k.style.display="none"})),e.addEventListener("loadeddata",(()=>{oe.isVideoMode||(oe.isClassify&&(oe.isClassify=!1),oe.isLoop=!0,G.checked=!0,te&&(te=!1),r.innerText="",ae.pause(),oe.counter.resetCount(),oe.drawPose())}));const ge=e=>{r.innerText=e},ye=()=>{r.innerText=""},pe=e=>{a.innerText=`${`0${e.minutes}`.slice(-2)}:${`0${e.seconds}`.slice(-2)}`},fe=async()=>{oe.isVideoMode||re.addNewData({id:+new Date,nameWorkout:oe.counter.rules.nameWorkout,duration:le.DBWOSettings.currDuration,repetition:oe.counter.count,date:(new Date).toLocaleString()}),he(),ae.isFirstDelay=!oe.isVideoMode,w.innerText=oe.counter.count,ae.start(ge,ye,pe,fe),ae.pause(),e.pause(),jsonSummary={nameWorkout:oe.counter.rules.nameWorkout,duration:le.DBWOSettings.currDuration,repetition:oe.counter.count,date:(new Date).toLocaleString()};try{const e=await fetch("https://airehab.sbmi.uth.edu:3000/api/summary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(jsonSummary)});(await e.json()).summary}catch(e){console.error("Error sending data to server:",e)}ee=!0,oe.isLoop=!1,oe.counter.resetCount(),oe.counter.lastStage={},oe.counter.nextStage={},b.style.display="flex",c.style.display="flex",Y.style.display="none",l.style.display="none",R.style.display="none",z.style.display="none";const t=window.location.href+"/workoutSuccess";window.history.pushState({path:t},"",t)};E.addEventListener("click",(()=>{b.style.display="none",ee&&oe.isVideoMode?(e.pause(),e.currentTime=0,e.load()):(ae.reset(),he())})),l.addEventListener("click",(()=>{ae.pause(),e.pause(),oe.isLoop=!1,c.style.display="flex",Y.style.display="flex",l.style.display="none",S?S.send({message:{request:"unpublish"},success:function(e){console.log("Stream paused successfully!")},error:function(e){console.error("Error pausing the stream:",e)}}):console.error("Janus VideoRoom handle not available.")})),c.addEventListener("click",(()=>{if(!ee&&!e.paused&&oe.isLoop)return;l.style.display="flex",Y.style.display="none",c.style.display="none";const t=ee;ee&&(ee=!1,oe.isClassify=!0,ae.start(ge,ye,pe,fe)),ae.resume(),oe.isLoop=!0,e.play().then((()=>{if(!te&&t&&!oe.isVideoMode)return console.log("It run?"),void(te=!0);oe.drawPose()})),S?(navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((e=>{S.createOffer({media:{audioSend:!0,videoSend:!0},stream:e,success:function(e){S.send({message:{request:"publish",audio:!0,video:!0},jsep:e})},error:function(e){console.error("WebRTC error:",e)}})})).catch((e=>{console.error("Could not get user media",e)})),S.onmessage=function(e,t){t&&S.handleRemoteJsep({jsep:t})}):console.error("Janus VideoRoom handle not available.")})),B.addEventListener("change",(t=>{if(t.target.files&&t.target.files[0]){oe.camHandler.stop(),oe.isClassify=!0,oe.isLoop=!1,oe.isVideoMode=!0,e.pause(),e.remove();const i=document.createElement("video");i.setAttribute("id","webcamBox"),i.setAttribute("class","bg-gray-200 z-10"),i.setAttribute("style","width: 0px; height: 0px"),i.muted=!0,s.insertBefore(i,s.firstChild),i.setAttribute("src",URL.createObjectURL(t.target.files[0])),i.load(),i.play(),le.change({isFlipCamera:!0},{isFlipCamera:me.isFlipCamera}),i.addEventListener("loadeddata",(()=>{oe.isVideoMode&&(e=i,oe.webcamElem=i,oe.camHandler._webcamElement=i),oe.counter.resetCount(),o.innerText="0",r.innerText="",ae.setup({interval:1e3,duration:oe.isVideoMode?Math.floor(e.duration):60*+le.DBWOSettings.currDuration.split(" ")[0],type:"DEC",firstDelayDuration:oe.isVideoMode?0:3}),ae.isFirstDelay=!oe.isVideoMode,ae.pause(),he(),e.pause(),oe.counter.lastStage={},oe.counter.nextStage={},0!==se&&oe.isVideoMode&&(ie=i.videoHeight,se=i.videoWidth),oe.scaler={w:0/se,h:0/ie},oe.classifier.stdConfig={width:se,height:ie},c.style.display="flex",Y.style.display="none",l.style.display="none",R.style.display="none",z.style.display="none",G.checked=!oe.isVideoMode}))}})),U.addEventListener("click",(e=>{e.preventDefault(),oe.isShowAdvice=!oe.isShowAdvice,Z.checked=oe.isShowAdvice,oe.isClassify&&(z.style.display=oe.isShowAdvice?"flex":"none")})),D.addEventListener("click",(async e=>{e.preventDefault(),oe.isVideoMode&&(se=640,ie=360,oe.camHandler._addVideoConfig={width:se,height:ie},oe.classifier.stdConfig={width:se,height:ie},oe.isLoop=!1,te=!0,G.checked=!0,oe.isVideoMode=!1,await oe.camHandler.start())})),console.log("Hello World!"),N.addEventListener("click",(()=>{H.style.display="flex";const e=window.location.href+"/leaving";window.history.pushState({path:e},"",e)})),q.addEventListener("click",(()=>{document.body.style.display="none";const e=window.location.href.slice(0,-8)+"/left";window.history.pushState({path:e},"",e)})),J.addEventListener("click",(()=>{H.style.display="none";const e=window.location.href.slice(0,-8);window.history.pushState({path:e},"",e)}))}))},75410:()=>{},48628:()=>{},75042:()=>{}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,i.amdD=function(){throw new Error("define cannot be used indirect")},i.amdO={},e=[],i.O=(t,s,n,o)=>{if(!s){var a=1/0;for(d=0;d<e.length;d++){for(var[s,n,o]=e[d],r=!0,l=0;l<s.length;l++)(!1&o||a>=o)&&Object.keys(i.O).every((e=>i.O[e](s[l])))?s.splice(l--,1):(r=!1,o<a&&(a=o));if(r){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,n,o]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={43:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,o,[a,r,l]=s,c=0;if(a.some((t=>0!==e[t]))){for(n in r)i.o(r,n)&&(i.m[n]=r[n]);if(l)var d=l(i)}for(t&&t(s);c<a.length;c++)o=a[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},s=self.webpackChunkai_workout_assistant=self.webpackChunkai_workout_assistant||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=i.O(void 0,[470,50,887,985,370,320,306,858,482],(()=>i(72203)));n=i.O(n)})();