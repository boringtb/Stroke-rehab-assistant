/*! For license information please see chunk.6389267a5c3be478fd03.js.LICENSE.txt */
(self.webpackChunkai_workout_assistant=self.webpackChunkai_workout_assistant||[]).push([[470],{20264:function(e,t,n){(function(){"use strict";var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n.g&&n.g];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function o(e,t){if(t)e:{var n=i;e=e.split(".");for(var o=0;o<e.length-1;o++){var a=e[o];if(!(a in n))break e;n=n[a]}(t=t(o=n[e=e[e.length-1]]))!=o&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}function a(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function s(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}function l(e){if(!(e instanceof Array)){e=s(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}o("Symbol",(function(e){function t(e,t){this.g=e,r(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.g};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(r||"")+"_"+i++,r)}})),o("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<n.length;o++){var s=i[n[o]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&r(s.prototype,e,{configurable:!0,writable:!0,value:function(){return a(t(this))}})}return e}));var u,c="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)u=Object.setPrototypeOf;else{var d;e:{var h={};try{h.__proto__={a:!0},d=h.a;break e}catch(e){}d=!1}u=d?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var f=u;function p(e,t){if(e.prototype=c(t.prototype),e.prototype.constructor=e,f)f(e,t);else for(var n in t)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(t,n);r&&Object.defineProperty(e,n,r)}else e[n]=t[n];e.ea=t.prototype}function g(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function m(e){if(e.l)throw new TypeError("Generator is already running");e.l=!0}function v(e,t){e.j={U:t,V:!0},e.g=e.m||e.s}function y(e,t,n){return e.g=n,{value:t}}function x(e){this.g=new g,this.h=e}function w(e,t,n,r){try{var i=t.call(e.g.i,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.l=!1,i;var o=i.value}catch(t){return e.g.i=null,v(e.g,t),b(e)}return e.g.i=null,r.call(e.g,o),b(e)}function b(e){for(;e.g.g;)try{var t=e.h(e.g);if(t)return e.g.l=!1,{value:t.value,done:!1}}catch(t){e.g.h=void 0,v(e.g,t)}if(e.g.l=!1,e.g.j){if(t=e.g.j,e.g.j=null,t.V)throw t.U;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function C(e){this.next=function(t){return m(e.g),e.g.i?t=w(e,e.g.i.next,t,e.g.o):(e.g.o(t),t=b(e)),t},this.throw=function(t){return m(e.g),e.g.i?t=w(e,e.g.i.throw,t,e.g.o):(v(e.g,t),t=b(e)),t},this.return=function(t){return function(e,t){m(e.g);var n=e.g.i;return n?w(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),b(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function S(e){return function(e){function t(t){return e.next(t)}function n(t){return e.throw(t)}return new Promise((function(r,i){!function e(o){o.done?r(o.value):Promise.resolve(o.value).then(t,n).then(e,i)}(e.next())}))}(new C(new x(e)))}g.prototype.o=function(e){this.h=e},g.prototype.return=function(e){this.j={return:e},this.g=this.s},o("Promise",(function(e){function t(e){this.h=0,this.i=void 0,this.g=[],this.o=!1;var t=this.j();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}}function n(){this.g=null}function r(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;n.prototype.h=function(e){if(null==this.g){this.g=[];var t=this;this.i((function(){t.l()}))}this.g.push(e)};var o=i.setTimeout;n.prototype.i=function(e){o(e,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var e=this.g;this.g=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(e){this.j(e)}}}this.g=null},n.prototype.j=function(e){this.i((function(){throw e}))},t.prototype.j=function(){function e(e){return function(r){n||(n=!0,e.call(t,r))}}var t=this,n=!1;return{resolve:e(this.C),reject:e(this.l)}},t.prototype.C=function(e){if(e===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.F(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.v(e):this.m(e)}},t.prototype.v=function(e){var t=void 0;try{t=e.then}catch(e){return void this.l(e)}"function"==typeof t?this.G(t,e):this.m(e)},t.prototype.l=function(e){this.s(2,e)},t.prototype.m=function(e){this.s(1,e)},t.prototype.s=function(e,t){if(0!=this.h)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.h);this.h=e,this.i=t,2===this.h&&this.D(),this.A()},t.prototype.D=function(){var e=this;o((function(){if(e.B()){var t=i.console;void 0!==t&&t.error(e.i)}}),1)},t.prototype.B=function(){if(this.o)return!1;var e=i.CustomEvent,t=i.Event,n=i.dispatchEvent;return void 0===n||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=i.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.i,n(e))},t.prototype.A=function(){if(null!=this.g){for(var e=0;e<this.g.length;++e)a.h(this.g[e]);this.g=null}};var a=new n;return t.prototype.F=function(e){var t=this.j();e.J(t.resolve,t.reject)},t.prototype.G=function(e,t){var n=this.j();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},t.prototype.then=function(e,n){function r(e,t){return"function"==typeof e?function(t){try{i(e(t))}catch(e){o(e)}}:t}var i,o,a=new t((function(e,t){i=e,o=t}));return this.J(r(e,i),r(n,o)),a},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.J=function(e,t){function n(){switch(r.h){case 1:e(r.i);break;case 2:t(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?a.h(n):this.g.push(n),this.o=!0},t.resolve=r,t.reject=function(e){return new t((function(t,n){n(e)}))},t.race=function(e){return new t((function(t,n){for(var i=s(e),o=i.next();!o.done;o=i.next())r(o.value).J(t,n)}))},t.all=function(e){var n=s(e),i=n.next();return i.done?r([]):new t((function(e,t){function o(t){return function(n){a[t]=n,0==--s&&e(a)}}var a=[],s=0;do{a.push(void 0),s++,r(i.value).J(o(a.length-1),t),i=n.next()}while(!i.done)}))},t}));var T="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e};o("Object.assign",(function(e){return e||T})),o("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),o("Array.prototype.includes",(function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(t=t||0)&&(t=Math.max(t+r,0));t<r;t++){var i=n[t];if(i===e||Object.is(i,e))return!0}return!1}})),o("String.prototype.includes",(function(e){return e||function(e,t){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(e,t||0)}})),o("Array.prototype.keys",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e){return e}))}}));var E=this||self;function R(e,t){e=e.split(".");var n,r=E;e[0]in r||void 0===r.execScript||r.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=t}function I(e){!function(e){E.setTimeout((function(){throw e}),0)}(e)}function k(e,t){I(Error("Invalid wire type: "+e+" (at position "+t+")"))}function O(){I(Error("Failed to read varint, encoding is invalid."))}function _(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}var A,P,D="undefined"!=typeof TextDecoder,$="undefined"!=typeof TextEncoder;function F(e){if($)e=(P||(P=new TextEncoder)).encode(e);else{var t=void 0;t=void 0!==t&&t;for(var n=0,r=new Uint8Array(3*e.length),i=0;i<e.length;i++){var o=e.charCodeAt(i);if(128>o)r[n++]=o;else{if(2048>o)r[n++]=o>>6|192;else{if(55296<=o&&57343>=o){if(56319>=o&&i<e.length){var a=e.charCodeAt(++i);if(56320<=a&&57343>=a){o=1024*(o-55296)+a-56320+65536,r[n++]=o>>18|240,r[n++]=o>>12&63|128,r[n++]=o>>6&63|128,r[n++]=63&o|128;continue}i--}if(t)throw Error("Found an unpaired surrogate");o=65533}r[n++]=o>>12|224,r[n++]=o>>6&63|128}r[n++]=63&o|128}}e=r.subarray(0,n)}return e}var L={},M=null;function N(e){var t;void 0===t&&(t=0),U(),t=L[t];for(var n=Array(Math.floor(e.length/3)),r=t[64]||"",i=0,o=0;i<e.length-2;i+=3){var a=e[i],s=e[i+1],l=e[i+2],u=t[a>>2];a=t[(3&a)<<4|s>>4],s=t[(15&s)<<2|l>>6],l=t[63&l],n[o++]=u+a+s+l}switch(u=0,l=r,e.length-i){case 2:l=t[(15&(u=e[i+1]))<<2]||r;case 1:e=e[i],n[o]=t[e>>2]+t[(3&e)<<4|u>>4]+l+r}return n.join("")}function B(e){var t=e.length,n=3*t/4;n%3?n=Math.floor(n):-1!="=.".indexOf(e[t-1])&&(n=-1!="=.".indexOf(e[t-2])?n-2:n-1);var r=new Uint8Array(n),i=0;return function(e,t){function n(t){for(;r<e.length;){var n=e.charAt(r++),i=M[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}U();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;t(i<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(e,(function(e){r[i++]=e})),r.subarray(0,i)}function U(){if(!M){M={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=e.concat(t[n].split(""));L[n]=r;for(var i=0;i<r.length;i++){var o=r[i];void 0===M[o]&&(M[o]=i)}}}}var W,V="function"==typeof Uint8Array;function G(e){if(this.g=e,null!==e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}G.prototype.toJSON=function(){if(null==this.g)var e="";else e=this.g,e=this.g=null==e||"string"==typeof e?e:V&&e instanceof Uint8Array?N(e):null;return e};var j="function"==typeof Uint8Array.prototype.slice;function z(e,t,n){return t===n?W||(W=new Uint8Array(0)):j?e.slice(t,n):new Uint8Array(e.subarray(t,n))}var H=0;function X(e,t){t=void 0!==(t=void 0===t?{}:t).u&&t.u,this.h=null,this.g=this.i=this.l=0,this.j=!1,this.u=t,e&&q(this,e)}function q(e,t){e.h=function(e){if(e.constructor===Uint8Array)return e;if(e.constructor===ArrayBuffer)return new Uint8Array(e);if(e.constructor===Array)return new Uint8Array(e);if(e.constructor===String)return B(e);if(e.constructor===G){if(null==e.g)var t=W||(W=new Uint8Array(0));else{t=Uint8Array;var n=e.g;n=null==n||V&&null!=n&&n instanceof Uint8Array?n:"string"==typeof n?B(n):null,t=new t(e=e.g=n)}return t}if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(t),e.l=0,e.i=e.h.length,e.g=e.l}function K(e){e.g>e.i&&(e.j=!0,I(Error("Tried to read past the end of the data "+e.g+" > "+e.i)))}function Y(e){var t=e.h,n=t[e.g],r=127&n;return 128>n?(e.g+=1,K(e),r):(r|=(127&(n=t[e.g+1]))<<7,128>n?(e.g+=2,K(e),r):(r|=(127&(n=t[e.g+2]))<<14,128>n?(e.g+=3,K(e),r):(r|=(127&(n=t[e.g+3]))<<21,128>n?(e.g+=4,K(e),r):(r|=(15&(n=t[e.g+4]))<<28,128>n?(e.g+=5,K(e),r>>>0):(e.g+=5,128<=t[e.g++]&&128<=t[e.g++]&&128<=t[e.g++]&&128<=t[e.g++]&&128<=t[e.g++]?(e.j=!0,O(),r):(K(e),r))))))}X.prototype.reset=function(){this.g=this.l};var Q=[];function J(){this.g=new Uint8Array(64),this.h=0}function Z(e,t){if(!(e.h+1<e.g.length)){var n=e.g;e.g=new Uint8Array(Math.ceil(1+2*e.g.length)),e.g.set(n)}e.g[e.h++]=t}function ee(e,t){for(;127<t;)Z(e,127&t|128),t>>>=7;Z(e,t)}function te(e){var t={},n=void 0!==t.N&&t.N;this.m={u:void 0!==t.u&&t.u},this.N=n,t=this.m,Q.length?(n=Q.pop(),t&&(n.u=t.u),e&&q(n,e),e=n):e=new X(e,t),this.g=e,this.l=this.g.g,this.h=this.i=-1,this.j=!1}function ne(e){var t=e.g;if((t=t.g==t.i)||(t=e.j)||(t=(t=e.g).j||0>t.g||t.g>t.i),t)return!1;e.l=e.g.g;var n=Y(e.g);return t=n>>>3,0<=(n&=7)&&5>=n?(e.i=t,e.h=n,!0):(e.j=!0,k(n,e.l),!1)}function re(e){switch(e.h){case 0:if(0!=e.h)re(e);else e:{for(var t=(e=e.g).g,n=0;10>n;n++){if(0==(128&e.h[t])){e.g=t+1,K(e);break e}t++}e.j=!0,O()}break;case 1:(e=e.g).g+=8,K(e);break;case 2:2!=e.h?re(e):(t=Y(e.g),(e=e.g).g+=t,K(e));break;case 5:(e=e.g).g+=4,K(e);break;case 3:for(t=e.i;;){if(!ne(e)){e.j=!0,I(Error("Unmatched start-group tag: stream EOF"));break}if(4==e.h){e.i!=t&&(e.j=!0,I(Error("Unmatched end-group tag")));break}re(e)}break;default:e.j=!0,k(e.h,e.l)}}function ie(e,t,n){e.N||(e=z(e.g.h,n,e.g.g),(n=t.m)?n.push(e):t.m=[e])}J.prototype.length=function(){return this.h},J.prototype.end=function(){var e=this.g,t=this.h;return this.h=0,z(e,0,t)},te.prototype.reset=function(){this.g.reset(),this.h=this.i=-1};var oe=[];function ae(){this.h=[],this.i=0,this.g=new J}function se(e,t){0!==t.length&&(e.h.push(t),e.i+=t.length)}function le(e,t,n){ee(e.g,8*t+2),ee(e.g,n.length),se(e,e.g.end()),se(e,n)}var ue,ce="function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol(void 0):void 0;function de(e,t){Object.isFrozen(e)||(ce?e[ce]|=t:void 0!==e.g?e.g|=t:Object.defineProperties(e,{g:{value:t,configurable:!0,writable:!0,enumerable:!1}}))}function he(e){return e?null==(t=ce?e[ce]:e.g)?0:t:0;var t}function fe(e){return Array.isArray(e)?(de(e,1),e):e}function pe(e){if(!Array.isArray(e))throw Error("cannot mark non-array as immutable");de(e,2)}function ge(e){return null!==e&&"object"==typeof e&&e.constructor===Object}function me(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"object":return V&&null!=e&&e instanceof Uint8Array?N(e):e;default:return e}}function ve(e,t){if(null!=e)return Array.isArray(e)||ge(e)?ye(e,t):t(e)}function ye(e,t){if(Array.isArray(e)){for(var n=Array(e.length),r=0;r<e.length;r++)n[r]=ve(e[r],t);return 1&he(e)&&fe(n),n}for(r in n={},e)n[r]=ve(e[r],t);return n}function xe(e,t,n){var r=ue;if(ue=null,e||(e=r),r=this.constructor.ca,e||(e=r?[r]:[]),this.j=(r?0:-1)-(this.constructor.aa||0),this.i=null,this.g=e,e=(r=this.g.length)-1,r&&ge(r=this.g[e])?(this.l=e-this.j,this.h=r):void 0!==t&&-1<t?(this.l=Math.max(t,e+1-this.j),this.h=null):this.l=Number.MAX_VALUE,n)for(t=0;t<n.length;t++)(e=n[t])<this.l?(e+=this.j,(r=this.g[e])?fe(r):this.g[e]=Ce):(Se(this),(r=this.h[e])?fe(r):this.h[e]=Ce)}var we,be,Ce=Object.freeze(fe([]));function Se(e){var t=e.l+e.j;e.g[t]||(e.h=e.g[t]={})}function Te(e,t,n){return-1===t?null:void 0!==n&&n||t>=e.l?e.h?e.h[t]:void 0:e.g[t+e.j]}function Ee(e,t,n){n=void 0===n||n;var r=void 0!==r&&r,i=Te(e,t,r);return null==i&&(i=Ce),i===Ce?Ie(e,t,i=fe([]),r):n&&Array.isArray(i)&&2&he(i)&&Ie(e,t,i=i.slice(),r),i}function Re(e,t,n){return null==(e=null==(e=Te(e,t))?e:+e)?void 0===n?0:n:e}function Ie(e,t,n,r){void 0!==r&&r||t>=e.l?(Se(e),e.h[t]=n):e.g[t+e.j]=n}function ke(e,t,n){e.i||(e.i={});var r=e.i[n];if(!r){var i=Ee(e,n,!1);r=[];for(var o=!!Array.isArray(i)&&!!(2&he(i)),a=0;a<i.length;a++)r[a]=new t(i[a]),o&&pe(r[a].g);o&&(pe(r),Object.freeze(r)),e.i[n]=r}return r}function Oe(e,t,n,r,i){var o=ke(e,r,t);n=n||new r,e=Ee(e,t),null!=i?(o.splice(i,0,n),e.splice(i,0,_e(n))):(o.push(n),e.push(_e(n)))}function _e(e){if(e.i)for(var t in e.i){var n=e.i[t];if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r]&&_e(n[r]);else n&&_e(n)}return e.g}function Ae(e,t){return null==(e=Te(e,t))?0:e}function Pe(e,t){return null==(e=Te(e,t))?"":e}function De(e,t){if(e=e.m){se(t,t.g.end());for(var n=0;n<e.length;n++)se(t,e[n])}}function $e(e){var t=e[0];switch(e.length){case 2:var n=e[1];return function(e,r,i){return t(e,r,i,n)};case 3:var r=e[1],i=e[2];return function(e,n,o){return t(e,n,o,r,i)};case 4:var o=e[1],a=e[2],s=e[3];return function(e,n,r){return t(e,n,r,o,a,s)};default:throw Error("unsupported number of parameters, expected [2-4], got "+e.length)}}function Fe(e,t,n){for(;ne(t)&&4!=t.h;){var r=t.i,i=n[r];if(i){if(Array.isArray(i)&&(i=n[r]=$e(i)),!i(t,e,r)){i=e;var o=(r=t).l;re(r),ie(r,i,o)}}else i=e,o=(r=t).l,re(r),ie(r,i,o)}return e}function Le(e,t){var n=new ae;if(t(e,n),0===(e=n.i+n.g.length()))n=new Uint8Array(0);else{e=new Uint8Array(e);for(var r=n.h,i=r.length,o=t=0;o<i;o++){var a=r[o];0!==a.length&&(e.set(a,t),t+=a.length)}0!==(i=(r=n.g).h)&&(e.set(r.g.subarray(0,i),t),r.h=0),n.h=[e],n=e}return n}function Me(e,t,n){if(oe.length){var r=oe.pop();e&&(q(r.g,e),r.i=-1,r.h=-1),e=r}else e=new te(e);try{return n(new t,e)}finally{(t=e.g).h=null,t.l=0,t.i=0,t.g=0,t.j=!1,t.u=!1,e.i=-1,e.h=-1,e.j=!1,100>oe.length&&oe.push(e)}}function Ne(e,t,n){if(null!=(t=Te(t,n))){ee(e.g,8*n+5),e=e.g;var r=t;0===(r=(n=0>r?1:0)?-r:r)?H=0<1/r?0:2147483648:isNaN(r)?H=2147483647:34028234663852886e22<r?H=(n<<31|2139095040)>>>0:11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),H=(n<<31|r)>>>0):(t=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-t),16777216<=(r=Math.round(8388608*r))&&++t,H=(n<<31|t+127<<23|8388607&r)>>>0),Z(e,(n=H)>>>0&255),Z(e,n>>>8&255),Z(e,n>>>16&255),Z(e,n>>>24&255)}}function Be(e,t,n){if(5!==e.h)return!1;var r=(e=e.g).h[e.g],i=e.h[e.g+1],o=e.h[e.g+2],a=e.h[e.g+3];return e.g+=4,K(e),e=2*((i=(r<<0|i<<8|o<<16|a<<24)>>>0)>>31)+1,r=i>>>23&255,i&=8388607,Ie(t,n,255==r?i?NaN:1/0*e:0==r?e*Math.pow(2,-149)*i:e*Math.pow(2,r-150)*(i+Math.pow(2,23))),!0}function Ue(e,t,n){if(0!==e.h)return!1;for(var r=e.g,i=128,o=0,a=e=0;4>a&&128<=i;a++)o|=(127&(i=r.h[r.g++]))<<7*a;if(128<=i&&(o|=(127&(i=r.h[r.g++]))<<28,e|=(127&i)>>4),128<=i)for(a=0;5>a&&128<=i;a++)e|=(127&(i=r.h[r.g++]))<<7*a+3;return 128>i?(r=o>>>0,(e=2147483648&(i=e>>>0))&&(i=~i>>>0,0==(r=1+~r>>>0)&&(i=i+1>>>0)),r=4294967296*i+(r>>>0),e=e?-r:r):(r.j=!0,O(),e=void 0),Ie(t,n,e),!0}function We(e,t,n){return 0===e.h&&(Ie(t,n,Y(e.g)),!0)}function Ve(e,t,n){if(2!==e.h)return!1;var r,i=Y(e.g),o=(e=e.g).g;if(e.g+=i,K(e),e=e.h,D)(r=A)||(r=A=new TextDecoder("utf-8",{fatal:!1})),r=r.decode(e.subarray(o,o+i));else{i=o+i;for(var a,s,l,u=[],c=null;o<i;)128>(a=e[o++])?u.push(a):224>a?o>=i?u.push(65533):(s=e[o++],194>a||128!=(192&s)?(o--,u.push(65533)):u.push((31&a)<<6|63&s)):240>a?o>=i-1?u.push(65533):128!=(192&(s=e[o++]))||224===a&&160>s||237===a&&160<=s||128!=(192&(r=e[o++]))?(o--,u.push(65533)):u.push((15&a)<<12|(63&s)<<6|63&r):244>=a?o>=i-2?u.push(65533):128!=(192&(s=e[o++]))||0!=s-144+(a<<28)>>30||128!=(192&(r=e[o++]))||128!=(192&(l=e[o++]))?(o--,u.push(65533)):(a=(7&a)<<18|(63&s)<<12|(63&r)<<6|63&l,a-=65536,u.push(55296+(a>>10&1023),56320+(1023&a))):u.push(65533),8192<=u.length&&(c=_(c,u),u.length=0);r=_(c,u)}return Ie(t,n,r),!0}function Ge(e,t,n,r,i){if(2!==e.h)return!1;var o=new r,a=e.g.i,s=Y(e.g),l=e.g.g+s;if(e.g.i=l,i(o,e),0!=(i=l-e.g.g))throw Error("Message parsing ended unexpectedly. Expected to read "+s+" bytes, instead read "+(s-i)+" bytes, either the data ended unexpectedly or the message misreported its own length");return e.g.g=l,e.g.i=a,Oe(t,n,o,r,void 0),!0}function je(e){xe.call(this,e)}function ze(e,t){var n=Te(e,1);if(null!=n&&null!=n){ee(t.g,8);var r=t.g;if(0<=n)ee(r,n);else{for(var i=0;9>i;i++)Z(r,127&n|128),n>>=7;Z(r,1)}}Ne(t,e,2),null!=(r=Te(e,3))&&le(t,3,F(r)),null!=(r=Te(e,4))&&le(t,4,F(r)),De(e,t)}function He(e,t){return Fe(e,t,we||(we={1:We,2:Be,3:Ve,4:Ve}))}function Xe(e){xe.call(this,e,-1,Qe)}function qe(e,t){return Fe(e,t,be||(be={1:[Ge,je,He]}))}xe.prototype.toJSON=function(){return ye(_e(this),me)},xe.prototype.toString=function(){return _e(this).toString()},p(je,xe),p(Xe,xe),Xe.prototype.addClassification=function(e,t){return Oe(this,1,e,je,t),this};var Ke,Ye,Qe=[1];function Je(e){xe.call(this,e)}function Ze(e,t){Ne(t,e,1),Ne(t,e,2),Ne(t,e,3),Ne(t,e,4),Ne(t,e,5),De(e,t)}function et(e,t){return Fe(e,t,Ke||(Ke={1:Be,2:Be,3:Be,4:Be,5:Be}))}function tt(e){xe.call(this,e,-1,it)}function nt(e,t){return Fe(e,t,Ye||(Ye={1:[Ge,Je,et]}))}p(Je,xe),p(tt,xe);var rt,it=[1];function ot(e){xe.call(this,e)}function at(e,t){Ne(t,e,1),Ne(t,e,2),Ne(t,e,3),Ne(t,e,4),Ne(t,e,5);var n=Te(e,6);if(null!=n&&null!=n){ee(t.g,48);var r=t.g,i=n;n=0>i;var o=(i=Math.abs(i))>>>0;for(i=Math.floor((i-o)/4294967296),i>>>=0,n&&(i=~i>>>0,4294967295<(o=1+(~o>>>0))&&(o=0,4294967295<++i&&(i=0))),n=H=o,o=i;0<o||127<n;)Z(r,127&n|128),n=(n>>>7|o<<25)>>>0,o>>>=7;Z(r,n)}De(e,t)}function st(e,t){return Fe(e,t,rt||(rt={1:Be,2:Be,3:Be,4:Be,5:Be,6:Ue}))}function lt(e,t,n){if(n=e.createShader(0===n?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+e.getShaderInfoLog(n));return n}function ut(e){return ke(e,je,1).map((function(e){return{index:Ae(e,1),X:Re(e,2),label:null!=Te(e,3)?Pe(e,3):void 0,displayName:null!=Te(e,4)?Pe(e,4):void 0}}))}function ct(e){return{x:Re(e,1),y:Re(e,2),z:Re(e,3),visibility:null!=Te(e,4)?Re(e,4):void 0}}function dt(e){return ke(Me(e,tt,nt),Je,1).map(ct)}function ht(e,t){this.h=e,this.g=t,this.l=0}function ft(e,t,n){return function(e,t){var n=e.g;if(void 0===e.m){var r=lt(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),i=lt(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,i),n.linkProgram(o),!n.getProgramParameter(o,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(o));r=e.m=o,n.useProgram(r),i=n.getUniformLocation(r,"sampler0"),e.j={I:n.getAttribLocation(r,"aVertex"),H:n.getAttribLocation(r,"aTex"),da:i},e.s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.s),n.enableVertexAttribArray(e.j.I),n.vertexAttribPointer(e.j.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),e.o=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.o),n.enableVertexAttribArray(e.j.H),n.vertexAttribPointer(e.j.H,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(i,0)}r=e.j,n.useProgram(e.m),n.canvas.width=t.width,n.canvas.height=t.height,n.viewport(0,0,t.width,t.height),n.activeTexture(n.TEXTURE0),e.h.bindTexture2d(t.glName),n.enableVertexAttribArray(r.I),n.bindBuffer(n.ARRAY_BUFFER,e.s),n.vertexAttribPointer(r.I,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,e.o),n.vertexAttribPointer(r.H,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.I),n.disableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,null),e.h.bindTexture2d(0)}(e,t),"function"==typeof e.g.canvas.transferToImageBitmap?Promise.resolve(e.g.canvas.transferToImageBitmap()):n?Promise.resolve(e.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(e.g.canvas):(void 0===e.i&&(e.i=document.createElement("canvas")),new Promise((function(t){e.i.height=e.g.canvas.height,e.i.width=e.g.canvas.width,e.i.getContext("2d",{}).drawImage(e.g.canvas,0,0,e.g.canvas.width,e.g.canvas.height),t(e.i)})))}function pt(e){this.g=e}p(ot,xe);var gt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function mt(e,t){return t+e}function vt(e,t){window[e]=t}function yt(e){if(this.g=e,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=e&&e.locateFile||mt,"object"==typeof window)var t=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");t=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.S=t,e.options)for(var n=(t=s(Object.keys(e.options))).next();!n.done;n=t.next()){n=n.value;var r=e.options[n].default;void 0!==r&&(this.j[n]="function"==typeof r?r():r)}}function xt(e,t){var n,r;return S((function(i){return t in e.F?i.return(e.F[t]):(n=e.locateFile(t,""),r=fetch(n).then((function(e){return e.arrayBuffer()})),e.F[t]=r,i.return(r))}))}function wt(e,t){for(var n=t.name||"$",r=[].concat(l(t.wants)),i=new e.h.StringList,o=s(t.wants),a=o.next();!a.done;a=o.next())i.push_back(a.value);o=e.h.PacketListener.implement({onResults:function(i){for(var o={},a=0;a<t.wants.length;++a)o[r[a]]=i.get(a);var l=e.listeners[n];l&&(e.C=function(e,t,n){var r,i,o,a,l,u,c,d,h,f,p,g,m,v;return S((function(x){switch(x.g){case 1:if(!n)return x.return(t);for(r={},i=0,o=s(Object.keys(n)),a=o.next();!a.done;a=o.next())l=a.value,"string"!=typeof(u=n[l])&&"texture"===u.type&&void 0!==t[u.stream]&&++i;1<i&&(e.G=!1),c=s(Object.keys(n)),a=c.next();case 2:if(a.done){x.g=4;break}if(d=a.value,"string"==typeof(h=n[d]))return m=r,v=d,y(x,function(e,t,n){var r;return S((function(i){return"number"==typeof n||n instanceof Uint8Array||n instanceof e.h.Uint8BlobList?i.return(n):n instanceof e.h.Texture2dDataOut?((r=e.s[t])||(r=new ht(e.h,e.D),e.s[t]=r),i.return(ft(r,n,e.G))):i.return(void 0)}))}(e,d,t[h]),14);if(f=t[h.stream],"detection_list"===h.type){if(f){for(var w=f.getRectList(),b=f.getLandmarksList(),C=f.getClassificationsList(),T=[],E=0;E<w.size();++E){var R=Me(w.get(E),ot,st);R={T:{Y:Re(R,1),Z:Re(R,2),height:Re(R,3),width:Re(R,4),rotation:Re(R,5,0),W:Ae(R,6)},O:dt(b.get(E)),M:ut(Me(C.get(E),Xe,qe))},T.push(R)}w=T}else w=[];r[d]=w,x.g=7;break}if("proto_list"===h.type){if(f){for(w=Array(f.size()),b=0;b<f.size();b++)w[b]=f.get(b);f.delete()}else w=[];r[d]=w,x.g=7;break}if(void 0===f){x.g=3;break}if("float_list"===h.type){r[d]=f,x.g=7;break}if("proto"===h.type){r[d]=f,x.g=7;break}if("texture"!==h.type)throw Error("Unknown output config type: '"+h.type+"'");return(p=e.s[d])||(p=new ht(e.h,e.D),e.s[d]=p),y(x,ft(p,f,e.G),13);case 13:g=x.h,r[d]=g;case 7:h.transform&&r[d]&&(r[d]=h.transform(r[d])),x.g=3;break;case 14:m[v]=x.h;case 3:a=c.next(),x.g=2;break;case 4:return x.return(r)}}))}(e,o,t.outs).then((function(n){n=l(n);for(var i=0;i<t.wants.length;++i){var a=o[r[i]];"object"==typeof a&&a.hasOwnProperty&&a.hasOwnProperty("delete")&&a.delete()}n&&(e.C=n)})))}}),e.i.attachMultiListener(i,o),i.delete()}function bt(e){switch(void 0===e&&(e=0),e){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function Ct(e){var t=this;e=e||{},this.g=new yt({locateFile:e.locateFile,files:function(e){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:bt(e.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:dt},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:dt},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(e){var n,r,i;return S((function(o){return 1==o.g?(n=bt(e),r="third_party/mediapipe/modules/pose_landmark/"+n,y(o,xt(t.g,n),2)):(i=o.h,t.g.overrideFile(r,i),o.return(!0))}))}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(e=yt.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},e.reset=function(){var e=this;return S((function(t){e.i&&(e.i.reset(),e.m={},e.s={}),t.g=0}))},e.setOptions=function(e,t){var n=this;if(t=t||this.g.options){for(var r=[],i=[],o={},a=s(Object.keys(e)),l=a.next();!l.done;o={K:o.K,L:o.L},l=a.next()){var u=l.value;u in this.j&&this.j[u]===e[u]||(this.j[u]=e[u],void 0!==(l=t[u])&&(l.onChange&&(o.K=l.onChange,o.L=e[u],r.push(function(e){return function(){return S((function(t){if(1==t.g)return y(t,e.K(e.L),2);!0===t.h&&(n.o=!0),t.g=0}))}}(o))),l.graphOptionXref&&(u={valueNumber:1===l.type?e[u]:0,valueBoolean:0===l.type&&e[u],valueString:2===l.type?e[u]:""},l=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),l.graphOptionXref),u),i.push(l))))}0===r.length&&0===i.length||(this.o=!0,this.A=(void 0===this.A?[]:this.A).concat(i),this.v=(void 0===this.v?[]:this.v).concat(r))}},e.initialize=function(){var e=this;return S((function(t){return 1==t.g?y(t,function(e){var t,n,r,i,o,a,s,u,c,d,h;return S((function(f){switch(f.g){case 1:return e.R?(t=void 0===e.g.files?[]:"function"==typeof e.g.files?e.g.files(e.j):e.g.files,y(f,S((function(e){switch(e.g){case 1:return e.m=2,y(e,WebAssembly.instantiate(gt),4);case 4:e.g=3,e.m=0;break;case 2:return e.m=0,e.j=null,e.return(!1);case 3:return e.return(!0)}})),2)):f.return();case 2:if(n=f.h,"object"==typeof window)return vt("createMediapipeSolutionsWasm",{locateFile:e.locateFile}),vt("createMediapipeSolutionsPackedAssets",{locateFile:e.locateFile}),a=t.filter((function(e){return void 0!==e.data})),s=t.filter((function(e){return void 0===e.data})),u=Promise.all(a.map((function(t){var n=xt(e,t.url);if(void 0!==t.path){var r=t.path;n=n.then((function(t){return e.overrideFile(r,t),Promise.resolve(t)}))}return n}))),c=Promise.all(s.map((function(t){return void 0===t.simd||t.simd&&n||!t.simd&&!n?function(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("crossorigin","anonymous"),new Promise((function(e){t.addEventListener("load",(function(){e()}),!1),t.addEventListener("error",(function(){e()}),!1),document.body.appendChild(t)}))}(e.locateFile(t.url,e.S)):Promise.resolve()}))).then((function(){var t,n,r;return S((function(i){if(1==i.g)return t=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,r=e,y(i,t(n),2);r.h=i.h,i.g=0}))})),d=S((function(t){return e.g.graph&&e.g.graph.url?t=y(t,xt(e,e.g.graph.url),0):(t.g=0,t=void 0),t})),y(f,Promise.all([c,u,d]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return r=t.filter((function(e){return void 0===e.simd||e.simd&&n||!e.simd&&!n})).map((function(t){return e.locateFile(t.url,e.S)})),importScripts.apply(null,l(r)),i=e,y(f,createMediapipeSolutionsWasm(Module),6);case 6:i.h=f.h,e.l=new OffscreenCanvas(1,1),e.h.canvas=e.l,o=e.h.GL.createContext(e.l,{antialias:!1,alpha:!1,ba:"undefined"!=typeof WebGL2RenderingContext?2:1}),e.h.GL.makeContextCurrent(o),f.g=4;break;case 7:if(e.l=document.createElement("canvas"),!(h=e.l.getContext("webgl2",{}))&&!(h=e.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),f.return();e.D=h,e.h.canvas=e.l,e.h.createContext(e.l,!0,!0,{});case 4:e.i=new e.h.SolutionWasm,e.R=!1,f.g=0}}))}(e),2):3!=t.g?y(t,function(e){var t,n,r,i,o,a,l,u;return S((function(c){if(1==c.g)return e.g.graph&&e.g.graph.url&&e.P===e.g.graph.url?c.return():(e.o=!0,e.g.graph&&e.g.graph.url?(e.P=e.g.graph.url,y(c,xt(e,e.g.graph.url),3)):void(c.g=2));for(2!=c.g&&(t=c.h,e.i.loadGraph(t)),n=s(Object.keys(e.B)),r=n.next();!r.done;r=n.next())i=r.value,e.i.overrideFile(i,e.B[i]);if(e.B={},e.g.listeners)for(o=s(e.g.listeners),a=o.next();!a.done;a=o.next())l=a.value,wt(e,l);u=e.j,e.j={},e.setOptions(u),c.g=0}))}(e),3):y(t,function(e){var t,n,r,i,o,a;return S((function(l){switch(l.g){case 1:if(!e.o)return l.return();if(!e.v){l.g=2;break}t=s(e.v),n=t.next();case 3:if(n.done){l.g=5;break}return y(l,(0,n.value)(),4);case 4:n=t.next(),l.g=3;break;case 5:e.v=void 0;case 2:if(e.A){for(r=new e.h.GraphOptionChangeRequestList,i=s(e.A),o=i.next();!o.done;o=i.next())a=o.value,r.push_back(a);e.i.changeOptions(r),r.delete(),e.A=void 0}e.o=!1,l.g=0}}))}(e),0)}))},e.overrideFile=function(e,t){this.i?this.i.overrideFile(e,t):this.B[e]=t},e.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},e.send=function(e,t){var n,r,i,o,a,l,u,c,d,h=this;return S((function(f){switch(f.g){case 1:return h.g.inputs?(n=1e3*(null==t?performance.now():t),y(f,h.C,2)):f.return();case 2:return y(f,h.initialize(),3);case 3:for(r=new h.h.PacketDataList,i=s(Object.keys(e)),o=i.next();!o.done;o=i.next())if(a=o.value,l=h.g.inputs[a]){e:{var p=e[a];switch(l.type){case"video":var g=h.m[l.stream];if(g||(g=new ht(h.h,h.D),h.m[l.stream]=g),0===g.l&&(g.l=g.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&p instanceof HTMLVideoElement)var m=p.videoWidth,v=p.videoHeight;else"undefined"!=typeof HTMLImageElement&&p instanceof HTMLImageElement?(m=p.naturalWidth,v=p.naturalHeight):(m=p.width,v=p.height);v={glName:g.l,width:m,height:v},(m=g.g).canvas.width=v.width,m.canvas.height=v.height,m.activeTexture(m.TEXTURE0),g.h.bindTexture2d(g.l),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,p),g.h.bindTexture2d(0),g=v;break e;case"detections":for((g=h.m[l.stream])||(g=new pt(h.h),h.m[l.stream]=g),g.data||(g.data=new g.g.DetectionListData),g.data.reset(p.length),v=0;v<p.length;++v){m=p[v];var x=g.data,w=x.setBoundingBox,b=v,C=m.T,S=new ot;if(Ie(S,1,C.Y),Ie(S,2,C.Z),Ie(S,3,C.height),Ie(S,4,C.width),Ie(S,5,C.rotation),Ie(S,6,C.W),C=Le(S,at),w.call(x,b,C),m.O)for(x=0;x<m.O.length;++x){var T=!!(S=m.O[x]).visibility;b=(w=g.data).addNormalizedLandmark,C=v,S=Object.assign(Object.assign({},S),{visibility:T?S.visibility:0}),Ie(T=new Je,1,S.x),Ie(T,2,S.y),Ie(T,3,S.z),S.visibility&&Ie(T,4,S.visibility),S=Le(T,Ze),b.call(w,C,S)}if(m.M)for(x=0;x<m.M.length;++x)b=(w=g.data).addClassification,C=v,S=m.M[x],Ie(T=new je,2,S.X),S.index&&Ie(T,1,S.index),S.label&&Ie(T,3,S.label),S.displayName&&Ie(T,4,S.displayName),S=Le(T,ze),b.call(w,C,S)}g=g.data;break e;default:g={}}}switch(u=g,c=l.stream,l.type){case"video":r.pushTexture2d(Object.assign(Object.assign({},u),{stream:c,timestamp:n}));break;case"detections":(d=u).stream=c,d.timestamp=n,r.pushDetectionList(d);break;default:throw Error("Unknown input config type: '"+l.type+"'")}}return h.i.send(r),y(f,h.C,4);case 4:r.delete(),f.g=0}}))},e.onResults=function(e,t){this.listeners[t||"$"]=e},R("Solution",yt),R("OptionType",{BOOL:0,NUMBER:1,$:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(e=Ct.prototype).reset=function(){this.g.reset()},e.close=function(){return this.g.close(),Promise.resolve()},e.onResults=function(e){this.g.onResults(e)},e.initialize=function(){var e=this;return S((function(t){return y(t,e.g.initialize(),0)}))},e.send=function(e,t){var n=this;return S((function(r){return y(r,n.g.send(e,t),0)}))},e.setOptions=function(e){this.g.setOptions(e)},R("Pose",Ct),R("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),R("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),R("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),R("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),R("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),R("VERSION","0.5.1635988162")}).call(this)},96064:(e,t,n)=>{"use strict";n.d(t,{cH:()=>Et,oV:()=>Ie});var r=n(20264),i=n(88478),o=n(38985),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function s(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function u(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function d(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var h=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],f=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],p={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},g={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},m=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],v=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]];function y(e){return e instanceof SVGAnimatedLength?e.baseVal.value:e}function x(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return t=document.createElement("canvas"),e instanceof i.esB?[4,i.Xhn.toPixels(e,t)]:[3,2];case 1:return r.sent(),[3,3];case 2:t.width=y(e.width),t.height=y(e.height),n=t.getContext("2d"),e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0),r.label=3;case 3:return[2,t]}}))}))}function w(e){return u(this,void 0,void 0,(function(){var t,n,r,o,a,s;return c(this,(function(l){switch(l.label){case 0:return e instanceof i.esB?(t=e.shape.slice(0,2),n=t[0],r=t[1],o=ImageData.bind,[4,i.Xhn.toPixels(e)]):[3,2];case 1:return[2,new(o.apply(ImageData,[void 0,l.sent(),r,n]))];case 2:return a=document.createElement("canvas"),s=a.getContext("2d"),a.width=y(e.width),a.height=y(e.height),s.drawImage(e,0,0),[2,s.getImageData(0,0,a.width,a.height)]}}))}))}function b(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return e instanceof SVGImageElement||e instanceof OffscreenCanvas?[4,x(e)]:[3,2];case 1:return n=r.sent(),[3,3];case 2:n=e,r.label=3;case 3:return t=n,[2,i.Xhn.fromPixels(t,4)]}}))}))}function C(e){if(e<0||e>=256)throw new Error("Mask value must be in range [0, 255] but got "+e);if(!Number.isInteger(e))throw new Error("Mask value must be an integer but got "+e)}var S={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},T=function(){function e(e){this.mask=e}return e.prototype.toCanvasImageSource=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.mask]}))}))},e.prototype.toImageData=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,w(this.mask)]}))}))},e.prototype.toTensor=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,b(this.mask)]}))}))},e.prototype.getUnderlyingType=function(){return"canvasimagesource"},e}();function E(e){return C(e),"person"}var R=function(){function e(e){var t,n=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new r.Pose({locateFile:function(t,n){return e.solutionPath?e.solutionPath.replace(/\/+$/,"")+"/"+t:n+"/"+t}}),e.modelType){case"lite":t=0;break;case"heavy":t=2;break;default:t=1}this.poseSolution.setOptions({modelComplexity:t,smoothLandmarks:e.enableSmoothing,enableSegmentation:e.enableSegmentation,smoothSegmentation:e.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults((function(e){if(n.height=e.image.height,n.width=e.image.width,null==e.poseLandmarks)n.poses=[];else{var t=n.translateOutput(e.poseLandmarks,e.poseWorldLandmarks);e.segmentationMask&&(t.segmentation={maskValueToLabel:E,mask:new T(e.segmentationMask)}),n.poses=[t]}}))}return e.prototype.translateOutput=function(e,t){var n=this,r={keypoints:e.map((function(e,t){return{x:e.x*n.width,y:e.y*n.height,z:e.z,score:e.visibility,name:f[t]}}))};return null!=t&&(r.keypoints3D=t.map((function(e,t){return{x:e.x,y:e.y,z:e.z,score:e.visibility,name:f[t]}}))),r},e.prototype.estimatePoses=function(e,t,n){return u(this,void 0,void 0,(function(){var r,o;return c(this,(function(a){switch(a.label){case 0:return t&&t.flipHorizontal&&t.flipHorizontal!==this.selfieMode&&(this.selfieMode=t.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),e instanceof i.esB?(o=ImageData.bind,[4,i.Xhn.toPixels(e)]):[3,2];case 1:return r=new(o.apply(ImageData,[void 0,a.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:r=e,a.label=3;case 3:return e=r,[4,this.poseSolution.send({image:e},n)];case 4:return a.sent(),[2,this.poses]}}))}))},e.prototype.dispose=function(){this.poseSolution.close()},e.prototype.reset=function(){this.poseSolution.reset()},e.prototype.initialize=function(){return this.poseSolution.initialize()},e}();function I(e){return u(this,void 0,void 0,(function(){var t,n;return c(this,(function(r){switch(r.label){case 0:return t=function(e){if(null==e)return l({},S);var t=l({},e);return t.runtime="mediapipe",null==t.enableSegmentation&&(t.enableSegmentation=S.enableSegmentation),null==t.enableSmoothing&&(t.enableSmoothing=S.enableSmoothing),null==t.smoothSegmentation&&(t.smoothSegmentation=S.smoothSegmentation),null==t.modelType&&(t.modelType=S.modelType),t}(e),[4,(n=new R(t)).initialize()];case 1:return r.sent(),[2,n]}}))}))}function k(e){return e instanceof i.esB?{height:e.shape[0],width:e.shape[1]}:{height:e.height,width:e.width}}function O(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function _(e){return e instanceof i.esB?e:i.Xhn.fromPixels(e)}function A(e,t,n){return P(n,"inputResolution"),[1/n.width*e[0][0]*t.width,1/n.height*e[0][1]*t.width,e[0][3]*t.width,1/n.width*e[1][0]*t.height,1/n.height*e[1][1]*t.height,e[1][3]*t.height,0,0]}function P(e,t){i.D5U.assert(0!==e.width,(function(){return t+" width cannot be 0."})),i.D5U.assert(0!==e.height,(function(){return t+" height cannot be 0."}))}function D(e,t,n){var r=n.rotationVectorStartKeypointIndex,i=n.rotationVectorEndKeypointIndex,o=e.locationData,a=o.relativeKeypoints[r].x*t.width,s=o.relativeKeypoints[r].y*t.height,l=o.relativeKeypoints[i].x*t.width,u=o.relativeKeypoints[i].y*t.height,c=2*Math.sqrt((l-a)*(l-a)+(u-s)*(u-s)),d=function(e,t,n){var r,i=e.locationData,o=n.rotationVectorStartKeypointIndex,a=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var s=i.relativeKeypoints[o].x*t.width,l=i.relativeKeypoints[o].y*t.height,u=i.relativeKeypoints[a].x*t.width,c=i.relativeKeypoints[a].y*t.height;return O(r-Math.atan2(-(c-l),u-s))}(e,t,n);return{xCenter:a/t.width,yCenter:s/t.height,width:c/t.width,height:c/t.height,rotation:d}}function $(e){if(16!==e.length)throw new Error("Array length must be 16 but got "+e.length);return[[e[0],e[1],e[2],e[3]],[e[4],e[5],e[6],e[7]],[e[8],e[9],e[10],e[11]],[e[12],e[13],e[14],e[15]]]}function F(e,t,n,r,i,o,a){return e[t][i]*(e[n][o]*e[r][a]-e[n][a]*e[r][o])}function L(e,t,n){var r=(t+1)%4,i=(t+2)%4,o=(t+3)%4,a=(n+1)%4,s=(n+2)%4,l=(n+3)%4;return F(e,r,i,o,a,s,l)+F(e,i,o,r,a,s,l)+F(e,o,r,i,a,s,l)}function M(e,t,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.x-.5,u=a.y-.5,c=n.ignoreRotation?0:t.rotation,d=Math.cos(c)*s-Math.sin(c)*u,h=Math.sin(c)*s+Math.cos(c)*u;d=d*t.width+t.xCenter,h=h*t.height+t.yCenter;var f=a.z*t.width,p=l({},a);p.x=d,p.y=h,p.z=f,r.push(p)}return r}function N(e,t){var n=function(e,t,n,r){var i=(r-n)/255;return{scale:i,offset:n-0*i}}(0,0,t[0],t[1]);return(0,i.lub)((function(){return(0,i.IHx)((0,i.dC7)(e,n.scale),n.offset)}))}function B(e,t,n){var r,o,a,s,l,u,c,d,h,f,p,g,m=t.outputTensorSize,v=t.keepAspectRatio,y=t.borderMode,x=t.outputTensorFloatRange,w=k(e),b=function(e,t){return t?{xCenter:t.xCenter*e.width,yCenter:t.yCenter*e.height,width:t.width*e.width,height:t.height*e.height,rotation:t.rotation}:{xCenter:.5*e.width,yCenter:.5*e.height,width:e.width,height:e.height,rotation:0}}(w,n),C=function(e,t,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=t.height,i=t.width;P(t,"targetSize"),P(e,"roi");var o,a,s=r/i,l=e.height/e.width,u=0,c=0;return s>l?(o=e.width,a=e.width*s,c=(1-l/s)/2):(o=e.height/s,a=e.height,u=(1-s/l)/2),e.width=o,e.height=a,{top:c,left:u,right:u,bottom:c}}(b,m,v),S=(r=b,o=w.width,a=w.height,s=r.width,l=r.height,u=Math.cos(r.rotation),c=Math.sin(r.rotation),d=r.xCenter,h=r.yCenter,f=1/o,p=1/a,(g=new Array(16))[0]=s*u*1*f,g[1]=-l*c*f,g[2]=0,g[3]=(-.5*s*u*1+.5*l*c+d)*f,g[4]=s*c*1*p,g[5]=l*u*p,g[6]=0,g[7]=(-.5*l*u-.5*s*c*1+h)*p,g[8]=0,g[9]=0,g[10]=s*f,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,$(g));return{imageTensor:(0,i.lub)((function(){var t=_(e),n=(0,i.odF)(A(S,w,m),[1,8]),r="zero"===y?"constant":"nearest",o=i.BHj.transform((0,i.dt4)((0,i.pju)(t,"float32")),n,"bilinear",r,0,[m.height,m.width]);return null!=x?N(o,x):o})),padding:C,transformationMatrix:S}}function U(e,t,n,r){return 1===r?.5*(e+t):e+(t-e)*n/(r-1)}function W(e){return null!=e&&null!=e.currentTime}function V(e){for(var t={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,a=0;a<e.length;++a){var s=e[a];n=Math.min(n,s.x),r=Math.max(r,s.x),i=Math.min(i,s.y),o=Math.max(o,s.y),t.locationData.relativeKeypoints.push({x:s.x,y:s.y})}return t.locationData.relativeBoundingBox={xMin:n,yMin:i,xMax:r,yMax:o,width:r-n,height:o-i},t}function G(e,t,n,r){return u(this,void 0,void 0,(function(){var r,o,a,s,l;return c(this,(function(u){switch(u.label){case 0:return e.sort((function(e,t){return Math.max.apply(Math,t.score)-Math.max.apply(Math,e.score)})),r=(0,i.odF)(e.map((function(e){return[e.locationData.relativeBoundingBox.yMin,e.locationData.relativeBoundingBox.xMin,e.locationData.relativeBoundingBox.yMax,e.locationData.relativeBoundingBox.xMax]}))),o=(0,i.RRF)(e.map((function(e){return e.score[0]}))),[4,i.BHj.nonMaxSuppressionAsync(r,o,t,n)];case 1:return[4,(a=u.sent()).array()];case 2:return s=u.sent(),l=e.filter((function(e,t){return s.indexOf(t)>-1})),(0,i.B90)([r,o,a]),[2,l]}}))}))}function j(e,t){return e.map((function(e){var n=l(l({},e),{x:e.x*t.width,y:e.y*t.height});return null!=e.z&&(n.z=e.z*t.width),n}))}function z(e,t,n){return u(this,void 0,void 0,(function(){var r,o,a,s,u,d,h,f,p,g,m,v,y,x,w,b,C,S,T,E,R,I,k,O;return c(this,(function(c){switch(c.label){case 0:if(r=(0,i.L9e)(t,[0]),o=r.shape,a=o[0],s=o[1],u=o[2],e.length!==u)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+e.length+", heatmap length: "+u);return d=[],[4,r.buffer()];case 1:for(h=c.sent(),f=0;f<e.length;f++)if(p=e[f],g=l({},p),d.push(g),m=Math.trunc(g.x*s),v=Math.trunc(g.y*a),!(m<0||m>=s||v<0||m>=a)){for(y=Math.trunc((n.kernelSize-1)/2),x=Math.max(0,m-y),w=Math.min(s,m+y+1),b=Math.max(0,v-y),C=Math.min(a,v+y+1),S=0,T=0,E=0,R=0,I=b;I<C;++I)for(k=x;k<w;++k)O=h.get(I,k,f),S+=O,R=Math.max(R,O),T+=k*O,E+=I*O;R>=n.minConfidenceToRefine&&S>0&&(g.x=T/s/S,g.y=E/a/S)}return r.dispose(),[2,d]}}))}))}function H(e,t){var n=t.left,r=t.top,i=t.left+t.right,o=t.top+t.bottom;return e.map((function(e){return l(l({},e),{x:(e.x-n)/(1-i),y:(e.y-r)/(1-o),z:e.z/(1-i)})}))}function X(e,t,n){return u(this,void 0,void 0,(function(){var r,o,a,s,l;return c(this,(function(u){switch(u.label){case 0:return r=e[0],o=e[1],a=function(e,t,n){return(0,i.lub)((function(){var r,o,a,s;n.reverseOutputOrder?(o=(0,i.L9e)((0,i.tPi)(e,[0,n.boxCoordOffset+0],[-1,1])),r=(0,i.L9e)((0,i.tPi)(e,[0,n.boxCoordOffset+1],[-1,1])),s=(0,i.L9e)((0,i.tPi)(e,[0,n.boxCoordOffset+2],[-1,1])),a=(0,i.L9e)((0,i.tPi)(e,[0,n.boxCoordOffset+3],[-1,1]))):(r=(0,i.L9e)((0,i.tPi)(e,[0,n.boxCoordOffset+0],[-1,1])),o=(0,i.L9e)((0,i.tPi)(e,[0,n.boxCoordOffset+1],[-1,1])),a=(0,i.L9e)((0,i.tPi)(e,[0,n.boxCoordOffset+2],[-1,1])),s=(0,i.L9e)((0,i.tPi)(e,[0,n.boxCoordOffset+3],[-1,1]))),o=(0,i.IHx)((0,i.dC7)((0,i.hiC)(o,n.xScale),t.w),t.x),r=(0,i.IHx)((0,i.dC7)((0,i.hiC)(r,n.yScale),t.h),t.y),n.applyExponentialOnBoxSize?(a=(0,i.dC7)((0,i.Qqt)((0,i.hiC)(a,n.hScale)),t.h),s=(0,i.dC7)((0,i.Qqt)((0,i.hiC)(s,n.wScale)),t.w)):(a=(0,i.dC7)((0,i.hiC)(a,n.hScale),t.h),s=(0,i.dC7)((0,i.hiC)(s,n.wScale),t.h));var l=(0,i.luU)(r,(0,i.hiC)(a,2)),u=(0,i.luU)(o,(0,i.hiC)(s,2)),c=(0,i.IHx)(r,(0,i.hiC)(a,2)),d=(0,i.IHx)(o,(0,i.hiC)(s,2)),h=(0,i.zoF)([(0,i.XLQ)(l,[n.numBoxes,1]),(0,i.XLQ)(u,[n.numBoxes,1]),(0,i.XLQ)(c,[n.numBoxes,1]),(0,i.XLQ)(d,[n.numBoxes,1])],1);if(n.numKeypoints)for(var f=0;f<n.numKeypoints;++f){var p=n.keypointCoordOffset+f*n.numValuesPerKeypoint,g=void 0,m=void 0;n.reverseOutputOrder?(g=(0,i.L9e)((0,i.tPi)(e,[0,p],[-1,1])),m=(0,i.L9e)((0,i.tPi)(e,[0,p+1],[-1,1]))):(m=(0,i.L9e)((0,i.tPi)(e,[0,p],[-1,1])),g=(0,i.L9e)((0,i.tPi)(e,[0,p+1],[-1,1])));var v=(0,i.IHx)((0,i.dC7)((0,i.hiC)(g,n.xScale),t.w),t.x),y=(0,i.IHx)((0,i.dC7)((0,i.hiC)(m,n.yScale),t.h),t.y);h=(0,i.zoF)([h,(0,i.XLQ)(v,[n.numBoxes,1]),(0,i.XLQ)(y,[n.numBoxes,1])],1)}return h}))}(o,t,n),s=(0,i.lub)((function(){var e=r;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(e=(0,i.iUl)(r,-n.scoreClippingThresh,n.scoreClippingThresh)),e=(0,i.XD2)(e)):e})),[4,q(a,s,n)];case 1:return l=u.sent(),(0,i.B90)([a,s]),[2,l]}}))}))}function q(e,t,n){return u(this,void 0,void 0,(function(){var r,i,o,a,s,l,u,d,h,f,p,g;return c(this,(function(c){switch(c.label){case 0:return r=[],[4,e.data()];case 1:return i=c.sent(),[4,t.data()];case 2:for(o=c.sent(),a=0;a<n.numBoxes;++a)if(!(null!=n.minScoreThresh&&o[a]<n.minScoreThresh||(s=a*n.numCoords,l=K(i[s+0],i[s+1],i[s+2],i[s+3],o[a],n.flipVertically,a),(u=l.locationData.relativeBoundingBox).width<0||u.height<0))){if(n.numKeypoints>0)for((d=l.locationData).relativeKeypoints=[],h=n.numKeypoints*n.numValuesPerKeypoint,f=0;f<h;f+=n.numValuesPerKeypoint)p=s+n.keypointCoordOffset+f,g={x:i[p+0],y:n.flipVertically?1-i[p+1]:i[p+1]},d.relativeKeypoints.push(g);r.push(l)}return[2,r]}}))}))}function K(e,t,n,r,i,o,a){return{score:[i],ind:a,locationData:{relativeBoundingBox:{xMin:t,yMin:o?1-n:e,xMax:r,yMax:o?1-e:n,width:r-t,height:n-e}}}}function Y(e,t){return"none"===e?t:function(e){return 1/(1+Math.exp(-e))}(t)}function Q(e,t,n,r){return u(this,void 0,void 0,(function(){var i,o,a,s,l,u,d,h;return c(this,(function(c){switch(c.label){case 0:return n=n||t.flipHorizontally||!1,r=r||t.flipVertically||!1,i=e.size,o=i/t.numLandmarks,[4,e.data()];case 1:for(a=c.sent(),s=[],l=0;l<t.numLandmarks;++l)u=l*o,(h={x:0,y:0}).x=n?t.inputImageWidth-a[u]:a[u],o>1&&(h.y=r?t.inputImageHeight-a[u+1]:a[u+1]),o>2&&(h.z=a[u+2]),o>3&&(h.score=Y(t.visibilityActivation,a[u+3])),s.push(h);for(d=0;d<s.length;++d)(h=s[d]).x=h.x/t.inputImageWidth,h.y=h.y/t.inputImageHeight,h.z=h.z/t.inputImageWidth/(t.normalizeZ||1);return[2,s]}}))}))}function J(e,t,n){var r=e.width,i=e.height,o=e.rotation;if(null==n.rotation&&null==n.rotationDegree||(o=function(e,t){return null!=t.rotation?e+=t.rotation:null!=t.rotationDegree&&(e+=Math.PI*t.rotationDegree/180),O(e)}(o,n)),0===o)e.xCenter=e.xCenter+r*n.shiftX,e.yCenter=e.yCenter+i*n.shiftY;else{var a=(t.width*r*n.shiftX*Math.cos(o)-t.height*i*n.shiftY*Math.sin(o))/t.width,s=(t.width*r*n.shiftX*Math.sin(o)+t.height*i*n.shiftY*Math.cos(o))/t.height;e.xCenter=e.xCenter+a,e.yCenter=e.yCenter+s}if(n.squareLong){var l=Math.max(r*t.width,i*t.height);r=l/t.width,i=l/t.height}else if(n.squareShort){var u=Math.min(r*t.width,i*t.height);r=u/t.width,i=u/t.height}return e.width=r*n.scaleX,e.height=i*n.scaleY,e}var Z=function(){function e(e){this.alpha=e,this.initialized=!1}return e.prototype.apply=function(e,t){var n;return this.initialized?n=null==t?this.storedValue+this.alpha*(e-this.storedValue):this.storedValue+this.alpha*t*Math.asinh((e-this.storedValue)/t):(n=e,this.initialized=!0),this.rawValue=e,this.storedValue=n,n},e.prototype.applyWithAlpha=function(e,t,n){return this.alpha=t,this.apply(e,n)},e.prototype.hasLastRawValue=function(){return this.initialized},e.prototype.lastRawValue=function(){return this.rawValue},e.prototype.reset=function(){this.initialized=!1},e}(),ee=function(){function e(e){this.frequency=e.frequency,this.minCutOff=e.minCutOff,this.beta=e.beta,this.thresholdCutOff=e.thresholdCutOff,this.thresholdBeta=e.thresholdBeta,this.derivateCutOff=e.derivateCutOff,this.x=new Z(this.getAlpha(this.minCutOff)),this.dx=new Z(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return e.prototype.apply=function(e,t,n){if(null==e)return e;var r=Math.trunc(t);if(this.lastTimestamp>=r)return e;0!==this.lastTimestamp&&0!==r&&(this.frequency=1/(1e-6*(r-this.lastTimestamp))),this.lastTimestamp=r;var i=this.x.hasLastRawValue()?(e-this.x.lastRawValue())*n*this.frequency:0,o=this.dx.applyWithAlpha(i,this.getAlpha(this.derivateCutOff)),a=this.minCutOff+this.beta*Math.abs(o),s=null!=this.thresholdCutOff?this.thresholdCutOff+this.thresholdBeta*Math.abs(o):null;return this.x.applyWithAlpha(e,this.getAlpha(a),s)},e.prototype.getAlpha=function(e){return 1/(1+this.frequency/(2*Math.PI*e))},e}(),te=function(){function e(e){this.config=e}return e.prototype.apply=function(e,t,n){var r=this;if(null==e)return this.reset(),null;this.initializeFiltersIfEmpty(e);var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return d(e);i=1/n}return e.map((function(e,n){var o=l(l({},e),{x:r.xFilters[n].apply(e.x,t,i),y:r.yFilters[n].apply(e.y,t,i)});return null!=e.z&&(o.z=r.zFilters[n].apply(e.z,t,i)),o}))},e.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},e.prototype.initializeFiltersIfEmpty=function(e){var t=this;null!=this.xFilters&&this.xFilters.length===e.length||(this.xFilters=e.map((function(e){return new ee(t.config)})),this.yFilters=e.map((function(e){return new ee(t.config)})),this.zFilters=e.map((function(e){return new ee(t.config)})))},e}(),ne=function(){function e(e){this.config=e,this.window=[],this.lowPassFilter=new Z(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return e.prototype.apply=function(e,t,n){if(null==e)return e;var r,i=Math.trunc(t);if(this.lastTimestamp>=i)return e;if(-1===this.lastTimestamp)r=1;else{for(var o=e*n-this.lastValue*this.lastValueScale,a=i-this.lastTimestamp,s=o,l=a,u=(1+this.window.length)*(1e6/30),c=0,d=this.window;c<d.length;c++){var h=d[c];if(l+h.duration>u)break;s+=h.distance,l+=h.duration}var f=s/(1e-6*l);r=1-1/(1+this.config.velocityScale*Math.abs(f)),this.window.unshift({distance:o,duration:a}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=e,this.lastValueScale=n,this.lastTimestamp=i,this.lowPassFilter.applyWithAlpha(e,r)},e}(),re=function(){function e(e){this.config=e}return e.prototype.apply=function(e,t,n){var r=this;if(null==e)return this.reset(),null;var i=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return d(e);i=1/n}return this.initializeFiltersIfEmpty(e),e.map((function(e,n){var o=l(l({},e),{x:r.xFilters[n].apply(e.x,t,i),y:r.yFilters[n].apply(e.y,t,i)});return null!=e.z&&(o.z=r.zFilters[n].apply(e.z,t,i)),o}))},e.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},e.prototype.initializeFiltersIfEmpty=function(e){var t=this;null!=this.xFilters&&this.xFilters.length===e.length||(this.xFilters=e.map((function(e){return new ne(t.config)})),this.yFilters=e.map((function(e){return new ne(t.config)})),this.zFilters=e.map((function(e){return new ne(t.config)})))},e}(),ie=function(){function e(e){if(null!=e.velocityFilter)this.keypointsFilter=new re(e.velocityFilter);else{if(null==e.oneEuroFilter)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+e+".");this.keypointsFilter=new te(e.oneEuroFilter)}}return e.prototype.apply=function(e,t,n,r,i){if(void 0===r&&(r=!1),null==e)return this.keypointsFilter.reset(),null;var o=null!=i?function(e,t){return(e.width*t.width+e.height*t.height)/2}(i,n):1,a=r?j(e,n):e,s=this.keypointsFilter.apply(a,t,o);return r?function(e,t){return e.map((function(e){var n=l(l({},e),{x:e.x/t.width,y:e.y/t.height});return null!=e.z&&(e.z=e.z/t.width),n}))}(s,n):s},e}(),oe=function(){function e(e){this.alpha=e.alpha}return e.prototype.apply=function(e){var t=this;if(null==e)return this.visibilityFilters=null,null;null!=this.visibilityFilters&&this.visibilityFilters.length===e.length||(this.visibilityFilters=e.map((function(e){return new Z(t.alpha)})));for(var n=[],r=0;r<e.length;++r){var i=e[r],o=l({},i);o.score=this.visibilityFilters[r].apply(i.score),n.push(o)}return n},e}(),ae={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},se={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},le={maxPoses:1,flipHorizontal:!1},ue={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},ce={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},de={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},he={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},fe={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},pe={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},ge={kernelSize:7,minConfidenceToRefine:.5},me={alpha:.1},ve={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},ye={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},xe={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},we={activation:"none"},be={combineWithPreviousRatio:.7},Ce=function(){function e(e){this.mask=e}return e.prototype.toCanvasImageSource=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,x(this.mask)]}))}))},e.prototype.toImageData=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,w(this.mask)]}))}))},e.prototype.toTensor=function(){return u(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.mask]}))}))},e.prototype.getUnderlyingType=function(){return"tensor"},e}();function Se(e){return C(e),"person"}var Te=function(){function e(e,t,n,r,o,a){this.detectorModel=e,this.landmarkModel=t,this.enableSmoothing=n,this.enableSegmentation=r,this.smoothSegmentation=o,this.modelType=a,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(e){null==e.reduceBoxesInLowestLayer&&(e.reduceBoxesInLowestLayer=!1),null==e.interpolatedScaleAspectRatio&&(e.interpolatedScaleAspectRatio=1),null==e.fixedAnchorSize&&(e.fixedAnchorSize=!1);for(var t=[],n=0;n<e.numLayers;){for(var r=[],i=[],o=[],a=[],s=n;s<e.strides.length&&e.strides[s]===e.strides[n];){var l=U(e.minScale,e.maxScale,s,e.strides.length);if(0===s&&e.reduceBoxesInLowestLayer)o.push(1),o.push(2),o.push(.5),a.push(.1),a.push(l),a.push(l);else{for(var u=0;u<e.aspectRatios.length;++u)o.push(e.aspectRatios[u]),a.push(l);if(e.interpolatedScaleAspectRatio>0){var c=s===e.strides.length-1?1:U(e.minScale,e.maxScale,s+1,e.strides.length);a.push(Math.sqrt(l*c)),o.push(e.interpolatedScaleAspectRatio)}}s++}for(var d=0;d<o.length;++d){var h=Math.sqrt(o[d]);r.push(a[d]/h),i.push(a[d]*h)}var f=0,p=0;if(e.featureMapHeight.length>0)f=e.featureMapHeight[n],p=e.featureMapWidth[n];else{var g=e.strides[n];f=Math.ceil(e.inputSizeHeight/g),p=Math.ceil(e.inputSizeWidth/g)}for(var m=0;m<f;++m)for(var v=0;v<p;++v)for(var y=0;y<r.length;++y){var x={xCenter:(v+e.anchorOffsetX)/p,yCenter:(m+e.anchorOffsetY)/f,width:0,height:0};e.fixedAnchorSize?(x.width=1,x.height=1):(x.width=i[y],x.height=r[y]),t.push(x)}n=s}return t}(ae);var s=(0,i.RRF)(this.anchors.map((function(e){return e.width}))),l=(0,i.RRF)(this.anchors.map((function(e){return e.height}))),u=(0,i.RRF)(this.anchors.map((function(e){return e.xCenter}))),c=(0,i.RRF)(this.anchors.map((function(e){return e.yCenter})));this.anchorTensor={x:u,y:c,w:s,h:l},this.prevFilteredSegmentationMask=this.enableSegmentation?(0,i.odF)([],[0,0]):null}return e.prototype.estimatePoses=function(e,t,n){return u(this,void 0,void 0,(function(){var r,o,a,s,u,d,h,p,g,m,v,y,x,w,b,C,S,T,E,R,I,O,A;return c(this,(function(c){switch(c.label){case 0:return r=function(e){var t;if(null==(t=null==e?le:l({},e)).maxPoses&&(t.maxPoses=1),t.maxPoses<=0)throw new Error("Invalid maxPoses "+t.maxPoses+". Should be > 0.");if(t.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return t}(t),null==e?(this.reset(),[2,[]]):(this.maxPoses=r.maxPoses,this.timestamp=null!=n?1e3*n:W(e)?1e6*e.currentTime:null,o=k(e),a=(0,i.lub)((function(){return(0,i.pju)(_(e),"float32")})),null!=(s=this.regionOfInterest)?[3,2]:[4,this.detectPose(a)]);case 1:if(0===(u=c.sent()).length)return this.reset(),a.dispose(),[2,[]];d=u[0],s=this.poseDetectionToRoi(d,o),c.label=2;case 2:return[4,this.poseLandmarksByRoi(s,a)];case 3:return h=c.sent(),a.dispose(),null==h?(this.reset(),[2,[]]):(p=h.landmarks,g=h.auxiliaryLandmarks,m=h.poseScore,v=h.worldLandmarks,y=h.segmentationMask,x=this.poseLandmarkFiltering(p,g,v,o),w=x.actualLandmarksFiltered,b=x.auxiliaryLandmarksFiltered,C=x.actualWorldLandmarksFiltered,S=this.poseLandmarksToRoi(b,o),this.regionOfInterest=S,T=this.smoothSegmentation&&null!=y?this.poseSegmentationFiltering(y):y,null!=(E=null!=w?j(w,o):null)&&E.forEach((function(e,t){e.name=f[t]})),null!=(R=C)&&R.forEach((function(e,t){e.name=f[t]})),I={score:m,keypoints:E,keypoints3D:R},null!==T&&(O=(0,i.lub)((function(){var e=(0,i.dt4)(T,2),t=(0,i.vku)(e,[[0,0],[0,0],[0,1]]);return(0,i.VdP)(t,[[0,0],[0,0],[0,2]],"symmetric")})),this.smoothSegmentation||(0,i.B90)(T),A={maskValueToLabel:Se,mask:new Ce(O)},I.segmentation=A),[2,[I]])}}))}))},e.prototype.poseSegmentationFiltering=function(e){var t=this.prevFilteredSegmentationMask;return 0===t.size?this.prevFilteredSegmentationMask=e:(this.prevFilteredSegmentationMask=function(e,t,n){return"webgl"===(0,i.N_N)()?function(e,t,n){var r=n.combineWithPreviousRatio.toFixed(2),o={variableNames:["prevMask","newMask"],outputShape:e.shape,userCode:"\n  void main() {\n      ivec2 coords = getOutputCoords();\n      int height = coords[0];\n      int width = coords[1];\n\n      float prevMaskValue = getPrevMask(height, width);\n      float newMaskValue = getNewMask(height, width);\n\n      /*\n      * Assume p := newMaskValue\n      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)\n      * uncertainty alpha(p) =\n      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the\n      * uncertainty]\n      *\n      * The following polynomial approximates uncertainty alpha as a\n      * function of (p + 0.5):\n      */\n      const float c1 = 5.68842;\n      const float c2 = -0.748699;\n      const float c3 = -57.8051;\n      const float c4 = 291.309;\n      const float c5 = -624.717;\n      float t = newMaskValue - 0.5;\n      float x = t * t;\n\n      float uncertainty =\n        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));\n\n      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *\n                             (uncertainty * "+r+");\n\n      setOutput(outputValue);\n    }\n"},a=(0,i.y3$)();return(0,i.lub)((function(){var n=a.compileAndRun(o,[e,t]);return(0,i.SRH)().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}))}(e,t,n):(0,i.lub)((function(){var r=(0,i.luU)(t,.5),o=(0,i.h62)(r),a=(0,i.luU)(1,(0,i.LTh)(1,(0,i.dC7)(o,(0,i.IHx)(5.68842,(0,i.dC7)(o,(0,i.IHx)(-.748699,(0,i.dC7)(o,(0,i.IHx)(-57.8051,(0,i.dC7)(o,(0,i.IHx)(291.309,(0,i.dC7)(o,-624.717)))))))))));return(0,i.IHx)(t,(0,i.dC7)((0,i.luU)(e,t),(0,i.dC7)(a,n.combineWithPreviousRatio)))}))}(t,e,be),(0,i.B90)(e)),(0,i.B90)(t),this.prevFilteredSegmentationMask},e.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),(0,i.B90)([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},e.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&((0,i.B90)(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=(0,i.odF)([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},e.prototype.detectPose=function(e){return u(this,void 0,void 0,(function(){var t,n,r,o,a,s,l,u,d,h;return c(this,(function(c){switch(c.label){case 0:return t=B(e,de),n=t.imageTensor,r=t.padding,o=this.detectorModel.predict(n),a=function(e){return(0,i.lub)((function(){var t=function(e){return(0,i.lub)((function(){return[(0,i.tPi)(e,[0,0,0],[1,-1,1]),(0,i.tPi)(e,[0,0,1],[1,-1,-1])]}))}(e),n=t[0],r=t[1];return{boxes:(0,i.L9e)(r),logits:(0,i.L9e)(n)}}))}(o),s=a.boxes,[4,X([l=a.logits,s],this.anchorTensor,ue)];case 1:return 0===(u=c.sent()).length?((0,i.B90)([n,o,l,s]),[2,u]):[4,G(u,this.maxPoses,.3)];case 2:return d=c.sent(),h=function(e,t){void 0===e&&(e=[]);for(var n=t.left,r=t.top,i=t.left+t.right,o=t.top+t.bottom,a=0;a<e.length;a++){var s=e[a],l=s.locationData.relativeBoundingBox,u=(l.xMin-n)/(1-i),c=(l.yMin-r)/(1-o),d=l.width/(1-i),h=l.height/(1-o);l.xMin=u,l.yMin=c,l.width=d,l.height=h,l.xMax=u+d,l.yMax=c+h;var f=s.locationData.relativeKeypoints;f&&f.forEach((function(e){var t=(e.x-n)/(1-i),a=(e.y-r)/(1-o);e.x=t,e.y=a}))}return e}(d,r),(0,i.B90)([n,o,l,s]),[2,h]}}))}))},e.prototype.poseDetectionToRoi=function(e,t){return J(D(e,t,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),t,ce)},e.prototype.poseLandmarksByRoi=function(e,t){return u(this,void 0,void 0,(function(){var n,r,o,a,s,u,d,h,f,p,g,m,v,y;return c(this,(function(c){switch(c.label){case 0:if(n=k(t),r=B(t,he,e),o=r.imageTensor,a=r.padding,s=r.transformationMatrix,"lite"!==this.modelType&&"full"!==this.modelType&&"heavy"!==this.modelType)throw new Error("Model type must be one of lite, full or heavy,but got "+this.modelType);return u=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&u.push("activation_segmentation"),d=this.landmarkModel.execute(o,u),[4,this.tensorsToPoseLandmarksAndSegmentation(d)];case 1:return null==(h=c.sent())?((0,i.B90)(d),(0,i.B90)(o),[2,null]):(f=h.landmarks,p=h.auxiliaryLandmarks,g=h.poseScore,m=h.worldLandmarks,v=h.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(n,e,a,s,f,p,m,v)]);case 2:return y=c.sent(),(0,i.B90)(d),(0,i.B90)(o),[2,l({poseScore:g},y)]}}))}))},e.prototype.poseLandmarksAndSegmentationInverseProjection=function(e,t,n,r,o,a,s,d){return u(this,void 0,void 0,(function(){var u,h,f,p,g,m;return c(this,(function(c){return u=H(o,n),h=H(a,n),f=M(u,t),p=M(h,t),g=function(e,t){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r],a=o.x,s=o.y,u=t.rotation,c=Math.cos(u)*a-Math.sin(u)*s,d=Math.sin(u)*a+Math.cos(u)*s,h=l({},o);h.x=c,h.y=d,n.push(h)}return n}(s,t),m=null,this.enableSegmentation&&(m=(0,i.lub)((function(){var t=d.shape,n=t[0],o=t[1],a=function(e){var t=$(new Array(16).fill(0));t[0][0]=L(e,0,0),t[1][0]=-L(e,0,1),t[2][0]=L(e,0,2),t[3][0]=-L(e,0,3),t[0][2]=L(e,2,0),t[1][2]=-L(e,2,1),t[2][2]=L(e,2,2),t[3][2]=-L(e,2,3),t[0][1]=-L(e,1,0),t[1][1]=L(e,1,1),t[2][1]=-L(e,1,2),t[3][1]=L(e,1,3),t[0][3]=-L(e,3,0),t[1][3]=L(e,3,1),t[2][3]=-L(e,3,2),t[3][3]=L(e,3,3);for(var n=e[0][0]*t[0][0]+e[1][0]*t[0][1]+e[2][0]*t[0][2]+e[3][0]*t[0][3],r=0;r<t.length;r++)for(var i=0;i<t.length;i++)t[r][i]/=n;return t}(r),s=(0,i.odF)(A(a,{width:o,height:n},e),[1,8]),l=[1,n,o,1];return(0,i.L9e)(i.BHj.transform((0,i.XLQ)(d,l),s,"bilinear","constant",0,[e.height,e.width]),[0,3])})),(0,i.B90)(d)),[2,{landmarks:f,auxiliaryLandmarks:p,worldLandmarks:g,segmentationMask:m}]}))}))},e.prototype.tensorsToPoseLandmarksAndSegmentation=function(e){return u(this,void 0,void 0,(function(){var t,n,r,o,a,s,u,d,h,f,p,g,m;return c(this,(function(c){switch(c.label){case 0:return t=e[0],n=e[1],r=e[2],o=e[3],a=this.enableSegmentation?e[4]:null,[4,n.data()];case 1:return(s=c.sent()[0])<.5?[2,null]:[4,Q(t,fe)];case 2:return[4,z(c.sent(),r,ge)];case 3:return u=c.sent(),d=u.slice(0,33),h=u.slice(33,35),[4,Q(o,pe)];case 4:return f=c.sent(),p=f.slice(0,33),g=function(e,t,n){void 0===n&&(n=!0);for(var r=[],i=0;i<e.length;i++){var o=l({},t[i]);n&&(o.score=e[i].score),r.push(o)}return r}(d,p,!0),m=this.enableSegmentation?function(e,t,n){return(0,i.lub)((function(){var n=(0,i.L9e)(e,[0]),r=n.shape[2];if(1===r){var o=n;switch(t.activation){case"none":break;case"sigmoid":o=(0,i.XD2)(o);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+t.activation+")")}var a=o;return(0,i.L9e)(a,[2])}throw new Error("Unsupported number of tensor channels "+r)}))}(a,we):null,[2,{landmarks:d,auxiliaryLandmarks:h,poseScore:s,worldLandmarks:g,segmentationMask:m}]}}))}))},e.prototype.poseLandmarksToRoi=function(e,t){return J(D(V(e),t,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),t,ce)},e.prototype.poseLandmarkFiltering=function(e,t,n,r){var i,o,a;if(null!=this.timestamp&&this.enableSmoothing){var s=D(V(t),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});null==this.visibilitySmoothingFilterActual&&(this.visibilitySmoothingFilterActual=new oe(me)),i=this.visibilitySmoothingFilterActual.apply(e),null==this.visibilitySmoothingFilterAuxiliary&&(this.visibilitySmoothingFilterAuxiliary=new oe(me)),o=this.visibilitySmoothingFilterAuxiliary.apply(t),a=this.visibilitySmoothingFilterActual.apply(n),null==this.landmarksSmoothingFilterActual&&(this.landmarksSmoothingFilterActual=new ie(ve)),i=this.landmarksSmoothingFilterActual.apply(i,this.timestamp,r,!0,s),null==this.landmarksSmoothingFilterAuxiliary&&(this.landmarksSmoothingFilterAuxiliary=new ie(ye)),o=this.landmarksSmoothingFilterAuxiliary.apply(o,this.timestamp,r,!0,s),null==this.worldLandmarksSmoothingFilterActual&&(this.worldLandmarksSmoothingFilterActual=new ie(xe)),a=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}else i=e,o=t,a=n;return{actualLandmarksFiltered:i,auxiliaryLandmarksFiltered:o,actualWorldLandmarksFiltered:a}},e}();function Ee(e){return u(this,void 0,void 0,(function(){var t,n,r,i,a,s;return c(this,(function(u){switch(u.label){case 0:return t=function(e){var t=l({},null==e?se:e);if(null==t.enableSmoothing&&(t.enableSmoothing=se.enableSmoothing),null==t.enableSegmentation&&(t.enableSegmentation=se.enableSegmentation),null==t.smoothSegmentation&&(t.smoothSegmentation=se.smoothSegmentation),null==t.modelType&&(t.modelType=se.modelType),null==t.detectorModelUrl&&(t.detectorModelUrl=se.detectorModelUrl),null==t.landmarkModelUrl)switch(t.modelType){case"lite":t.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":t.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;default:t.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return t}(e),n="string"==typeof t.detectorModelUrl&&t.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r="string"==typeof t.landmarkModelUrl&&t.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([(0,o.YL)(t.detectorModelUrl,{fromTFHub:n}),(0,o.YL)(t.landmarkModelUrl,{fromTFHub:r})])];case 1:return i=u.sent(),a=i[0],s=i[1],[2,new Te(a,s,t.enableSmoothing,t.enableSegmentation,t.smoothSegmentation,t.modelType)]}}))}))}var Re,Ie,ke,Oe=function(){function e(e){!function(e){if(e.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but encountered "+e.maxTracks);if(e.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but encountered "+e.maxAge);if(void 0!==e.keypointTrackerParams){if(e.keypointTrackerParams.keypointConfidenceThreshold<0||e.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+e.keypointTrackerParams.keypointConfidenceThreshold);if(e.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but encountered "+e.keypointTrackerParams.minNumberOfKeypoints);for(var t=0,n=e.keypointTrackerParams.keypointFalloff;t<n.length;t++){var r=n[t];if(r<=0)throw new Error("Must specify each keypoint falloff parameterto be positive but encountered "+r)}}}(e),this.tracks=[],this.maxTracks=e.maxTracks,this.maxAge=1e3*e.maxAge,this.minSimilarity=e.minSimilarity,this.nextID=1}return e.prototype.apply=function(e,t){this.filterOldTracks(t);var n=this.computeSimilarity(e);return this.assignTracks(e,n,t),this.updateTracks(t),e},e.prototype.getTracks=function(){return this.tracks.slice()},e.prototype.getTrackIDs=function(){return new Set(this.tracks.map((function(e){return e.id})))},e.prototype.filterOldTracks=function(e){var t=this;this.tracks=this.tracks.filter((function(n){return e-n.lastTimestamp<=t.maxAge}))},e.prototype.assignTracks=function(e,t,n){for(var r=Array.from(Array(t[0].length).keys()),i=[],o=0,a=Array.from(Array(e.length).keys());o<a.length;o++){var s=a[o];if(0!==r.length){for(var l=-1,u=-1,c=0,d=r;c<d.length;c++){var h=d[c],f=t[s][h];f>=this.minSimilarity&&f>u&&(l=h,u=f)}if(l>=0){var p=this.tracks[l];p=Object.assign(p,this.createTrack(e[s],n,p.id)),e[s].id=p.id;var g=r.indexOf(l);r.splice(g,1)}else i.push(s)}else i.push(s)}for(var m=0,v=i;m<v.length;m++){s=v[m];var y=this.createTrack(e[s],n);this.tracks.push(y),e[s].id=y.id}},e.prototype.updateTracks=function(e){this.tracks.sort((function(e,t){return t.lastTimestamp-e.lastTimestamp})),this.tracks=this.tracks.slice(0,this.maxTracks)},e.prototype.createTrack=function(e,t,n){var r={id:n||this.nextTrackID(),lastTimestamp:t,keypoints:d(e.keypoints).map((function(e){return l({},e)}))};return void 0!==e.box&&(r.box=l({},e.box)),r},e.prototype.nextTrackID=function(){var e=this.nextID;return this.nextID+=1,e},e.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.tracks=this.tracks.filter((function(t){return!e.includes(t.id)}))},e.prototype.reset=function(){this.tracks=[]},e}(),_e=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.prototype.computeSimilarity=function(e){var t=this;return 0===e.length||0===this.tracks.length?[[]]:e.map((function(e){return t.tracks.map((function(n){return t.iou(e,n)}))}))},t.prototype.iou=function(e,t){var n=Math.max(e.box.xMin,t.box.xMin),r=Math.max(e.box.yMin,t.box.yMin),i=Math.min(e.box.xMax,t.box.xMax),o=Math.min(e.box.yMax,t.box.yMax);if(n>=i||r>=o)return 0;var a=(i-n)*(o-r);return a/(e.box.width*e.box.height+t.box.width*t.box.height-a)},t}(Oe),Ae=function(e){function t(t){var n=e.call(this,t)||this;return n.keypointThreshold=t.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=t.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=t.keypointTrackerParams.minNumberOfKeypoints,n}return s(t,e),t.prototype.computeSimilarity=function(e){if(0===e.length||0===this.tracks.length)return[[]];for(var t=[],n=0,r=e;n<r.length;n++){for(var i=r[n],o=[],a=0,s=this.tracks;a<s.length;a++){var l=s[a];o.push(this.oks(i,l))}t.push(o)}return t},t.prototype.oks=function(e,t){for(var n=this.area(t.keypoints)+1e-6,r=0,i=0,o=0;o<e.keypoints.length;++o){var a=e.keypoints[o],s=t.keypoints[o];if(!(a.score<this.keypointThreshold||s.score<this.keypointThreshold)){i+=1;var l=Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2),u=2*this.keypointFalloff[o];r+=Math.exp(-1*l/(2*n*Math.pow(u,2)))}}return i<this.minNumKeyoints?0:r/i},t.prototype.area=function(e){var t=this,n=e.filter((function(e){return e.score>t.keypointThreshold})),r=Math.min.apply(Math,d([1],n.map((function(e){return e.x})))),i=Math.max.apply(Math,d([0],n.map((function(e){return e.x})))),o=Math.min.apply(Math,d([1],n.map((function(e){return e.y}))));return(i-r)*(Math.max.apply(Math,d([0],n.map((function(e){return e.y}))))-o)},t}(Oe);function Pe(e){switch(e){case Ie.BlazePose:return f.reduce((function(e,t,n){return e[t]=n,e}),{});case Ie.PoseNet:case Ie.MoveNet:return h.reduce((function(e,t,n){return e[t]=n,e}),{});default:throw new Error("Model "+e+" is not supported.")}}(ke=Re||(Re={})).Keypoint="keypoint",ke.BoundingBox="boundingBox",function(e){e.MoveNet="MoveNet",e.BlazePose="BlazePose",e.PoseNet="PoseNet"}(Ie||(Ie={})),Object.freeze({__proto__:null,getKeypointIndexBySide:function(e){switch(e){case Ie.BlazePose:return p;case Ie.PoseNet:case Ie.MoveNet:return g;default:throw new Error("Model "+e+" is not supported.")}},getAdjacentPairs:function(e){switch(e){case Ie.BlazePose:return v;case Ie.PoseNet:case Ie.MoveNet:return m;default:throw new Error("Model "+e+" is not supported.")}},getKeypointIndexByName:Pe});var De=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],$e={modelType:"SinglePose.Lightning",enableSmoothing:!0},Fe={},Le={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},Me={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},Ne={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function Be(e,t){var n,r,i,o;return e?t.width>t.height?(n=1,r=t.height/t.width,i=0,o=(t.width/2-t.height/2)/t.width):(n=t.width/t.height,r=1,i=(t.height/2-t.width/2)/t.height,o=0):t.width>t.height?(n=t.width/t.height,r=1,i=(t.height/2-t.width/2)/t.height,o=0):(n=1,r=t.height/t.width,i=0,o=(t.width/2-t.height/2)/t.width),{yMin:i,xMin:o,yMax:i+n,xMax:o+r,height:n,width:r}}function Ue(e,t){var n={maxTracks:e.maxTracks,maxAge:e.maxAge,minSimilarity:e.minSimilarity};return null!=t.maxTracks&&(n.maxTracks=t.maxTracks),null!=t.maxAge&&(n.maxAge=t.maxAge),null!=t.minSimilarity&&(n.minSimilarity=t.minSimilarity),n}var We=function(){function e(e,t){this.moveNetModel=e,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=Pe(Ie.MoveNet),"SinglePose.Lightning"===t.modelType?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):"SinglePose.Thunder"===t.modelType&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel="MultiPose.Lightning"===t.modelType,this.multiPoseModel||(this.keypointFilter=new te(Le),this.cropRegionFilterYMin=new Z(.9),this.cropRegionFilterXMin=new Z(.9),this.cropRegionFilterYMax=new Z(.9),this.cropRegionFilterXMax=new Z(.9)),this.enableSmoothing=t.enableSmoothing,t.minPoseScore?this.minPoseScore=t.minPoseScore:this.minPoseScore=.25,t.multiPoseMaxDimension?this.multiPoseMaxDimension=t.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=t.enableTracking,this.multiPoseModel&&this.enableTracking&&(t.trackerType===Re.Keypoint?this.tracker=new Ae(t.trackerConfig):t.trackerType===Re.BoundingBox&&(this.tracker=new _e(t.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return e.prototype.runSinglePersonPoseModel=function(e){return u(this,void 0,void 0,(function(){var t,n,r,o,a;return c(this,(function(s){switch(s.label){case 0:if(4!==(t=this.moveNetModel.execute(e)).shape.length||1!==t.shape[0]||1!==t.shape[1]||17!==t.shape[2]||3!==t.shape[3])throw t.dispose(),new Error("Unexpected output shape from model: ["+t.shape+"]");return"webgpu"===(0,i.N_N)()?[3,1]:(n=t.dataSync(),[3,3]);case 1:return[4,t.data()];case 2:n=s.sent(),s.label=3;case 3:for(t.dispose(),r={keypoints:[],score:0},o=0,a=0;a<17;++a)r.keypoints[a]={y:n[3*a],x:n[3*a+1],score:n[3*a+2]},r.keypoints[a].score>.2&&(++o,r.score+=r.keypoints[a].score);return o>0&&(r.score/=o),[2,r]}}))}))},e.prototype.runMultiPersonPoseModel=function(e){return u(this,void 0,void 0,(function(){var t,n,r,o,a,s,l,u;return c(this,(function(c){switch(c.label){case 0:if(3!==(t=this.moveNetModel.execute(e)).shape.length||1!==t.shape[0]||56!==t.shape[2])throw t.dispose(),new Error("Unexpected output shape from model: ["+t.shape+"]");return"webgpu"===(0,i.N_N)()?[3,1]:(n=t.dataSync(),[3,3]);case 1:return[4,t.data()];case 2:n=c.sent(),c.label=3;case 3:for(t.dispose(),r=[],o=n.length/56,a=0;a<o;++a)for(r[a]={keypoints:[]},s=56*a+51,r[a].box={yMin:n[s],xMin:n[s+1],yMax:n[s+2],xMax:n[s+3],width:n[s+3]-n[s+1],height:n[s+2]-n[s]},l=56*a+55,r[a].score=n[l],r[a].keypoints=[],u=0;u<17;++u)r[a].keypoints[u]={y:n[56*a+3*u],x:n[56*a+3*u+1],score:n[56*a+3*u+2]};return[2,r]}}))}))},e.prototype.estimatePoses=function(e,t,n){return void 0===t&&(t=Fe),u(this,void 0,void 0,(function(){var r,o,a,s,u,d;return c(this,(function(c){switch(c.label){case 0:return t=function(e){return null==e?Fe:l({},e)}(t),null==e?(this.reset(),[2,[]]):(null==n?W(e)&&(n=1e6*e.currentTime):n*=1e3,r=_(e),o=k(r),a=(0,i.dt4)(r,0),e instanceof i.esB||r.dispose(),s=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(a,o,n)]);case 1:return s=c.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(a,o,n)];case 3:s=c.sent(),c.label=4;case 4:for(u=0;u<s.length;++u)for(d=0;d<s[u].keypoints.length;++d)s[u].keypoints[d].name=h[d],s[u].keypoints[d].y*=o.height,s[u].keypoints[d].x*=o.width;return[2,s]}}))}))},e.prototype.estimateSinglePose=function(e,t,n){return u(this,void 0,void 0,(function(){var r,o,a,s,l=this;return c(this,(function(u){switch(u.label){case 0:return this.cropRegion||(this.cropRegion=Be(null==this.cropRegion,t)),r=(0,i.lub)((function(){var t=(0,i.odF)([[l.cropRegion.yMin,l.cropRegion.xMin,l.cropRegion.yMax,l.cropRegion.xMax]]),n=(0,i.lls)([1],"int32"),r=[l.modelInputResolution.height,l.modelInputResolution.width];return(0,i.pju)(i.BHj.cropAndResize(e,t,n,r,"bilinear",0),"int32")})),e.dispose(),[4,this.runSinglePersonPoseModel(r)];case 1:if(o=u.sent(),r.dispose(),o.score<this.minPoseScore)return this.reset(),[2,[]];for(a=0;a<o.keypoints.length;++a)o.keypoints[a].y=this.cropRegion.yMin+o.keypoints[a].y*this.cropRegion.height,o.keypoints[a].x=this.cropRegion.xMin+o.keypoints[a].x*this.cropRegion.width;return null!=n&&this.enableSmoothing&&(o.keypoints=this.keypointFilter.apply(o.keypoints,n,1)),s=function(e,t,n,r){for(var i={},o=0,a=h;o<a.length;o++){var s=a[o];i[s]=[t[n[s]].y*r.height,t[n[s]].x*r.width]}if(function(e,t){return(e[t.left_hip].score>.2||e[t.right_hip].score>.2)&&(e[t.left_shoulder].score>.2||e[t.right_shoulder].score>.2)}(t,n)){var l=(i.left_hip[0]+i.right_hip[0])/2,u=(i.left_hip[1]+i.right_hip[1])/2,c=function(e,t,n,r,i){for(var o=["left_shoulder","right_shoulder","left_hip","right_hip"],a=0,s=0,l=0;l<o.length;l++)(f=Math.abs(r-n[o[l]][0]))>a&&(a=f),(p=Math.abs(i-n[o[l]][1]))>s&&(s=p);for(var u=0,c=0,d=0,h=Object.keys(n);d<h.length;d++){var f,p,g=h[d];e[t[g]].score<.2||((f=Math.abs(r-n[g][0]))>u&&(u=f),(p=Math.abs(i-n[g][1]))>c&&(c=p))}return[a,s,u,c]}(t,n,i,l,u),d=c[0],f=c[1],p=c[2],g=c[3],m=Math.max(1.9*f,1.9*d,1.2*p,1.2*g),v=[l-(m=Math.min(m,Math.max(u,r.width-u,l,r.height-l))),u-m];if(m>Math.max(r.width,r.height)/2)return Be(null==e,r);var y=2*m;return{yMin:v[0]/r.height,xMin:v[1]/r.width,yMax:(v[0]+y)/r.height,xMax:(v[1]+y)/r.width,height:(v[0]+y)/r.height-v[0]/r.height,width:(v[1]+y)/r.width-v[1]/r.width}}return Be(null==e,r)}(this.cropRegion,o.keypoints,this.keypointIndexByName,t),this.cropRegion=this.filterCropRegion(s),[2,[o]]}}))}))},e.prototype.estimateMultiplePoses=function(e,t,n){return u(this,void 0,void 0,(function(){var r,o,a,s,l,u,d,h,f,p,g,m=this;return c(this,(function(c){switch(c.label){case 0:return t.width>t.height?(o=this.multiPoseMaxDimension,a=Math.round(this.multiPoseMaxDimension*t.height/t.width),r=i.BHj.resizeBilinear(e,[a,o]),l=o,u=32*Math.ceil(a/32),s=(0,i.vku)(r,[[0,0],[0,u-a],[0,0],[0,0]])):(o=Math.round(this.multiPoseMaxDimension*t.width/t.height),a=this.multiPoseMaxDimension,r=i.BHj.resizeBilinear(e,[a,o]),l=32*Math.ceil(o/32),u=a,s=(0,i.vku)(r,[[0,0],[0,0],[0,l-o],[0,0]])),r.dispose(),e.dispose(),d=(0,i.pju)(s,"int32"),s.dispose(),[4,this.runMultiPersonPoseModel(d)];case 1:for(h=c.sent(),d.dispose(),h=h.filter((function(e){return e.score>=m.minPoseScore})),p=0;p<h.length;++p)for(f=0;f<h[p].keypoints.length;++f)h[p].keypoints[f].y*=u/a,h[p].keypoints[f].x*=l/o;if(this.enableTracking&&(this.tracker.apply(h,n),this.enableSmoothing)){for(p=0;p<h.length;++p)this.keypointFilterMap.has(h[p].id)||this.keypointFilterMap.set(h[p].id,new te(Le)),h[p].keypoints=this.keypointFilterMap.get(h[p].id).apply(h[p].keypoints,n,1);g=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach((function(e,t){g.has(t)||m.keypointFilterMap.delete(t)}))}return[2,h]}}))}))},e.prototype.filterCropRegion=function(e){if(e){var t=this.cropRegionFilterYMin.apply(e.yMin),n=this.cropRegionFilterXMin.apply(e.xMin),r=this.cropRegionFilterYMax.apply(e.yMax),i=this.cropRegionFilterXMax.apply(e.xMax);return{yMin:t,xMin:n,yMax:r,xMax:i,height:r-t,width:i-n}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},e.prototype.dispose=function(){this.moveNetModel.dispose()},e.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},e.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},e}();function Ve(e){return void 0===e&&(e=$e),u(this,void 0,void 0,(function(){var t,n,r,a;return c(this,(function(s){switch(s.label){case 0:return t=function(e){var t,n=null==e?$e:l({},e);if(null==n.modelType)n.modelType="SinglePose.Lightning";else if(De.indexOf(n.modelType)<0)throw new Error("Invalid architecture "+n.modelType+". Should be one of "+De);if(null==n.enableSmoothing&&(n.enableSmoothing=!0),null!=n.minPoseScore&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(null!=n.multiPoseMaxDimension&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if("MultiPose.Lightning"===n.modelType&&null==n.enableTracking&&(n.enableTracking=!0),"MultiPose.Lightning"===n.modelType&&!0===n.enableTracking)if(null==n.trackerType&&(n.trackerType=Re.BoundingBox),n.trackerType===Re.Keypoint)null!=n.trackerConfig?n.trackerConfig=function(e){var t=Ue(Me,e);return t.keypointTrackerParams=l({},Me.keypointTrackerParams),null!=e.keypointTrackerParams&&(null!=e.keypointTrackerParams.keypointConfidenceThreshold&&(t.keypointTrackerParams.keypointConfidenceThreshold=e.keypointTrackerParams.keypointConfidenceThreshold),null!=e.keypointTrackerParams.keypointFalloff&&(t.keypointTrackerParams.keypointFalloff=e.keypointTrackerParams.keypointFalloff),null!=e.keypointTrackerParams.minNumberOfKeypoints&&(t.keypointTrackerParams.minNumberOfKeypoints=e.keypointTrackerParams.minNumberOfKeypoints)),t}(n.trackerConfig):n.trackerConfig=Me;else{if(n.trackerType!==Re.BoundingBox)throw new Error("Tracker type not supported by MoveNet");null!=n.trackerConfig?n.trackerConfig=(t=n.trackerConfig,Ue(Ne,t)):n.trackerConfig=Ne}return n}(e),r=!0,t.modelUrl?(r="string"==typeof t.modelUrl&&t.modelUrl.indexOf("https://tfhub.dev")>-1,[4,(0,o.YL)(t.modelUrl,{fromTFHub:r})]):[3,2];case 1:return n=s.sent(),[3,4];case 2:return a=void 0,"SinglePose.Lightning"===t.modelType?a="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":"SinglePose.Thunder"===t.modelType?a="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":"MultiPose.Lightning"===t.modelType&&(a="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,(0,o.YL)(a,{fromTFHub:r})];case 3:n=s.sent(),s.label=4;case 4:return"webgl"===(0,i.N_N)()&&(0,i.OBj)().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new We(n,t)]}}))}))}var Ge={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},je=["MobileNetV1","ResNet50"],ze={MobileNetV1:[8,16],ResNet50:[16]},He=[8,16,32],Xe={MobileNetV1:[.5,.75,1],ResNet50:[1]},qe=[1,2,4],Ke={maxPoses:1,flipHorizontal:!1},Ye={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},Qe=[-123.15,-115.9,-103.06];function Je(e){return Math.floor(e/2)}var Ze=function(){function e(e,t){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=t}return e.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},e.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},e.prototype.empty=function(){return-1===this.numberOfElements},e.prototype.size=function(){return this.numberOfElements+1},e.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},e.prototype.max=function(){return this.priorityQueue[0]},e.prototype.swim=function(e){for(;e>0&&this.less(Je(e),e);)this.exchange(e,Je(e)),e=Je(e)},e.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var t=2*e;if(t<this.numberOfElements&&this.less(t,t+1)&&t++,!this.less(e,t))break;this.exchange(e,t),e=t}},e.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},e.prototype.less=function(e,t){return this.getValueAt(e)<this.getValueAt(t)},e.prototype.exchange=function(e,t){var n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[t],this.priorityQueue[t]=n},e}();function et(e,t,n,r,i,o){for(var a=o.shape,s=a[0],l=a[1],u=!0,c=Math.max(n-i,0),d=Math.min(n+i+1,s),h=c;h<d;++h){for(var f=Math.max(r-i,0),p=Math.min(r+i+1,l),g=f;g<p;++g)if(o.get(h,g,e)>t){u=!1;break}if(!u)break}return u}function tt(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,Promise.all(e.map((function(e){return e.buffer()})))]}))}))}function nt(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+17)}}function rt(e,t,n){var r=nt(e.heatmapY,e.heatmapX,e.id,n),i=r.y,o=r.x;return{x:e.heatmapX*t+o,y:e.heatmapY*t+i}}function it(e,t,n,r){var i=n.x,o=n.y;return e.some((function(e){var n,a,s,l,u=e.keypoints;return n=o,a=i,(s=u[r].y-n)*s+(l=u[r].x-a)*l<=t}))}var ot=h.reduce((function(e,t,n){return e[t]=n,e}),{}),at=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map((function(e){var t=e[0],n=e[1];return[ot[t],ot[n]]})),st=at.map((function(e){return e[1]})),lt=at.map((function(e){return e[0]}));function ut(e,t,n){return e<t?t:e>n?n:e}function ct(e,t,n,r){return{y:ut(Math.round(e.y/t),0,n-1),x:ut(Math.round(e.x/t),0,r-1)}}function dt(e,t){return{x:e.x+t.x,y:e.y+t.y}}function ht(e,t,n,r,i,o,a,s){void 0===s&&(s=2);for(var l=r.shape,u=l[0],c=l[1],d={y:t.y,x:t.x},f=dt(d,function(e,t,n){var r=n.shape[2]/2;return{y:n.get(t.y,t.x,e),x:n.get(t.y,t.x,r+e)}}(e,ct(d,o,u,c),a)),p=0;p<s;p++){var g=ct(f,o,u,c),m=nt(g.y,g.x,n,i);f=dt({x:g.x*o,y:g.y*o},{x:m.x,y:m.y})}var v=ct(f,o,u,c),y=r.get(v.y,v.x,n);return{y:f.y,x:f.x,name:h[n],score:y}}function ft(e,t,n,r,i,o){var a=t.shape[2],s=st.length,l=new Array(a),u=e.part,c=e.score,d=rt(u,r,n);l[u.id]={score:c,name:h[u.id],y:d.y,x:d.x};for(var f=s-1;f>=0;--f){var p=st[f],g=lt[f];l[p]&&!l[g]&&(l[g]=ht(f,l[p],g,t,n,r,o))}for(f=0;f<s;++f)p=lt[f],g=st[f],l[p]&&!l[g]&&(l[g]=ht(f,l[p],g,t,n,r,i));return l}function pt(e,t,n){return n.reduce((function(n,r,i){var o=r.y,a=r.x,s=r.score;return it(e,t,{y:o,x:a},i)||(n+=s),n}),0)/n.length}function gt(e,t,n,r,i,o,a,s){return void 0===a&&(a=.5),void 0===s&&(s=20),u(this,void 0,void 0,(function(){var l,u,d,h,f,p,g,m,v,y,x,w;return c(this,(function(c){switch(c.label){case 0:return[4,tt([e,t,n,r])];case 1:for(l=c.sent(),u=l[0],d=l[1],h=l[2],f=l[3],p=[],g=function(e,t,n){for(var r=n.shape,i=r[0],o=r[1],a=r[2],s=new Ze(i*o*a,(function(e){return e.score})),l=0;l<i;++l)for(var u=0;u<o;++u)for(var c=0;c<a;++c){var d=n.get(l,u,c);d<e||et(c,d,l,u,1,n)&&s.enqueue({score:d,part:{heatmapY:l,heatmapX:u,id:c}})}return s}(a,0,u),m=s*s;p.length<o&&!g.empty();)v=g.dequeue(),y=rt(v.part,i,d),it(p,m,y,v.part.id)||(x=ft(v,u,d,i,h,f),w=pt(p,m,x),p.push({keypoints:x,score:w}));return[2,p]}}))}))}function mt(e,t,n){return(0,i.lub)((function(){var r=function(e,t){for(var n=[],r=0;r<h.length;r++){var o=vt(e.get(r,0).valueOf(),e.get(r,1).valueOf(),r,t),a=o.x,s=o.y;n.push(s),n.push(a)}return(0,i.odF)(n,[h.length,2])}(e,n);return(0,i.IHx)((0,i.pju)((0,i.dC7)(e.toTensor(),(0,i.iD$)(t,"int32")),"float32"),r)}))}function vt(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+h.length)}}function yt(e,t,n){return u(this,void 0,void 0,(function(){var r,o,a,s,l,u,d,f,p,g;return c(this,(function(c){switch(c.label){case 0:return r=0,o=function(e){var t=e.shape,n=t[0],r=t[1],o=t[2];return(0,i.lub)((function(){var t,a,s=(0,i.XLQ)(e,[n*r,o]),l=(0,i.NqF)(s,0),u=(0,i.dt4)((0,i.hiC)(l,(0,i.iD$)(r,"int32")),1),c=(0,i.dt4)((t=l,a=r,(0,i.lub)((function(){var e=(0,i.hiC)(t,(0,i.iD$)(a,"int32"));return(0,i.luU)(t,(0,i.dC7)(e,(0,i.iD$)(a,"int32")))}))),1);return(0,i.zoF)([u,c],1)}))}(e),[4,Promise.all([e.buffer(),t.buffer(),o.buffer()])];case 1:return a=c.sent(),s=a[0],l=a[1],u=a[2],[4,(d=mt(u,n,l)).buffer()];case 2:return f=c.sent(),p=Array.from(function(e,t){for(var n=t.shape[0],r=new Float32Array(n),i=0;i<n;i++){var o=t.get(i,0),a=t.get(i,1);r[i]=e.get(o,a,i)}return r}(s,u)),g=p.map((function(e,t){return r+=e,{y:f.get(t,0),x:f.get(t,1),score:e,name:h[t]}})),o.dispose(),d.dispose(),[2,{keypoints:g,score:r/g.length}]}}))}))}function xt(e,t){return(e-1)%t==0}var wt="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",bt="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function Ct(e,t){return function(e,t){return(e-1)%t==0}(e,t)?e:Math.floor(e/t)*t+1}var St=function(){function e(e,t){this.posenetModel=e;var n=this.posenetModel.inputs[0].shape;i.D5U.assert(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}));var r,o,a=(r=t.inputResolution,o=t.outputStride,{height:Ct(r.height,o),width:Ct(r.width,o)});!function(e){i.D5U.assert(He.indexOf(e)>=0,(function(){return"outputStride of "+e+" is invalid. It must be either 8 or 16."}))}(t.outputStride),function(e,t){i.D5U.assert(xt(e.height,t),(function(){return"height of "+e.height+" is invalid for output stride "+t+"."})),i.D5U.assert(xt(e.width,t),(function(){return"width of "+e.width+" is invalid for output stride "+t+"."}))}(a,t.outputStride),this.inputResolution=a,this.outputStride=t.outputStride,this.architecture=t.architecture}return e.prototype.estimatePoses=function(e,t){return void 0===t&&(t=Ke),u(this,void 0,void 0,(function(){var n,r,o,a,s,u,d,h,f,p,g,m,v,y,x;return c(this,(function(c){switch(c.label){case 0:return n=function(e){var t=e;if(null==t.maxPoses&&(t.maxPoses=1),t.maxPoses<=0)throw new Error("Invalid maxPoses "+t.maxPoses+". Should be > 0.");if(t.maxPoses>1){if((t=l(l({},Ye),t)).scoreThreshold<0||t.scoreThreshold>1)throw new Error("Invalid scoreThreshold "+t.scoreThreshold+". Should be in range [0.0, 1.0]");if(t.nmsRadius<=0)throw new Error("Invalid nmsRadius "+t.nmsRadius+".")}return t}(t),null==e?[2,[]]:(this.maxPoses=n.maxPoses,r=B(e,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),o=r.imageTensor,a=r.padding,s="ResNet50"===this.architecture?(0,i.IHx)(o,Qe):N(o,[-1,1]),u=this.posenetModel.predict(s),"ResNet50"===this.architecture?(d=(0,i.L9e)(u[2],[0]),h=(0,i.L9e)(u[3],[0]),f=(0,i.L9e)(u[0],[0]),p=(0,i.L9e)(u[1],[0])):(d=(0,i.L9e)(u[0],[0]),h=(0,i.L9e)(u[1],[0]),f=(0,i.L9e)(u[2],[0]),p=(0,i.L9e)(u[3],[0])),g=(0,i.XD2)(h),1!==this.maxPoses?[3,2]:[4,yt(g,d,this.outputStride)]);case 1:return v=c.sent(),m=[v],[3,4];case 2:return[4,gt(g,d,f,p,this.outputStride,this.maxPoses,n.scoreThreshold,n.nmsRadius)];case 3:m=c.sent(),c.label=4;case 4:return y=k(e),x=function(e,t,n,r){var i=t.height,o=t.width,a=i/(n.height*(1-r.top-r.bottom)),s=o/(n.width*(1-r.left-r.right)),l=-r.top*n.height,u=-r.left*n.width;if(1===s&&1===a&&0===l&&0===u)return e;for(var c=0,d=e;c<d.length;c++)for(var h=0,f=d[c].keypoints;h<f.length;h++){var p=f[h];p.x=(p.x+u)*s,p.y=(p.y+l)*a}return e}(m,y,this.inputResolution,a),n.flipHorizontal&&(x=function(e,t){for(var n=0,r=e;n<r.length;n++)for(var i=0,o=r[n].keypoints;i<o.length;i++){var a=o[i];a.x=t.width-1-a.x}return e}(x,y)),o.dispose(),s.dispose(),(0,i.B90)(u),d.dispose(),h.dispose(),f.dispose(),p.dispose(),g.dispose(),[2,x]}}))}))},e.prototype.dispose=function(){this.posenetModel.dispose()},e.prototype.reset=function(){},e}();function Tt(e){return void 0===e&&(e=Ge),u(this,void 0,void 0,(function(){var t,n,r,i,a;return c(this,(function(s){switch(s.label){case 0:return"ResNet50"!==(t=function(e){var t=e||Ge;if(null==t.architecture&&(t.architecture="MobileNetV1"),je.indexOf(t.architecture)<0)throw new Error("Invalid architecture "+t.architecture+". Should be one of "+je);if(null==t.inputResolution&&(t.inputResolution={height:257,width:257}),null==t.outputStride&&(t.outputStride=16),ze[t.architecture].indexOf(t.outputStride)<0)throw new Error("Invalid outputStride "+t.outputStride+". Should be one of "+ze[t.architecture]+" for architecture "+t.architecture+".");if(null==t.multiplier&&(t.multiplier=1),Xe[t.architecture].indexOf(t.multiplier)<0)throw new Error("Invalid multiplier "+t.multiplier+". Should be one of "+Xe[t.architecture]+" for architecture "+t.architecture+".");if(null==t.quantBytes&&(t.quantBytes=4),qe.indexOf(t.quantBytes)<0)throw new Error("Invalid quantBytes "+t.quantBytes+". Should be one of "+qe+" for architecture "+t.architecture+".");if("MobileNetV1"===t.architecture&&32===t.outputStride&&1!==t.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return t}(e)).architecture?[3,2]:(l=t.outputStride,u=t.quantBytes,c="model-stride"+l+".json",n=4===u?bt+"float/"+c:bt+"quant"+u+"/"+c,[4,(0,o.YL)(t.modelUrl||n)]);case 1:return r=s.sent(),[2,new St(r,t)];case 2:return i=function(e,t,n){var r={1:"100",.75:"075",.5:"050"},i="model-stride"+e+".json";return 4===n?wt+"float/"+r[t]+"/"+i:wt+"quant"+n+"/"+r[t]+"/"+i}(t.outputStride,t.multiplier,t.quantBytes),[4,(0,o.YL)(t.modelUrl||i)];case 3:return a=s.sent(),[2,new St(a,t)]}var l,u,c}))}))}function Et(e,t){return u(this,void 0,void 0,(function(){var n,r;return c(this,(function(i){switch(e){case Ie.PoseNet:return[2,Tt(t)];case Ie.BlazePose:if(r=void 0,null!=(n=t)){if("tfjs"===n.runtime)return[2,Ee(t)];if("mediapipe"===n.runtime)return[2,I(t)];r=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+r);case Ie.MoveNet:return[2,Ve(t)];default:throw new Error(e+" is not a supported model name.")}}))}))}},1221:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addImpl:()=>p,bincountImpl:()=>m,bincountReduceImpl:()=>v,castImpl:()=>c,ceilImpl:()=>b,concatImpl:()=>C,equalImpl:()=>S,expImpl:()=>T,expm1Impl:()=>E,floorImpl:()=>R,gatherNdImpl:()=>I,gatherV2Impl:()=>k,greaterEqualImpl:()=>_,greaterImpl:()=>O,lessEqualImpl:()=>P,lessImpl:()=>A,linSpaceImpl:()=>D,logImpl:()=>$,maxImpl:()=>F,maximumImpl:()=>L,minimumImpl:()=>M,multiplyImpl:()=>N,negImpl:()=>U,notEqualImpl:()=>W,prodImpl:()=>G,raggedGatherImpl:()=>z,raggedRangeImpl:()=>H,raggedTensorToTensorImpl:()=>Q,rangeImpl:()=>J,rsqrtImpl:()=>Z,scatterImpl:()=>ee,sigmoidImpl:()=>te,simpleAbsImpl:()=>o,sliceImpl:()=>ne,sparseFillEmptyRowsImpl:()=>re,sparseReshapeImpl:()=>ie,sparseSegmentReductionImpl:()=>oe,sqrtImpl:()=>ae,squaredDifferenceImpl:()=>se,stridedSliceImpl:()=>le,stringNGramsImpl:()=>ce,stringSplitImpl:()=>he,stringToHashBucketFastImpl:()=>fe,subImpl:()=>pe,tileImpl:()=>me,topKImpl:()=>xe,transposeImpl:()=>V,uniqueImpl:()=>we});var r=n(88478);function i(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&r.D5U.assert("complex64"!==e.dtype,(()=>`${t} does not support complex64 tensors in the CPU backend.`))}))}function o(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}function a(e){return(t,n,i,o,a)=>{const s=r.Wap.assertAndGetBroadcastShape(t,n),l=s.length,u=r.D5U.computeStrides(s),c=r.D5U.sizeFromShape(s),d=r.D5U.getTypedArrayFromDType(a,c),h=t.length,f=n.length,p=r.D5U.computeStrides(t),g=r.D5U.computeStrides(n),m=r.Wap.getBroadcastDims(t,s),v=r.Wap.getBroadcastDims(n,s);if(m.length+v.length===0)for(let t=0;t<d.length;++t)d[t]=e(i[t%i.length],o[t%o.length]);else for(let t=0;t<d.length;++t){const n=r.D5U.indexToLoc(t,l,u),a=n.slice(-h);m.forEach((e=>a[e]=0));const s=r.D5U.locToIndex(a,h,p),c=n.slice(-f);v.forEach((e=>c[e]=0));const y=r.D5U.locToIndex(c,f,g);d[t]=e(i[s],o[y])}return[d,s]}}function s(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",o),imag:n.makeTensorInfo(i.shape,"float32",a)},s}function l(e,t,n="float32"){if("complex64"===n)return s({inputs:{real:l(e,t,"float32"),imag:l(e,t,"float32")},backend:e});const i=r.D5U.makeZerosTypedArray(r.D5U.sizeFromShape(t),n);return e.makeTensorInfo(t,n,i)}function u(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function c(e,t,n,i){if("int32"===i)return[t,"int32",Int32Array.from(e)];if("bool"===i){const i=r.D5U.toTypedArray([0],n),[o,s]=a(((e,t)=>e!==t?1:0))(t,[],e,i,"bool");return[s,"bool",o]}throw new Error(`Error in Cast: failed to cast ${n} to ${i}`)}function d(e){const{inputs:t,backend:n,attrs:i}=e,{x:o}=t,{dtype:a}=i;if("complex64"===a){if("complex64"===o.dtype)return u({inputs:{x:o},backend:n});const e=l(n,o.shape,o.dtype),t=d({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),r=s({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===o.dtype){const e=function(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.real,o=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,o)}({inputs:{input:o},backend:n}),t=d({inputs:{x:e},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(e),t}if(!r.D5U.hasEncodingLoss(o.dtype,a)){const e=u({inputs:{x:o},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:a}}const h=n.data.get(o.dataId).values,[f,p,g]=c(h,o.shape,o.dtype,a);return n.makeTensorInfo(f,p,g)}function h(e,t,n,o){return null==n?({inputs:n,backend:a})=>{const{a:s,b:l}=n,u=a;i([s,l],e);const c=u.data.get(s.dataId).values,d=u.data.get(l.dataId).values,h="string"===s.dtype?r.Wap.fromUint8ToStringArray(c):c,f="string"===s.dtype?r.Wap.fromUint8ToStringArray(d):d,p=o||s.dtype,[g,m]=t(s.shape,l.shape,h,f,p);return u.makeTensorInfo(m,p,g)}:({inputs:e,backend:r})=>{const{a:i,b:a}=e,l=r;if("complex64"===i.dtype||"complex64"===a.dtype){const e=d({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),t=l.data.get(e.dataId),r=t.complexTensorInfos.real,o=t.complexTensorInfos.imag,u=l.data.get(r.dataId).values,c=l.data.get(o.dataId).values,h=d({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),f=l.data.get(h.dataId),p=f.complexTensorInfos.real,g=f.complexTensorInfos.imag,m=l.data.get(p.dataId).values,v=l.data.get(g.dataId).values,[y,x,w]=n(i.shape,a.shape,u,c,m,v),b=l.makeTensorInfo(w,"float32",y),C=l.makeTensorInfo(w,"float32",x),S=s({inputs:{real:b,imag:C},backend:l});return l.disposeIntermediateTensorInfo(e),l.disposeIntermediateTensorInfo(h),l.disposeIntermediateTensorInfo(b),l.disposeIntermediateTensorInfo(C),S}{const e=l.data.get(i.dataId).values,n=l.data.get(a.dataId).values,r=o||i.dtype,[s,u]=t(i.shape,a.shape,e,n,r);return l.makeTensorInfo(u,r,s)}}}function f(e){return(t,n,i,o,a,s)=>{const l=r.Wap.assertAndGetBroadcastShape(t,n),u=r.D5U.sizeFromShape(l),c=l.length,d=r.D5U.computeStrides(l),h=r.D5U.getTypedArrayFromDType("float32",u),f=r.D5U.getTypedArrayFromDType("float32",u),p=r.Wap.getBroadcastDims(t,l),g=r.Wap.getBroadcastDims(n,l),m=r.Wap.mergeRealAndImagArrays(i,o),v=r.Wap.mergeRealAndImagArrays(a,s),y=t.length,x=r.D5U.computeStrides(t),w=n.length,b=r.D5U.computeStrides(n);if(p.length+g.length===0)for(let t=0;t<h.length;t++){const n=t%m.length,r=t%v.length,i=e(m[2*n],m[2*n+1],v[2*r],v[2*r+1]);h[t]=i.real,f[t]=i.imag}else for(let t=0;t<h.length;t++){const n=r.D5U.indexToLoc(t,c,d),i=n.slice(-y);p.forEach((e=>i[e]=0));const o=r.D5U.locToIndex(i,y,x),a=n.slice(-w);g.forEach((e=>a[e]=0));const s=r.D5U.locToIndex(a,w,b),l=e(m[2*o],m[2*o+1],v[2*s],v[2*s+1]);h[t]=l.real,f[t]=l.imag}return[h,f,l]}}r.SYM,r.Zz9,r.iJz,r.xJR,r.RFZ;const p=a(((e,t)=>e+t)),g=f(((e,t,n,r)=>({real:e+n,imag:t+r})));function m(e,t,n,i,o){const a=r.D5U.sizeFromShape(i),s=r.D5U.makeZerosTypedArray(o,n);for(let n=0;n<e.length;n++){const r=e[n];if(r<0)throw new Error("Input x must be non-negative!");r>=o||(s[r]+=a>0?t[n]:1)}return s}function v(e,t,n,i=!1){const o=e.shape[0],a=e.shape[1],s=(0,r.f3b)([o,n],t.dtype);for(let r=0;r<o;r++)for(let o=0;o<a;o++){const a=e.get(r,o);if(a<0)throw new Error("Input x must be non-negative!");a>=n||(i?s.set(1,r,a):t.size>0?s.set(s.get(r,a)+t.get(r,o),r,a):s.set(s.get(r,a)+1,r,a))}return s}function y(e){return(t,n,i)=>{const o=r.D5U.getTypedArrayFromDType(n,t.length);for(let n=0;n<t.length;++n)o[n]=e(t[n],i);return o}}function x(e,t,n){return({inputs:o,attrs:a,backend:s})=>{const{x:l}=o;if(i(l,e),"string"===l.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const u=s,c=u.data.get(l.dataId).values,d=r.D5U.sizeFromShape(l.shape),h=n||l.dtype,f=r.D5U.getArrayFromDType(h,d);for(let e=0;e<d;++e)f[e]=t(c[e],a);return u.makeTensorInfo(l.shape,h,f)}}function w(e,t,n){return({inputs:r,attrs:o,backend:a})=>{const{x:s}=r;if(i(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const l=a,u=l.data.get(s.dataId).values,c=n||s.dtype,d=t(u,c,o);return l.makeTensorInfo(s.shape,c,d)}}h(r.mm_,p,g),r.mm_;const b=y((e=>Math.ceil(e)));function C(e,t,n,i){const o=r.D5U.getArrayFromDType(n,r.D5U.sizeFromShape(t));if(i&&"string"!==n){let t=0;e.forEach((e=>{const n=r.D5U.sizeFromShape(e.shape);o.set(e.vals,t),t+=n}))}else{let i=0;e.forEach((e=>{const a="string"===n?r.Wap.fromUint8ToStringArray(e.vals):e.vals;let s=0;for(let n=0;n<e.shape[0];++n){const r=n*t[1]+i;for(let t=0;t<e.shape[1];++t)o[r+t]=a[s++]}i+=e.shape[1]}))}return o}w(r.gJX,b),r.gJX;const S=a(((e,t)=>e===t?1:0)),T=(h(r.hdR,S,null,"bool"),r.hdR,y((e=>Math.exp(e)))),E=(w(r.NEP,T,"float32"),r.NEP,y((e=>Math.expm1(e)))),R=(w(r.Y0y,E),r.Y0y,y((e=>Math.floor(e))));function I(e,t,n,i,o,a,s,l,u){const c=(0,r.f3b)([i,a],n);for(let n=0;n<i;n++){const r=[];let i=0;for(let t=0;t<o;t++){const a=e[n*o+t];i+=a*s[t],r.push(a)}if(i<0||i>=u/a)throw new Error(`Invalid indices: ${r} does not index into ${l}`);for(let e=0;e<a;e++)c.values[n*a+e]=t.get(...t.indexToLoc(i*a+e))}return c}function k(e,t,n){const i=(0,r.f3b)(n,e.dtype);for(let n=0;n<i.size;++n){const r=i.indexToLoc(n).slice(),o=r[0],a=r[2],s=t.locToIndex([o,a]);r[2]=t.values[s];const l=e.locToIndex(r);0<=l&&l<e.values.length&&(i.values[n]=e.values[l])}return i}w(r.OR,R),r.OR;const O=a(((e,t)=>e>t?1:0)),_=(h(r.iZT,O,null,"bool"),r.iZT,a(((e,t)=>e>=t?1:0))),A=(h(r.Acj,_,null,"bool"),r.Acj,a(((e,t)=>e<t?1:0))),P=(h(r.vtC,A,null,"bool"),r.vtC,a(((e,t)=>e<=t?1:0)));function D(e,t,n){const i=(t-e)/(n-1),o=r.D5U.makeZerosTypedArray(n,"float32");o[0]=e;for(let e=1;e<o.length;e++)o[e]=o[e-1]+i;return o}h(r.CAk,P,null,"bool"),r.CAk;const $=y((e=>Math.log(e)));function F(e,t,n,i){const o=r.D5U.getTypedArrayFromDType(i,r.D5U.sizeFromShape(n));for(let n=0;n<o.length;++n){const r=n*t;let i=e[r];for(let n=0;n<t;++n){const t=e[r+n];(Number.isNaN(t)||t>i)&&(i=t)}o[n]=i}return o}w(r.ZbH,$),r.ZbH;const L=a(((e,t)=>Math.max(e,t))),M=(h(r.BMI,L),r.BMI,a(((e,t)=>Math.min(e,t)))),N=(h(r.q8u,M),r.q8u,a(((e,t)=>e*t))),B=f(((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})));function U(e,t,n){const i=r.D5U.createScalarValue(-1,n);return N([],t,i,e,n)}h(r.wYn,N,B),r.wYn,r.kuV;const W=a(((e,t)=>e!==t?1:0));function V(e,t,n,i,o){const a=t.length,s=r.D5U.sizeFromShape(t),l=r.D5U.computeStrides(t),u=r.D5U.computeStrides(o),c=r.D5U.getTypedArrayFromDType(n,r.D5U.sizeFromShape(o));for(let t=0;t<s;++t){const n=r.D5U.indexToLoc(t,a,l),o=new Array(n.length);for(let e=0;e<o.length;e++)o[e]=n[i[e]];c[r.D5U.locToIndex(o,a,u)]=e[t]}return c}function G(e,t,n,i){const[o,a]=r.Wap.computeOutAndReduceShapes(e,i),s=(0,r.x8V)(t,"int32"),l=r.D5U.makeZerosTypedArray(r.D5U.sizeFromShape(o),s),u=r.D5U.sizeFromShape(a);for(let e=0;e<l.length;++e){const t=e*u;let r=1;for(let e=0;e<u;++e)r*=n[t+e];l[e]=r}return{outVals:l,outShape:o,outDtype:s}}function j(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function z(e,t,n,i,o,a,s,l){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach(((e,i)=>{if(e<0||e>=n){const o=r.D5U.indexToLoc(i,t.length,r.D5U.computeStrides(t)).join(",");throw new Error(`indices[${o}] = ${e} is not in [0, ${n})`)}}))}(a,s,t[0][0]-1),0===i.length)throw new Error("params.rank must be nonzero");const u=i[0],{outSplits:c,valueSlices:d,numValues:h}=function(e,t,n,r){const i=[];let o=0;const a=t.length-1+n.length,s=new Array(a).fill(null).map((()=>[0]));!function(e,t){for(let n=0;n<e.length;++n){const r=e[n],i=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let e=1;e<r.length;++e)if(r[e-1]>r[e])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);let l=1;for(let e=0;e<t.length-1;++e){l*=t[e];const n=t[e+1];for(let t=1;t<l+1;++t)s[e].push(t*n)}for(let r=0;r<e.length;++r){let a=e[r],l=e[r]+1;for(let e=0;e<n.length;++e){const r=n[e],i=e+t.length-1;if(i>=0){const e=s[i],t=e[e.length-1]-r[a];for(let e=a;e<l;++e)s[i].push(r[e+1]+t)}a=r[a],l=r[l]}l!==a&&(i.push([a,l]),o+=l-a)}return{outSplits:s,valueSlices:i,numValues:o}}(a,s,e,u),f=function(e){const t=[];for(let n=0;n<e.length;++n){const i=e[n].length,o=r.D5U.getArrayFromDType("int32",i);t.push(o),e[n].forEach(((e,t)=>o[t]=e))}return t}(c),p=function(e,t,n,i,o){const a=t.slice();a[0]=o;const s=r.D5U.getArrayFromDType(n,r.D5U.sizeFromShape(a)),l=e.length;return function(e,t,n,r,i,o){const a=j(t,2)[1],s=j(o,2)[1];let l=0;for(const t of n)for(let n=t[0];n<t[1];++n){for(let t=0;t<r;++t)i[l*s+t]=e[n*a+t];++l}}(e,t,i,0===l?0:l/t[0],s,a),[s,a]}(n,i,o,d,h);return[f,p[0],p[1]]}h(r.yQU,W,null,"bool"),r.yQU,r.G3Y,r.DlI;function H(e,t,n,i,o,a,s){if(t.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");const l=0===t.length,u=0===o.length,c=0===s.length,d=[];l||d.push(t[0]),u||d.push(o[0]),c||d.push(s[0]);for(let e=1;e<d.length;++e)if(d[e]!==d[e-1])throw new Error("starts, limits, and deltas must have the same shape");const h=0===d.length?1:d[0],f=r.D5U.getArrayFromDType("int32",h+1);f[0]=0;for(let t=0;t<h;++t){const n=l?e[0]:e[t],r=u?i[0]:i[t],o=c?a[0]:a[t];if(0===o)throw new Error("Requires delta != 0");let s;if(o>0&&r<n||o<0&&r>n)s=0;else if(s=Math.ceil(Math.abs((r-n)/o)),s>2147483647)throw new Error("Requires ((limit - start) / delta) <= 2147483647");f[t+1]=f[t]+s}const p=f[h],g=r.D5U.getArrayFromDType(n,p);let m=0;for(let t=0;t<h;++t){const n=f[t+1]-f[t];let r=l?e[0]:e[t];const i=c?a[0]:a[t];for(let e=0;e<n;++e)g[m++]=r,r+=i}return[f,g]}var X=r.Wap.RowPartitionType;class q{constructor(e,t,n,i,o,a,s,l,u,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=i,this.valuesDType=o,this.defaultValue=a,this.defaultValueShape=s,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=r.Wap.getRowPartitionTypesHelper(c),this.raggedRank=r.Wap.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===X.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===X.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case X.VALUE_ROWIDS:return q.getMaxWidthValueRowID(t);case X.ROW_SPLITS:return q.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${X[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(0===t||1===t)return 0;let n=0;for(let r=0;r<t-1;++r){const t=e[r+1]-e[r];t>n&&(n=t)}return n}static getMaxWidthValueRowID(e){const t=e.length;if(0===t)return 0;let n=0,r=e[0],i=0;for(let o=1;o<t;++o){const t=e[o];t!==r&&(r=t,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)}tensorShapeFromTensor(e,t,n=!0){if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Y(e,n)}calculateOutputSize(e){const t=this.valuesShape,n=this.defaultValueShape;r.Wap.validateDefaultValueShape(n,t);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=r.Wap.combineRaggedTensorToTensorShapes(this.raggedRank,i,t);o[0]<0&&(o[0]=e);for(let e=1;e<=this.raggedRank;++e)o[e]<0&&(o[e]=this.getMaxWidth(e));return o}calculateFirstParentOutputIndex(e,t,n){const i=Math.min(e,n),o=[];let a=0;for(let e=0;e<i;++e,a+=t)o.push(a);for(let t=i;t<e;++t)o.push(-1);return r.D5U.assert(o.length===e,(()=>"Final length of result must be equal to firstDimension.")),o}calculateOutputIndexRowSplit(e,t,n,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const i=e[a+1]-e[a];let s=Math.min(r,i),l=t[a];-1===l&&(s=0);for(let e=0;e<s;++e)o.push(l),l+=n;for(let e=0;e<i-s;++e)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,n,r){const i=e.length,o=[];if(0===i)return[];let a=0,s=e[0];if(s>=t.length)throw new Error(`Got currentValueRowId=${s}, which is not less than ${t.length}`);let l=t[s];o.push(l);for(let u=1;u<i;++u){const i=e[u];if(i===s)l>=0&&(++a,a<r?l+=n:l=-1);else{if(a=0,s=i,i>=t.length)throw new Error(`Got nextValueRowId=${i} which is not less than ${t.length}`);l=t[i]}o.push(l)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,n,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case X.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,r);case X.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,n,r);default:throw new Error(`Unsupported partition type: ${X[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case X.FIRST_DIM_SIZE:return e[0];case X.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case X.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${X[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(let e=n.length-2;e>=0;--e)n[e]=n[e+1]*t[e+1];const i=Y(t,!1),o=r.D5U.getArrayFromDType(this.valuesDType,r.D5U.sizeFromShape(i));if(n[0]*t[0]>0){let r=this.calculateFirstParentOutputIndex(e,n[0],t[0]);for(let e=1;e<=this.raggedRank;++e)r=this.calculateOutputIndex(e-1,r,n[e],t[e]);this.setOutput(this.raggedRank,r,o,i)}return[i,o]}setOutput(e,t,n,i){if(0===n.length)return;const o=this.values,a=n;let s=i.slice();s=s.slice(e+1);const l=r.D5U.sizeFromShape(s),u=t.length;let c=this.defaultValue;if(c.length!==l&&1!==c.length){const e=this.defaultValueShape;(0,r.lub)((()=>{const t=(0,r.XLQ)(c,e),n=(0,r.UFq)(t,s);c=n.dataSync()}))}let d=0,h=0,f=0;for(let e=0;e<=u;++e){let r=e<u?t[e]:-1;if(r!==f){if(h<f){const e=o.subarray(d*l);K(a.subarray(h*l),e,(f-h)*l)}if(e>=u){const e=n.length;r=Math.floor(e/l)}if(r>f)if(1===this.defaultValue.length)a.subarray(f*l,r*l).fill(this.defaultValue[0]),f=r;else for(;r>f;)K(a.slice(f*l),c,l),++f;r<0?(d=e+1,h=f):(d=e,h=f,f=h+1)}else++f}}}function K(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function Y(e,t){const n=[];for(let r of e){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function Q(e,t,n,r,i,o,a,s,l,u){return new q(e,t,n,r,i,o,a,s,l,u).compute()}function J(e,t,n,i){if(e===t||e<t&&n<0||t<e&&n>1)return r.D5U.makeZerosTypedArray(0,i);const o=Math.abs(Math.ceil((t-e)/n)),a=r.D5U.makeZerosTypedArray(o,i);t<e&&1===n&&(n=-1),a[0]=e;for(let e=1;e<a.length;e++)a[e]=a[e-1]+n;return a}const Z=y((e=>1/Math.sqrt(e)));function ee(e,t,n,i,o,a,s,l,u,c){const d=[i/o,o],h=e.values,f=t.values;if(0===i)return(0,r.f3b)(n,t.dtype);const p=(0,r.f3b)(d,t.dtype);"string"==typeof u||"number"==typeof u?p.values.fill(u):"boolean"==typeof u&&p.values.fill(+u);for(let e=0;e<a;e++){const r=[];let a=0;for(let t=0;t<s;t++){const n=h[e*s+t];r.push(n),a+=n*l[t]}if(a<0||a>=i/o)throw new Error(`Invalid indices: ${r} does not index into ${n}`);for(let n=0;n<o;n++)c?p.values[a*o+n]+=f[e*o+n]:p.values[a*o+n]=0===t.rank?f[0]:f[e*o+n]}return p}w(r.bV0,Z),r.bV0;const te=y((e=>1/(1+Math.exp(-e))));function ne(e,t,n,i,o){const a=r.kuN.isSliceContinous(i,t,n),s=r.D5U.sizeFromShape(n),l=r.D5U.computeStrides(i);if(a){const n=r.kuN.computeFlatOffset(t,l);return"string"===o?e.slice(n,n+s):e.subarray(n,n+s)}const u="string"===o?r.Wap.fromUint8ToStringArray(e):e,c=(0,r.f3b)(i,o,u),d=(0,r.f3b)(n,o);for(let e=0;e<d.size;++e){const n=d.indexToLoc(e),r=n.map(((e,n)=>e+t[n]));d.set(c.get(...r),...n)}return"string"===o?r.Wap.fromStringArrayToUint8(d.values):d.values}function re(e,t,n,i,o,a,s){const l=t[0],u=a[0],c=new Array(u),d=new Array(l),h=t[1];if(0===u){if(0!==l)throw new Error(r.Wap.getSparseFillEmptyRowsIndicesDenseShapeMismatch(l));return[r.D5U.getArrayFromDType(n,0),[0,h],r.D5U.getArrayFromDType(o,0),c,d]}let f=!0,p=0;const g=new Array(u).fill(0);for(let t=0;t<l;++t){const n=e[t*h];if(n<0)throw new Error(r.Wap.getSparseFillEmptyRowsNegativeIndexErrorMessage(t,n));if(n>=u)throw new Error(r.Wap.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(t,n,u));++g[n],f=f&&n>=p,p=n}let m=!0;for(let e=0;e<u;++e){const t=0===g[e];c[e]=t,m=m&&!t,g[e]=Math.max(g[e],1),e>0&&(g[e]+=g[e-1])}if(m&&f){const t=e,n=i;for(let e=0;e<l;++e)d[e]=e;return[t,[l,h],n,c,d]}{const t=g[u-1],a=r.D5U.getArrayFromDType(n,t*h),f=r.D5U.getArrayFromDType(o,t),p=new Array(u).fill(0);for(let t=0;t<l;++t){const n=e[t*h],r=p[n],o=(0===n?0:g[n-1])+r;p[n]++;for(let n=0;n<h;++n)a[o*h+n]=e[t*h+n];f[o]=i[t],d[t]=o}for(let e=0;e<u;++e)if(0===p[e]){const t=0===e?0:g[e-1];a[t*h+0]=e;for(let e=1;e<h;++e)a[t*h+e]=0;f[t]=s}return[a,[t,h],f,c,d]}}function ie(e,t,n,i,o){const a=r.D5U.sizeFromShape(i),s=t[0],l=o.length,u=[];let c=1,d=-1;for(let e=0;e<l;++e){const t=o[e];if(-1===t){if(-1!==d)throw new Error(r.Wap.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(d,e));d=e,u.push(1)}else{if(t<0)throw new Error(r.Wap.getSparseReshapeNegativeOutputDimErrorMessage(e,t));c*=t,u.push(t)}}if(-1!==d){if(c<=0)throw new Error(r.Wap.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());const e=Math.trunc(a/c);if(c*e!==a)throw new Error(r.Wap.getSparseReshapeInputOutputMultipleErrorMessage(i,u));u[d]=e}if(r.D5U.sizeFromShape(u)!==a)throw new Error(r.Wap.getSparseReshapeInputOutputMismatchErrorMessage(i,u));const h=i.length,f=[];if(h>0){f[h-1]=1;for(let e=h-2;e>=0;--e)f[e]=f[e+1]*i[e+1]}const p=[];if(l>0){p[l-1]=1;for(let e=l-2;e>=0;--e)p[e]=p[e+1]*u[e+1]}const g=r.D5U.getArrayFromDType(n,s*l);for(let t=0;t<s;++t){let n=0;for(let r=0;r<h;++r)n+=e[t*h+r]*f[r];for(let e=0;e<l;++e)g[t*l+e]=Math.trunc(n/p[e]),n%=p[e]}return[g,[s,l],u]}function oe(e,t,n,i,o,a=!1,s=0){const l=i.length,u=[t[0],e.length/t[0]],c=u[1],d=l>0?o[l-1]+1:0;if(d<0)throw new Error(r.Wap.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());const h=t.slice();h[0]=d;const f=h.reduce(((e,t)=>e*t),1),p=r.D5U.getArrayFromDType(n,f);if(0===l)return d>0&&p.fill(s),[p,h];if(d<=0)throw new Error(r.Wap.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let g=0,m=1,v=0,y=o[g];for(;;){let t=0;if(m<l){if(t=o[m],y===t){++m;continue}if(y>=t)throw new Error(r.Wap.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=d)throw new Error(r.Wap.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,d));y>v&&p.fill(s,v*c,y*c);for(let t=g;t<m;++t){const n=i[t];if(n<0||n>=u[0])throw new Error(r.Wap.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(t,i[t],u[0]));for(let t=0;t<c;t++)p[y*c+t]+=e[n*c+t]}if(a)for(let e=0;e<c;e++)p[y*c+e]/=m-g;if(g=m,++m,v=y+1,y=t,m>l)break}return v<d&&p.fill(s,v*c,d*c),[p,h]}x(r.a5O,(e=>1/(1+Math.exp(-e)))),r.a5O,r.p2w;const ae=y((e=>Math.sqrt(e))),se=(x(r.FKq,(e=>Math.sqrt(e))),r.FKq,a(((e,t)=>{const n=e-t;return n*n})));function le(e,t,n,i){const o=(0,r.f3b)(e,t.dtype);for(let e=0;e<o.size;e++){const r=o.indexToLoc(e),a=new Array(r.length);for(let e=0;e<a.length;e++)a[e]=r[e]*n[e]+i[e];o.set(t.get(...a),...r)}return o}h(r._tC,se),r._tC;class ue{constructor(e,t,n,i,o,a){this.separator=r.D5U.encodeString(e),this.nGramWidths=t,this.leftPad=r.D5U.encodeString(n),this.rightPad=r.D5U.encodeString(i),this.padWidth=o,this.preserveShort=a}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,i,o){for(let a=0;a<i;++a){const s=this.getPadWidth(o),l=Math.max(0,s-a),u=Math.max(0,s-(i-(a+1))),c=o-(l+u),d=t+(l>0?0:a-s);let h=0;h+=l*this.leftPad.length;for(let t=0;t<c;++t)h+=e[d+t].length;h+=u*this.rightPad.length,h+=(l+u+c-1)*this.separator.length,n[r+a]=new Uint8Array(h);const f=n[r+a];let p=0;const g=e=>e.forEach((e=>f[p++]=e));for(let e=0;e<l;++e)g(this.leftPad),g(this.separator);for(let t=0;t<c-1;++t)g(e[d+t]),g(this.separator);if(c>0){g(e[d+c-1]);for(let e=0;e<u;++e)g(this.separator),g(this.rightPad)}else{for(let e=0;e<u-1;++e)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(e,t){const n=e.length,i=t.length;if(i>0){let e=t[0];if(0!==e)throw new Error(`First split value must be 0, got ${e}`);for(let r=1;r<i;++r){let i=t[r]>=e;if(i=i&&t[r]<=n,!i)throw new Error(`Invalid split value ${t[r]}, must be in [${e}, ${n}]`);e=t[r]}if(e!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${e}`)}const o=i-1,a=r.D5U.getArrayFromDType("int32",i);if(0===n||0===i){const e=new Array(n);for(let e=0;e<=o;++e)a[e]=0;return[e,a]}a[0]=0;for(let e=1;e<=o;++e){const n=t[e]-t[e-1];let r=0;this.nGramWidths.forEach((e=>{r+=this.getNumNGrams(n,e)})),this.preserveShort&&n>0&&0===r&&(r=1),a[e]=a[e-1]+r}const s=new Array(a[o]);for(let n=0;n<o;++n){const r=t[n];let i=a[n];if(this.nGramWidths.forEach((o=>{const a=t[n+1]-t[n],l=this.getNumNGrams(a,o);this.createNGrams(e,r,s,i,l,o),i+=l})),this.preserveShort&&i===a[n]){const o=t[n+1]-t[n];if(0===o)continue;const a=o+2*this.padWidth,l=1;this.createNGrams(e,r,s,i,l,a)}}return[s,a]}}function ce(e,t,n,r,i,o,a,s){return new ue(n,r,i,o,a,s).compute(e,t)}function de(e,t,n,r){if(!e.length)return;if(0===t.length){for(let t=0;t<e.length;++t)r.push(e.subarray(t,t+1));return}if(1===t.length){const i=t[0];let o=e.indexOf(i);for(;-1!==o;){const t=e.subarray(0,o);n&&0===t.length||r.push(t),o=(e=e.subarray(o+1)).indexOf(i)}return void(n&&0===e.length||r.push(e))}let i=0;for(let o=0;o<e.length+1;o++)if(o===e.length||-1!==t.indexOf(e[o])){const t=e.subarray(i,o);n&&0===t.length||r.push(t),i=o+1}}function he(e,t,n){const i=e.length,o=[];let a=0,s=0;const l=new Array(i);for(let r=0;r<i;++r){const i=o.length;de(e[r],t,n,o);const u=o.length-i;l[r]=u,a+=u,s=Math.max(s,u)}const u=r.D5U.getArrayFromDType("int32",2*a),c=new Array(a),d=[i,s];let h=0;for(let e=0;e<i;++e)for(let t=0;t<l[e];++t)u[2*h]=e,u[2*h+1]=t,c[h]=o[h],++h;return[u,c,d]}function fe(e,t){const n=r.D5U.getArrayFromDType("int32",e.length);for(let i=0;i<e.length;++i)n[i]=r.D5U.fingerPrint64(e[i]).modulo(t).getLowBitsUnsigned();return n}const pe=a(((e,t)=>e-t)),ge=f(((e,t,n,r)=>({real:e-n,imag:t-r})));function me(e,t){const n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];const i=(0,r.f3b)(n,e.dtype);for(let t=0;t<i.values.length;++t){const n=i.indexToLoc(t),r=new Array(e.rank);for(let t=0;t<r.length;t++)r[t]=n[t]%e.shape[t];const o=e.locToIndex(r);i.values[t]=e.values[o]}return i}h(r.Tr8,pe,ge),r.Tr8;const ve=(e,t)=>{const n=t.value-e.value;return 0===n?e.index-t.index:n};function ye(e,t,n=0,i=e.length-1){for(;i>n;){if(i-n>600){const r=i-n+1,o=t-n+1,a=Math.log(r),s=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*s*(r-s)/r)*Math.sign(o-r/2);ye(e,t,Math.max(n,Math.floor(t-o*s/r+l)),Math.min(i,Math.floor(t+(r-o)*s/r+l)))}const o=e[t];let a=n,s=i;for(r.D5U.swap(e,n,t),ve(e[i],o)>0&&r.D5U.swap(e,n,i);a<s;){for(r.D5U.swap(e,a,s),a++,s--;ve(e[a],o)<0;)a+=1;for(;ve(e[s],o)>0;)s-=1}0===ve(e[n],o)?r.D5U.swap(e,n,s):(s+=1,r.D5U.swap(e,s,i)),s<=t&&(n=s+1),t<=s&&(i=s-1)}}function xe(e,t,n,i,o){const a=t[t.length-1],[s,l]=[e.length/a,a],u=r.D5U.getTypedArrayFromDType(n,s*i),c=r.D5U.getTypedArrayFromDType("int32",s*i);for(let t=0;t<s;t++){const n=t*l,r=e.subarray(n,n+l);let a=new Array(r.length);r.forEach(((e,t)=>a[t]={value:e,index:t})),i<a.length&&(ye(a,i),a=a.slice(0,i)),o&&a.sort(ve);const s=t*i,d=u.subarray(s,s+i),h=c.subarray(s,s+i);for(let e=0;e<i;e++)d[e]=a[e].value,h[e]=a[e].index}const d=t.slice();return d[d.length-1]=i,[(0,r.f3b)(d,n,u),(0,r.f3b)(d,"int32",c)]}function we(e,t,n,i){const o=r.D5U.parseAxisParam(t,n)[0],a=[1,n[0],1];for(let e=0;e<o;e++)a[0]*=n[e];a[1]=n[o];for(let e=o+1;e<n.length;e++)a[2]*=n[e];const s={},l=new Int32Array(n[o]),u=new r.YDk(a,i,e),c=[],d=1===a[0]&&1===a[2];for(let t=0;t<n[o];t++){let n;if(d)n=e[t].toString();else{const e=[];for(let n=0;n<a[0];n++)for(let r=0;r<a[2];r++)e.push(u.get(n,t,r));n=e.join(",")}if(void 0!==s[n])l[t]=s[n];else{const e=Object.keys(s).length;s[n]=e,l[t]=e,c.push(t)}}const h=a.slice();h[1]=Object.keys(s).length;const f=new r.YDk(h,i);c.forEach(((e,t)=>{for(let n=0;n<a[0];n++)for(let r=0;r<a[2];r++)f.set(u.get(n,e,r),n,t,r)}));const p=n.slice();return p[o]=h[1],{outputValues:f.values,outputShape:p,indices:l}}},56392:(e,t,n)=>{"use strict";n.d(t,{p:()=>r});class r{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));const n=[];this.variableNames.forEach((e=>{n.push(`float v${e} = get${e}AtOutCoords();`)}));const r=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}},47340:(e,t,n)=>{"use strict";n.d(t,{a:()=>r});class r{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(((e,t)=>`T${t}`));const n=[];this.variableNames.forEach((e=>{n.push(`vec4 v${e} = get${e}AtOutCoords();`)}));const r=this.variableNames.map((e=>`v${e}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}},48009:(e,t,n)=>{"use strict";n.d(t,{d:()=>r});class r{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a="max"===t?">":"<",s=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${s};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${a} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}},40673:(e,t,n)=>{"use strict";n.d(t,{t:()=>a});var r=n(88478),i=n(21034),o=n(55156);class a{constructor(e,t,n,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,r.D5U.assert(e.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const s=e[e.length-1],l=Math.ceil(s/t);this.outputShape=e.slice(0,-1),l>1&&this.outputShape.push(l),a||this.variableNames.push("bestIndicesA");const u=this.outputShape,c=u.length,d=(0,o.kW)(c),h=(0,i.Ky)("coords",c);let f,p;if(1===l){p=c+1;const e=(0,o.kW)(p);f=`\n        ${e} sourceLocR = ${e}(${h.join()}, 0);\n        ++${h[c-1]};\n        ${e} sourceLocG = ${e}(${h.join()}, 0);\n        ++${h[c-2]};\n        ${e} sourceLocA = ${e}(${h.join()}, 0);\n        --${h[c-1]};\n        ${e} sourceLocB = ${e}(${h.join()}, 0);\n        --${h[c-2]};`}else p=c,f=`\n        ${d} sourceLocR = coords;\n        ++${h[c-1]};\n        ${d} sourceLocG = coords;\n        ++${h[c-2]};\n        ${d} sourceLocA = coords;\n        --${h[c-1]};\n        ${d} sourceLocB = coords;\n        --${h[c-2]};`;const g=["x","y","z","w","u","v"].slice(0,p),m="."+g[p-1],v=g.map((e=>"int "+e)),y=(0,i.Ky)("sourceLocR",p-1).concat("inIdx.r"),x=(0,i.Ky)("sourceLocG",p-1).concat("inIdx.g"),w=(0,i.Ky)("sourceLocB",p-1).concat("inIdx.b"),b=(0,i.Ky)("sourceLocA",p-1).concat("inIdx.a"),C="max"===n?"greaterThan":"lessThan",S=a?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${x.join()}),\n                             getBestIndicesAChannel(${w.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,T=`vec4(\n            getAChannel(${y.join()}),\n            hasNextCol ? getAChannel(${x.join()}) : 0.,\n            hasNextRow ? getAChannel(${w.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,E=a?"":`\n      float getBestIndicesAChannel(${v.join()}) {\n        return getChannel(getBestIndicesA(${g.join()}),\n                                          vec2(${g.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${v.join()}) {\n        return getChannel(getA(${g.join()}),\n                               vec2(${g.slice(-2).join()}));\n      }\n      ${E}\n      void main() {\n        ${d} coords = getOutputCoords();\n        bool hasNextCol = ${h[c-1]} < ${u[c-1]-1};\n        bool hasNextRow = ${h[c-2]} < ${u[c-2]-1};\n        ${f}\n        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},\n          sourceLocB${m}, sourceLocA${m}) * ${t};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${T};\n\n        for (int i = 0; i < ${t}; i++) {\n          inIdx = srcIdx;\n          ${S}\n          vec4 candidate = ${T};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${C}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}},692:(e,t,n)=>{"use strict";n.d(t,{o:()=>r,z:()=>i});class r{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=s-1-e.padInfo.top,c=l-1-e.padInfo.left,d=1/(t*n);this.userCode=`\n      const ivec2 pads = ivec2(${u}, ${c});\n      const float avgMultiplier = float(${d});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${s};\n            wR += ${o}) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${l};\n            wC+= ${a}) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class i{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=c-1-e.padInfo.front,p=d-1-e.padInfo.top,g=h-1-e.padInfo.left,m=1/(t*n*r);this.userCode=`\n      const ivec3 pads = ivec3(${f}, ${p}, ${g});\n      const float avgMultiplier = float(${m});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${c};\n            wD += ${s}) {\n          float dyD = float(dyDCorner + wD) / ${i}.0;\n\n          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${d};\n              wR += ${l}) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${h};\n                wC += ${u}) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}},29476:(e,t,n)=>{"use strict";n.d(t,{w:()=>i});var r=n(88478);class i{constructor(e,t,n,i,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],r.Wap.assertAndGetBroadcastShape(e,t),r.Wap.assertAndGetBroadcastShape(e,n);let s="0.0";null!=i&&(r.Wap.assertAndGetBroadcastShape(e,i),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let l="1.0";null!=o&&(r.Wap.assertAndGetBroadcastShape(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${s};\n        float scale = ${l};\n        float inv = scale * inversesqrt(variance + float(${a}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}},87373:(e,t,n)=>{"use strict";n.d(t,{x:()=>i});var r=n(88478);class i{constructor(e,t,n,i,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],r.Wap.assertAndGetBroadcastShape(e,t),r.Wap.assertAndGetBroadcastShape(e,n);let s="vec4(0.0)";null!=i&&(r.Wap.assertAndGetBroadcastShape(e,i),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let l="vec4(1.0)";null!=o&&(r.Wap.assertAndGetBroadcastShape(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`\n      void main() {\n        vec4 offset = ${s};\n        vec4 scale = ${l};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${a}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}},21480:(e,t,n)=>{"use strict";n.d(t,{S:()=>o,x:()=>i});var r=n(88478);const i={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class o{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=r.Wap.assertAndGetBroadcastShape(t,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${e}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}},84039:(e,t,n)=>{"use strict";n.d(t,{D1:()=>o,t6:()=>a});var r=n(88478),i=n(16697);const o="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class a{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=r.Wap.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=(0,i.C9)(this.outputShape.length),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${e}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}},14488:(e,t,n)=>{"use strict";n.d(t,{E2:()=>l,my:()=>s});var r=n(88478),i=n(16697),o=n(21034),a=n(55156);const s="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n";class l{constructor(e,t,n,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.Wap.assertAndGetBroadcastShape(t,n);const l=this.outputShape.length;this.enableShapeUniforms=(0,i.C9)(l);let u="";if(s)if(0===l||1===r.D5U.sizeFromShape(this.outputShape))u="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(u=`\n          ${(0,a.kW)(l)} coords = getOutputCoords();\n        `,1===l)this.enableShapeUniforms?u+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":u+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const e=(0,o.Ky)("coords",l);this.enableShapeUniforms?u+=`\n            bool nextRowOutOfBounds =\n              (${e[l-2]} + 1) >= outShape[${l} - 2];\n            bool nextColOutOfBounds =\n              (${e[l-1]} + 1) >= outShape[${l} - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `:u+=`\n            bool nextRowOutOfBounds =\n              (${e[l-2]} + 1) >= ${this.outputShape[l-2]};\n            bool nextColOutOfBounds =\n              (${e[l-1]} + 1) >= ${this.outputShape[l-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${e}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${u}\n\n        setOutput(result);\n      }\n    `}}},90740:(e,t,n)=>{"use strict";n.d(t,{jl:()=>s,nd:()=>a});var r=n(88478);const i={},o={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function a(e,t){i[e]=t}function s(e,t){if(!(e in i)||null!=t){const n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=null==t?function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete i[e]}),!1),(0,r.OBj)().getBool("SOFTWARE_WEBGL_ENABLED")&&(o.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",o)||n.getContext("experimental-webgl",o):n.getContext("webgl2",o)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;i[e]=n}const n=i[e];return null==n||n.isContextLost()?(delete i[e],s(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),i[e])}},90150:(e,t,n)=>{"use strict";n.d(t,{v:()=>r});class r{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}}},96521:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});class r{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}}},82314:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});class r{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}},47494:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(88478);class i{constructor(e){this.outputShape=[],this.outputShape=r.Wap.computeOutShape(e,1),this.variableNames=e.map(((e,t)=>`T${t}`));const t=new Array(e.length-1);t[0]=e[0][1];for(let n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];const n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let e=1;e<t.length;e++){const r=t[e-1];n.push(`else if (yC < ${t[e]}) setOutput(getT${e}(yR, yC-${r}));`)}const i=t.length,o=t[t.length-1];n.push(`else setOutput(getT${i}(yR, yC-${o}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}},47625:(e,t,n)=>{"use strict";n.d(t,{R:()=>a});var r=n(88478),i=n(21034),o=n(55156);class a{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=r.Wap.computeOutShape(e,t);const n=this.outputShape,a=n.length,l=(0,o.kW)(a),u=(0,i.Ky)("coords",a),c=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(((e,t)=>`T${t}`));const d=new Array(e.length-1);d[0]=e[0][t];for(let n=1;n<d.length;n++)d[n]=d[n-1]+e[n][t];const h=c[t],f=c.slice(-2),p=c.join();let g=`if (${h} < ${d[0]}) {\n        return getChannel(\n            getT0(${p}), vec2(${f.join()}));\n        }`;for(let e=1;e<d.length;e++){const t=d[e-1];g+=`\n        if (${h} < ${d[e]}  && ${h} >= ${d[e-1]}) {\n          return getChannel(\n            getT${e}(${s(c,h,t)}),\n            vec2(${s(f,h,t)}));\n        }`}const m=d.length,v=d[d.length-1];g+=`\n        return getChannel(\n          getT${m}(${s(c,h,v)}),\n          vec2(${s(f,h,v)}));`,this.userCode=`\n      float getValue(${c.map((e=>"int "+e))}) {\n        ${g}\n      }\n\n      void main() {\n        ${l} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${u}), 0., 0., 0.);\n\n        ${u[a-1]} = ${u[a-1]} + 1;\n        if (${u[a-1]} < ${n[a-1]}) {\n          result.g = getValue(${u});\n        }\n\n        ${u[a-2]} = ${u[a-2]} + 1;\n        if (${u[a-2]} < ${n[a-2]}) {\n          result.a = getValue(${u});\n        }\n\n        ${u[a-1]} = ${u[a-1]} - 1;\n        if (${u[a-2]} < ${n[a-2]} &&\n            ${u[a-1]} < ${n[a-1]}) {\n          result.b = getValue(${u});\n        }\n        setOutput(result);\n      }\n    `}}function s(e,t,n){const r=e.indexOf(t);return e.map(((e,t)=>t===r?`${e} - ${n}`:e)).join()}},90301:(e,t,n)=>{"use strict";n.d(t,{FF:()=>o,Ng:()=>r,P2:()=>i,cc:()=>a});class r{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o="channelsLast"===e.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${r};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              if (${o}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class i{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o="channelsLast"===e.dataFormat,a=t-1-e.padInfo.top,s=n-1-e.padInfo.left,l=o?1:2,u=o?2:3,c=o?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${a}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${c}];\n\n        ivec2 dyCorner = ivec2(coords[${l}], coords[${u}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n\n              if (${o}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class o{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yF = 0; yF < ${e.outDepth}; yF++) {\n            int xF = wF + yF * ${t} - ${i};\n\n            if (xF < 0 || xF >= ${e.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${e.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${o};\n\n              if (xR < 0 || xR >= ${e.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${e.outWidth}; yC++) {\n                int xC = wC + yC * ${r} - ${a};\n\n                if (xC < 0 || xC >= ${e.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class a{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.front,l=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${s}, ${l}, ${u});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${t}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${i}.0;\n\n          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${t} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${o}.0;\n\n            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${a}.0;\n\n              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}},37428:(e,t,n)=>{"use strict";n.d(t,{g:()=>i,u:()=>r});class r{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${o} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${e.batchSize}; b++) {\n          for (int yR = 0; yR < ${e.outHeight}; yR++) {\n            int xR = wR + yR * ${t} - ${r};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${e.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class i{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${t}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${r}.0;\n\n          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${t} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${s}; dm++) {\n              int d2 = d1 * ${s} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}},18954:(e,t,n)=>{"use strict";n.d(t,{I:()=>r,S:()=>i});class r{constructor(e,t=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,s=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4,g="channelsLast"===e.dataFormat,m=g?1:2,v=g?2:3,y=g?3:1;let x="",w="";n&&(x=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,w="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${x}\n\n      const ivec2 strides = ivec2(${s}, ${l});\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${y}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${m}], coords[${v}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${d}; wR++) {\n          int xR = xRCorner + wR * ${u};\n\n          if (xR < 0 || xR >= ${e.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${h}; wC++) {\n            int xC = xCCorner + wC * ${c};\n\n            if (xC < 0 || xC >= ${e.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${f}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${g}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===p}) {\n\n              if (${g}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${f}) *\n                    getW(wR, wC, ${f}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${f}, xR, xC) *\n                    getW(wR, wC, ${f}, d2);\n              }\n\n            } else if (${2===p}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2)\n              );\n\n              if (${g}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===p}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${f}, d2),\n                getW(wR, wC, ${f} + 1, d2),\n                getW(wR, wC, ${f} + 2, d2)\n              );\n\n              if (${g}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${f}),\n                  getX(batch, xR, xC, ${f} + 1),\n                  getX(batch, xR, xC, ${f} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${f}, xR, xC),\n                  getX(batch, ${f} + 1, xR, xC),\n                  getX(batch, ${f} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${b}\n        ${w}\n        setOutput(result);\n      }\n    `}}class i{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${o}, ${a});\n      const ivec3 pads = ivec3(${t}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${c}; wF++) {\n          int xF = xFCorner + wF * ${s};\n\n          if (xF < 0 || xF >= ${e.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${d}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${e.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h}; wC++) {\n              int xC = xCCorner + wC * ${u};\n\n              if (xC < 0 || xC >= ${e.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${f}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===p}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${f}) *\n                  getW(wF, wR, wC, ${f}, d2);\n              } else if (${2===p}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===p}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1),\n                  getX(batch, xF, xR, xC, ${f} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2),\n                  getW(wF, wR, wC, ${f} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}},64364:(e,t,n)=>{"use strict";n.d(t,{J:()=>i});var r=n(16697);class i{constructor(e,t=!1,n=null,i=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=(0,r.C9)(this.outputShape.length);const a=e.filterHeight,s=e.filterWidth,l=e.outChannels/e.inChannels;let u="",c="";n&&(u=i?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:o?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,c="result = activation(result);");const d=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${u}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${l};\n        int q = d2 - d1 * ${l};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${a}; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${s}; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${d}\n        ${c}\n        setOutput(result);\n      }\n    `}}},92734:(e,t,n)=>{"use strict";n.d(t,{i:()=>o});var r=n(88478),i=n(16697);class o{constructor(e,t=!1,n=null,o=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=(0,i.C9)(this.outputShape.length);const s=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,h=d;let f="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;";for(let e=0;e<d;e++)f+=`\n           vec4 xTexelC${2*e};\n           int xTexelC${2*e}Ready;\n           vec4 xTexelC${2*e+1};\n           int xTexelC${2*e+1}Ready;\n           vec4 xC${e};`;f+=`\n     for (int r = 0; r < ${c}; r++) {\n      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {\n       `;for(let e=0;e<d;e++)f+=`\n           xTexelC${2*e} = vec4(0.0);\n           xTexelC${2*e}Ready = 0;\n           xTexelC${2*e+1} = vec4(0.0);\n           xTexelC${2*e+1}Ready = 0;\n           xC${e} = vec4(0.0);`;f+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(let t=0;t<(h+1)/2;t++){const n=2*t;if(f+=`\n           xC = xCCorner + ${n*u};\n           `,1===l){if(n<d&&(s%2==1?(f+=`\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n               `,f+=1===u&&n>0?`\n                 xC${n} = vec4(xTexelC${n-2}.zw, xTexelC${n}.xy);\n                 `:`\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC${n} = vec4(previous.zw, xTexelC${n}.xy);\n                   } else {\n                     xC${n} = vec4(0.0, 0.0, xTexelC${n}.xy);\n                   }\n                   `):f+=`\n                 if (xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xC${n} = xTexelC${n};\n                 `,n+1<d)){const e=s%2==0?r.D5U.nearestLargerEven(u):u;u%2==0&&s%2==1||u%2!=0&&s%2!=1?(f+=`\n                   xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                     xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC${n+1}.zw = vec2(0.0);\n                     }\n                     xTexelC${n+1}Ready = 1;\n                   }\n                   `,f+=u>1?`\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC${n+1} = vec4(previous.zw, xTexelC${n+1}.xy);\n                     } else {\n                      xC${n+1} = vec4(0.0, 0.0, xTexelC${n+1}.xy);\n                     }\n                     `:`\n                     xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.xy);\n                     `):f+=1===e?`\n                     xC${n+1} = xTexelC${n};\n                     `:`\n                     xCOffset = xC + ${e};\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                       xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC${n+1}.zw = vec2(0.0);\n                       }\n                       xTexelC${n+1}Ready = 1;\n                     }\n\n                     xC${n+1} = xTexelC${n+1};\n                     `}}else n<d&&(s%2==1?(f+=`\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.0);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n               `,n+1<d&&(f+=`\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC${n+1} = vec4(xTexelC${n+1}.xy, final.xy);\n                 `)):(f+=`\n                 if(xC >= 0 && xC < inDims[1] && xTexelC${n}Ready == 0) {\n                   xTexelC${n} = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC${n}.zw = vec2(0.0);\n                   }\n                   xTexelC${n}Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${n+1}Ready == 0) {\n                   xTexelC${n+1} = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC${n+1}.zw = vec2(0.);\n                   }\n                   xTexelC${n+1}Ready = 1;\n                 }\n\n                 xC${n} = vec4(\n                   xTexelC${n}.xy, xTexelC${n+1}.xy);\n               `,n+1<d&&(f+=`\n                   xC${n+1} = vec4(xTexelC${n}.zw, xTexelC${n+1}.zw);\n                 `)));n<d&&(f+=`\n             wTexel = getW(r, ${n}, d1, d2);\n             dotProd += xC${n}.xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ${e.inChannels}) {\n               dotProd += xC${n}.yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           `,n+1<d&&(f+=`\n               wTexel = getW(r, ${n+1}, d1, d2);\n               dotProd += xC${n+1}.xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ${e.inChannels}) {\n                 dotProd += xC${n+1}.yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             `))}f+="\n     }\n   ",f+="\n     }\n   ",f+="\n     }\n   ";let p="",g="";n&&(p=o?`vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ${n}\n         }`:a?`vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ${n}\n         }`:`vec4 activation(vec4 x) {\n           ${n}\n         }`,g="result = activation(result);");const m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n       ${p}\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ${f}\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ${m}\n         ${g}\n         setOutput(result);\n       }\n     `}}},31177:(e,t,n)=>{"use strict";n.d(t,{f:()=>o});var r=n(88478),i=n(16697);class o{constructor(e,t=!1,n=null,o=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=(0,i.C9)(this.outputShape.length);const s=e.outChannels/e.inChannels,l=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=h;let p="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;";for(let e=0;e<h;e++)p+=`\n          vec4 xTexelC${2*e};\n          int xTexelC${2*e}Ready;\n          vec4 xTexelC${2*e+1};\n          int xTexelC${2*e+1}Ready;\n          vec4 xC${e};`;p+=`\n    for (int r = 0; r < ${d}; r++) {\n      `;for(let e=0;e<h;e++)p+=`\n          xTexelC${2*e} = vec4(0.0);\n          xTexelC${2*e}Ready = 0;\n          xTexelC${2*e+1} = vec4(0.0);\n          xTexelC${2*e+1}Ready = 0;\n          xC${e} = vec4(0.0);`;p+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(let e=0;e<(f+1)/2;e++){const t=2*e;if(p+=`\n          xC = xCCorner + ${t*c};\n          `,1===u){if(t<h&&(l%2==1?(p+=`\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n              `,p+=1===c&&t>0?`\n                xC${t} = vec4(xTexelC${t-2}.zw, xTexelC${t}.xy);\n                `:`\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC${t} = vec4(previous.zw, xTexelC${t}.xy);\n                  } else {\n                    xC${t} = vec4(0.0, 0.0, xTexelC${t}.xy);\n                  }\n                  `):p+=`\n                if (xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xC${t} = xTexelC${t};\n                `,t+1<h)){const e=l%2==0?r.D5U.nearestLargerEven(c):c;c%2==0&&l%2==1||c%2!=0&&l%2!=1?(p+=`\n                  xCOffset = xC + imod(pads[1], 2) + ${e};\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                    xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC${t+1}.zw = vec2(0.0);\n                    }\n                    xTexelC${t+1}Ready = 1;\n                  }\n                  `,p+=c>1?`\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC${t+1} = vec4(previous.zw, xTexelC${t+1}.xy);\n                    } else {\n                     xC${t+1} = vec4(0.0, 0.0, xTexelC${t+1}.xy);\n                    }\n                    `:`\n                    xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.xy);\n                    `):p+=1===e?`\n                    xC${t+1} = xTexelC${t};\n                    `:`\n                    xCOffset = xC + ${e};\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                      xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC${t+1}.zw = vec2(0.0);\n                      }\n                      xTexelC${t+1}Ready = 1;\n                    }\n\n                    xC${t+1} = xTexelC${t+1};\n                    `}}else t<h&&(l%2==1?(p+=`\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.0);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n              `,t+1<h&&(p+=`\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC${t+1} = vec4(xTexelC${t+1}.xy, final.xy);\n                `)):(p+=`\n                if(xC >= 0 && xC < inDims[1] && xTexelC${t}Ready == 0) {\n                  xTexelC${t} = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC${t}.zw = vec2(0.0);\n                  }\n                  xTexelC${t}Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${t+1}Ready == 0) {\n                  xTexelC${t+1} = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC${t+1}.zw = vec2(0.);\n                  }\n                  xTexelC${t+1}Ready = 1;\n                }\n\n                xC${t} = vec4(\n                  xTexelC${t}.xy, xTexelC${t+1}.xy);\n              `,t+1<h&&(p+=`\n                  xC${t+1} = vec4(xTexelC${t}.zw, xTexelC${t+1}.zw);\n                `)));t<h&&(p+=`\n            wTexel = getW(r, ${t}, d1, q);\n            dotProd += xC${t} * vec4(wTexel.xz, wTexel.xz);\n          `,t+1<h&&(p+=`\n              wTexel = getW(r, ${t+1}, d1, q);\n              dotProd += xC${t+1} * vec4(wTexel.xz, wTexel.xz);\n            `))}p+="\n    }\n  ",p+="\n      }\n    ";let g="",m="";n&&(g=o?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:a?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,m="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${g}\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${s};\n        int q = d2 - d1 * ${s};\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ${p}\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ${v}\n        ${m}\n        setOutput(result);\n      }\n    `}}},65120:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});class r{constructor(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,s,l]=e,[u]=t,[c,d]=n;this.outputShape=[u,c,d,l];const h="bilinear"===r?1:0,[f,p]=[a-1+".0",s-1+".0"],[g,m,v]=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[y,x,w]=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio",`x1*${p} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${p}`];this.userCode=`\n      const float height_ratio = float(${g});\n      const float width_ratio = float(${y});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${o}) {\n          return;\n        }\n\n        float height_scale = ${m};\n        float width_scale = ${x};\n\n        float in_y = ${v};\n        if( in_y < 0.0 || in_y > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${w};\n        if( in_x < 0.0 || in_x > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${h} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}},30330:(e,t,n)=>{"use strict";n.d(t,{Q:()=>r,Z:()=>o});var r,i=n(55156);!function(e){e.Prod="*",e.Sum="+"}(r||(r={}));class o{constructor(e,t,n,o){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const l=this.outputShape.length,u=this.op===r.Prod?"1.0":"0.0",c=n?u:`getX(${a(l,"coords",this.op)})`,d=this.outputShape[this.outputShape.length-1];let h="",f="";n?(h=o?"end != "+(d-1):"end != 0",f=o?"end + 1":"end - 1"):(h=o?`end + pow2 < ${d}`:"end >= pow2",f=o?"end + pow2":"end - pow2"),this.userCode=`\n      void main() {\n        ${(0,i.kW)(l)} coords = getOutputCoords();\n        int end = ${s(l,"coords",this.op)};\n        float val = ${c};\n        int pow2 = int(pow(2.0, index));\n        if (${h}) {\n          int idx = ${f};\n          ${s(l,"coords",this.op)} = idx;\n          val ${this.op}= getX(${a(l,"coords",this.op)});\n        }\n        setOutput(val);\n      }\n    `}}function a(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.x, ${t}.y`;if(3===e)return`${t}.x, ${t}.y, ${t}.z`;if(4===e)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function s(e,t,n){if(1===e)return`${t}`;if(2===e)return`${t}.y`;if(3===e)return`${t}.z`;if(4===e)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}},87033:(e,t,n)=>{"use strict";n.d(t,{h:()=>r});class r{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${t};\n      int offset_h = imod(h, ${t});\n      int in_w = w / ${t};\n      int offset_w = imod(w, ${t});\n      int offset_d = (offset_h * ${t} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}},76473:(e,t,n)=>{"use strict";n.d(t,{L:()=>r});class r{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}},93008:(e,t,n)=>{"use strict";n.d(t,{H:()=>r});class r{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:s,dilationHeight:l,dilationWidth:u}=e,{top:c,left:d}=r;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${o});\n      const ivec2 pads = ivec2(${c}, ${d});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${a}; h++) {\n          int hIn = hBeg + h * ${l};\n\n          if (hIn >= 0 && hIn < ${t}) {\n            for (int w = 0; w < ${s}; w++) {\n              int wIn = wBeg + w * ${u};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}},90615:(e,t,n)=>{"use strict";n.d(t,{O:()=>r});class r{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=n?`${r}.0`:"1.0";let a;if("real"===e)a="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);a="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${a}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${o};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}},67137:(e,t,n)=>{"use strict";n.d(t,{o:()=>r});class r{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}}},67079:(e,t,n)=>{"use strict";n.d(t,{i:()=>r});class r{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${t} - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${t}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}},55795:(e,t,n)=>{"use strict";n.d(t,{S:()=>i});var r=n(55156);class i{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=(0,r.kW)(this.rank),i=function(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let t=0;t<e.length;t++)2===t?r.push("index"):r.push(`${n[t]}`);return r.join()}(e);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;\n        setOutput(inBounds * getA(${i}));\n      }\n    `}}},78428:(e,t,n)=>{"use strict";n.d(t,{i:()=>i});var r=n(55156);class i{constructor(e,t,n,i){this.sliceDim=e,this.strides=t,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=n;const o=(0,r.kW)(n.length);let a="\n    int index;";for(let e=0;e<this.sliceDim;e++)a+=`\n          index = round(getIndices(coords[0], ${e}));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[e]};\n          flattenIndex += index * ${this.strides[e]};`;this.userCode=`\n         void main() {\n          ${o} coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ${a}\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      `}}},29610:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(88478);function i(){let e,t,n,i,o,a,s,l,u,c;return 2===(0,r.OBj)().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",i="in",o="texture",a="outputColor",s="out vec4 outputColor;",l=(0,r.OBj)().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",i="varying",o="texture2D",a="gl_FragColor",s="",l="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:i,texture2D:o,output:a,defineOutput:s,defineSpecialNaN:l,defineSpecialInf:u,defineRound:c}}},16697:(e,t,n)=>{"use strict";n.d(t,{C9:()=>d,IJ:()=>a,Yv:()=>s,_s:()=>u,mi:()=>c});var r=n(88478),i=n(55156),o=n(91906);function a(e,t,n,a){const l=n.map(((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),u=l.map((e=>e.shapeInfo)),c={logicalShape:a.shape,texShape:a.texData.texShape,isUniform:!1,isPacked:a.texData.isPacked,flatOffset:null},d=i.Vm(l,c,t),h=(0,o.xc)(e.gl,d),f=e.createProgram(h);return(0,r.OBj)().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:h,source:d,webGLProgram:f,inShapeInfos:u,outShapeInfo:c,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:h,source:d,webGLProgram:f,inShapeInfos:u,outShapeInfo:c},s(e,t,f))}function s(e,t,n){const i={},o={},a={},s=[];let l,u,c,d=null,h=null;h=e.getUniformLocation(n,"NAN",!1),1===(0,r.OBj)().getNumber("WEBGL_VERSION")&&(d=e.getUniformLocation(n,"INFINITY",!1));const f=!1;for(let r=0;r<t.variableNames.length;r++){const s=t.variableNames[r];i[s]=e.getUniformLocation(n,s,f),i[`offset${s}`]=e.getUniformLocation(n,`offset${s}`,f),t.enableShapeUniforms&&(o[`${s}Shape`]=e.getUniformLocation(n,`${s}Shape`,f),a[`${s}TexShape`]=e.getUniformLocation(n,`${s}TexShape`,f))}return t.enableShapeUniforms&&(l=e.getUniformLocation(n,"outShape",f),c=e.getUniformLocation(n,"outShapeStrides",f),u=e.getUniformLocation(n,"outTexShape",f)),t.customUniforms&&t.customUniforms.forEach(((t,r)=>{s[r]=e.getUniformLocation(n,t.name,f)})),{uniformLocations:i,customUniformLocations:s,infLoc:d,nanLoc:h,inShapesLocations:o,inTexShapesLocations:a,outShapeLocation:l,outShapeStridesLocation:c,outTexShapeLocation:u}}function l(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach(((e,n)=>{const i=e.logicalShape,o=t[n],a=o.shape;if(!r.D5U.arraysEqual(i,a))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${a} must match`);if(e.isUniform&&o.isUniform)return;const s=e.texShape,l=o.isUniform?null:o.texData.texShape;if(!r.D5U.arraysEqual(s,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${s} and ${l} must match`)}))}function u(e,t,n,o,a){t.program.enableShapeUniforms||(l(t.inShapeInfos,n),l([t.outShapeInfo],[o]));const s=o.texData.texture,u=o.texData.texShape;o.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,u[0],u[1]):e.setOutputMatrixTexture(s.texture,u[0],u[1]),e.setProgram(t.webGLProgram),1===(0,r.OBj)().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(((n,o)=>{const a=t.program.variableNames[o],s=t.uniformLocations[a],l=t.uniformLocations[`offset${a}`],u=t.inShapesLocations[`${a}Shape`],c=t.inTexShapesLocations[`${a}TexShape`];if(u){const{uniformShape:r}=i.Tt(t.program.packedInputs,n.shape,n.texData.texShape);switch(r.length){case 1:e.gl.uniform1iv(u,new Int32Array(r));break;case 2:e.gl.uniform2iv(u,new Int32Array(r));break;case 3:e.gl.uniform3iv(u,new Int32Array(r));break;case 4:e.gl.uniform4iv(u,new Int32Array(r))}}if(c&&e.gl.uniform2i(c,n.texData.texShape[0],n.texData.texShape[1]),null!=s)if(n.isUniform)if(r.D5U.sizeFromShape(n.shape)<2)e.gl.uniform1f(s,n.uniformValues[0]);else{let t=n.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(s,t)}else null!=n.texData.slice&&null!=l&&e.gl.uniform1i(l,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,s,o)}));const c=t.outShapeLocation;if(c)switch(o.shape.length){case 1:e.gl.uniform1iv(c,new Int32Array(o.shape));break;case 2:e.gl.uniform2iv(c,new Int32Array(o.shape));break;case 3:e.gl.uniform3iv(c,new Int32Array(o.shape));break;case 4:e.gl.uniform4iv(c,new Int32Array(o.shape))}if(t.outShapeStridesLocation){const n=r.D5U.computeStrides(o.shape);switch(o.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(n));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(n));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(n))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,o.texData.texShape[0],o.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach(((n,r)=>{const i=t.customUniformLocations[r],o=a[r];if("float"===n.type)e.gl.uniform1fv(i,o);else if("vec2"===n.type)e.gl.uniform2fv(i,o);else if("vec3"===n.type)e.gl.uniform3fv(i,o);else if("vec4"===n.type)e.gl.uniform4fv(i,o);else if("int"===n.type)e.gl.uniform1iv(i,o);else if("ivec2"===n.type)e.gl.uniform2iv(i,o);else if("ivec3"===n.type)e.gl.uniform3iv(i,o);else{if("ivec4"!==n.type)throw Error(`uniform type ${n.type} is not supported yet.`);e.gl.uniform4iv(i,o)}})),e.executeProgram()}function c(e,t,n){let o="";t.concat(n).forEach((t=>{const a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){const s=t.texData.texShape,{useSqueezeShape:l,uniformShape:u,keptDims:c}=i.Tt(e.packedInputs,t.shape,s);let d="",h="",f="";if(1===u.length&&e.packedInputs){const e=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];d=`${e[0]>1}_${e[1]>1}`}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){const e=r.D5U.computeStrides(u);f=`${e[0]===s[1]}_${e[e.length-1]===s[1]}`}}else h=`${u[0]>1}_${u[1]>1}`;const p=t.shape.length,g=2===u.length&&r.D5U.arraysEqual(t.shape,s),m=1===r.D5U.sizeFromShape(t.shape),v=r.Wap.getBroadcastDims(t.shape,n.shape),y=!e.packedInputs&&p===n.shape.length&&r.D5U.arraysEqual(s,n.texData.texShape),x=e.packedInputs||u.length>2?"":`${s[0]>1}_${s[1]>1}`;o+=`${p}_${y}_${l?c:""}_${u.length}_${m}_${v}_${g}_${d}_${h}_${f}_${x}_${a}`}else{const e=t.isUniform?"uniform":t.texData.texShape;o+=`${t.shape}_${e}_${a}`}}));const a=e.userCode;let s=e.constructor.name;return s+="_"+o+"_"+a+`${(0,r.OBj)().getNumber("WEBGL_VERSION")}`,s}function d(e){return(0,r.OBj)().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}},4328:(e,t,n)=>{"use strict";n.d(t,{A8:()=>T,AD:()=>I,BQ:()=>m,Cs:()=>w,HC:()=>R,Hb:()=>u,Hc:()=>b,Jj:()=>s,NQ:()=>g,P1:()=>k,Qr:()=>S,T2:()=>h,Uk:()=>C,Y3:()=>l,cU:()=>y,ez:()=>E,gl:()=>v,hf:()=>x,iN:()=>p,m8:()=>f,q3:()=>d});var r=n(88478),i=n(29610),o=n(18378),a=n(91906);function s(e){const t=(0,i.A)(),n=`${t.version}\n    precision highp float;\n    ${t.attribute} vec3 clipSpacePos;\n    ${t.attribute} vec2 uv;\n    ${t.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`;return a.Jj(e,n)}function l(e){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return a.ED(e,t)}function u(e){const t=new Uint16Array([0,1,2,2,1,3]);return a.mZ(e,t)}function c(e,t,n,i,o,s){a.b6(t,n);const l=a.cU(e),u=e.TEXTURE_2D;return a.O7(e,(()=>e.bindTexture(u,l))),a.O7(e,(()=>e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),a.O7(e,(()=>e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),a.O7(e,(()=>e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST))),a.O7(e,(()=>e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST))),1===(0,r.OBj)().getNumber("WEBGL_VERSION")?a.O7(e,(()=>e.texImage2D(u,0,i,t,n,0,o,s,null))):a.O7(e,(()=>e.texStorage2D(u,1,i,t,n))),a.O7(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),{texture:l,texShape:[n,t]}}function d(e){return e.internalFormatFloat}function h(e,t,n,r){const[i,a]=o.kk(t,n);return c(e,i,a,d(r),r.textureFormatFloat,e.FLOAT)}function f(e){return e.internalFormatHalfFloat}function p(e,t,n,r){const[i,a]=o.kk(t,n);return c(e,i,a,f(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function g(e){return e.downloadTextureFormat}function m(e,t,n,r){const[i,a]=o.kk(t,n);return c(e,i,a,g(r),e.RGBA,e.UNSIGNED_BYTE)}function v(e){return e.internalFormatPackedFloat}function y(e,t,n,r){const[i,a]=o.qe(t,n);return c(e,i,a,v(r),e.RGBA,e.FLOAT)}function x(e){return e.internalFormatPackedHalfFloat}function w(e,t,n,r){const[i,a]=o.qe(t,n);return c(e,i,a,x(r),e.RGBA,r.textureTypeHalfFloat)}function b(e,t,n){return a.O7(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),a.sb(e,t,"clipSpacePos",n,3,20,0)&&a.sb(e,t,"uv",n,2,20,12)}function C(e,t,n,i,o,s){let l,u,c;a.O7(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),o instanceof Uint8Array?(l=new Uint8Array(n*i*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(l=new Float32Array(n*i*4),u=e.FLOAT,c=s.internalFormatPackedFloat),l.set(o),2===(0,r.OBj)().getNumber("WEBGL_VERSION")?a.O7(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,i,e.RGBA,u,l))):a.O7(e,(()=>e.texImage2D(e.TEXTURE_2D,0,c,n,i,0,e.RGBA,u,l))),a.O7(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function S(e,t,n){a.O7(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?2===(0,r.OBj)().getNumber("WEBGL_VERSION")?a.O7(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data))):a.O7(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):2===(0,r.OBj)().getNumber("WEBGL_VERSION")?a.O7(e,(()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n))):a.O7(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),a.O7(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}function T(e,t,n,r){const i=e.createBuffer();a.O7(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i)));const o=16*t*n;return a.O7(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ))),a.O7(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),a.O7(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),i}function E(e,t,n){const r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function R(e,t,n,r){const[i,s]=o.kk(t,n),l=new Uint8Array(o.yb(t*n,4));return a.O7(e,(()=>e.readPixels(0,0,i,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,l))),new Float32Array(l.buffer)}function I(e,t,n,r,i,a,s,l){const u=e,c=new Float32Array(o.Se(a,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function k(e,t,n){const r=new Float32Array(t*n*4);return a.O7(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r))),r}},77129:(e,t,n)=>{"use strict";n.d(t,{l:()=>o});var r=n(29610),i=n(16697);class o{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=(0,i.C9)(this.outputShape.length);const{dataFormat:n}=t,o=(0,r.A)(),a="channelsLast"===n,s=a?1:2,l=a?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)c+=`\n          blockIndex = rc.z + ${t};\n          pos = rc.y + ${e};\n\n          ${u}\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[${s}] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[${l}] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (${a}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*e+t}] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*e+t}] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${c}\n\n        ${o.output} = result;\n      }\n    `}}},38795:(e,t,n)=>{"use strict";var r=n(88478),i=n(91906);const o=(0,r.OBj)();o.registerFlag("HAS_WEBGL",(()=>o.getNumber("WEBGL_VERSION")>0)),o.registerFlag("WEBGL_VERSION",(()=>(0,i.uH)(2)?2:(0,i.uH)(1)?1:0)),o.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),o.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===o.get("WEBGL_VERSION"))),o.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),o.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),o.registerFlag("WEBGL_PACK",(()=>o.getBool("HAS_WEBGL"))),o.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_CLIP",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_PACK_REDUCE",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_LAZILY_UNPACK",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_CONV_IM2COL",(()=>o.getBool("WEBGL_PACK"))),o.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>(0,i.lo)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>(0,i.KP)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const e=o.getNumber("WEBGL_VERSION");return 0===e?0:(0,i.nr)(e)})),o.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>o.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!r.C2$.isMobile())),o.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>(0,i.wb)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!o.getBool("WEBGL_FORCE_F16_TEXTURES")&&o.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),o.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>(0,i.BH)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>(0,i.Qd)(o.getNumber("WEBGL_VERSION")))),o.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>o.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),o.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)})),o.registerFlag("WEBGL_FLUSH_THRESHOLD",(()=>r.C2$.isMobile()?1:-1),(e=>{if(e<0&&-1!==e)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)})),o.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(()=>128)),o.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(()=>!1)),o.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(()=>1e5)),o.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(()=>128)),o.registerFlag("WEBGL_EXP_CONV",(()=>!1)),o.registerFlag("SOFTWARE_WEBGL_ENABLED",(()=>o.getBool("IS_TEST"))),o.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(()=>1/0)),o.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(()=>!1)),o.registerFlag("WEBGL2_ISNAN_CUSTOM",(()=>!1)),o.registerFlag("ENGINE_COMPILE_ONLY",(()=>!1));var a=n(90740),s=n(29610),l=n(16697),u=n(38110),c=n(18378);class d{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=c.m1.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=(0,s.A)();this.outputShape=e,this.enableShapeUniforms=(0,l.C9)(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?u.Kn(["r","c","d"],e):u.RW(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${t.output} = result;\n      }\n    `}}class h{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=c.m1.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=(0,s.A)();this.outputShape=e,this.enableShapeUniforms=(0,l.C9)(this.outputShape.length),this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${this.enableShapeUniforms?u.Kn(["r","c","d"],e):u.RW(["r","c","d"],e)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${t.output} = result;\n      }\n    `}}class f{constructor(e){this.variableNames=["A"],this.outTexUsage=c.v2.DOWNLOAD;const t=(0,s.A)();this.outputShape=e,this.userCode=`\n      ${u.ye}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${t.output} = encode_float(x);\n      }\n    `}}class p{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=c.v2.DOWNLOAD;const t=(0,s.A)();this.outputShape=e,this.userCode=`\n      ${u.ye}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${t.output} = encode_float(x);\n      }\n    `}}const g={R:0,G:1,B:2,A:3};class m{constructor(e,t=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=(0,s.A)();this.outputShape=e,this.enableShapeUniforms=(0,l.C9)(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let e=0;e<n.length;e++){const t=n[e];o+=`\n          if(offset == ${e}) {\n            result = values[${g[t]}];\n          }`}this.userCode=`\n      ${this.enableShapeUniforms?u.nc():u.ku(e)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ${n.length});\n\n        flatIndex = idiv(flatIndex, ${n.length}, 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ${r.texture2D}(A, uv);\n          ${o}\n        }\n        ${r.output} = vec4(${i}, 0., 0., 0.);\n      }\n    `}}class v{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=(0,s.A)();this.outputShape=e,this.enableShapeUniforms=(0,l.C9)(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let t=0;t<=1;t++)for(let i=0;i<=1;i++){const o=2*t+i;r+=`\n          localCoords = coords;\n          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {\n          localCoords[2] += ${i};\n          if (localCoords[1] + ${t} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {\n            localCoords[1] += ${t};\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ${n.texture2D}(A, uv);\n\n            if (offset == 0) {\n              result[${o}] = values[0];\n            } else if (offset == 1) {\n              result[${o}] = values[1];\n            } else if (offset == 2) {\n              result[${o}] = values[2];\n            } else {\n              result[${o}] = values[3];\n            }\n          }\n        }\n        `}this.userCode=`\n        ${this.enableShapeUniforms?u.nc():u.ku(e)}\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ${r}\n\n          ${n.output} = ${i};\n        }\n    `}}var y=n(4328);class x{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=(0,r.OBj)().getNumber("WEBGL_VERSION");if(null!=e?(this.gl=e,(0,a.nd)(t,e)):this.gl=(0,a.jl)(t),e=this.gl,2===(0,r.OBj)().getNumber("WEBGL_VERSION")){const t=e;this.createVertexArray=()=>i.O7(t,(()=>t.createVertexArray())),this.bindVertexArray=e=>i.O7(t,(()=>t.bindVertexArray(e))),this.deleteVertexArray=e=>i.O7(t,(()=>t.deleteVertexArray(e))),this.getVertexArray=()=>i.O7(t,(()=>t.getParameter(t.VERTEX_ARRAY_BINDING)))}else if(null!=e){const t=e.getExtension("OES_vertex_array_object");if(null==t)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>i.O7(e,(()=>t.createVertexArrayOES())),this.bindVertexArray=n=>i.O7(e,(()=>t.bindVertexArrayOES(n))),this.deleteVertexArray=n=>i.O7(e,(()=>t.deleteVertexArrayOES(n))),this.getVertexArray=()=>i.O7(e,(()=>e.getParameter(t.VERTEX_ARRAY_BINDING_OES)))}let n="WEBGL_color_buffer_float";const o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===(0,r.OBj)().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=i.HH(this.gl,e),i.y_(this.gl,t))this.textureHalfFloatExtension=i.HH(this.gl,t);else if((0,r.OBj)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),i.y_(this.gl,o))this.colorBufferHalfFloatExtension=i.HH(this.gl,o);else if((0,r.OBj)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",i.y_(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!i.y_(this.gl,o))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(o)}this.vertexBuffer=y.Y3(this.gl),this.indexBuffer=y.Hb(this.gl),this.framebuffer=i.d8(this.gl),this.textureConfig=c.Sq(this.gl,this.textureHalfFloatExtension)}get debug(){return(0,r.OBj)().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;i.O7(e,(()=>e.finish())),i.O7(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),i.O7(e,(()=>e.deleteFramebuffer(this.framebuffer))),i.O7(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),i.O7(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),i.O7(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),y.T2(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),y.iN(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),y.BQ(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),y.Qr(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),y.Uk(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),y.Cs(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),y.cU(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(i.ax(this.gl,this.framebuffer),this.outputTexture=null),i.O7(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>y.HC(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,r,i,o){return y.AD(this.gl,e,t,n,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return y.ez(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=y.A8(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if((0,r.OBj)().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(i,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=i}else(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>y.P1(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();const t=this.gl;null==this.vertexShader&&(this.vertexShader=y.Jj(t));const n=i.HO(t);let r;return i.O7(t,(()=>t.attachShader(n,this.vertexShader))),i.O7(t,(()=>t.attachShader(n,e))),i.aj(t,n),r=Object.assign(n,{vao:this.createVertexArray()}),this.bindVertexArray(r.vao),i.O7(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer))),console.assert(y.Hc(t,r,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&i.vu(t,r),this.setProgram(r),r}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(i.O7(this.gl,(()=>this.gl.deleteProgram(e))),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&(this.bindVertexArray(this.program.vao),this.debug&&i.vu(this.gl,this.program)),i.O7(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?i.XE(this.gl,e,t):i.Hg(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),i.O7(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),i.B(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,i]=c.qe(t,n);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&i.vu(this.gl,this.program),i.cu(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}i.O7(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),i.O7(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=i.HH(this.gl,2===(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await r.D5U.repeatedTry((()=>this.disposed||this.isQueryAvailable(e,(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=function(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in(0,r.OBj)().platform&&(n=(0,r.OBj)().platform.setTimeoutCustom.bind((0,r.OBj)().platform)),r.D5U.repeatedTry((()=>(this.pollItems(),0===this.itemsToPoll.length)),(()=>0),null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),i.JG(this.gl,e,this.framebuffer),this.debug&&i.cu(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(i.JG(this.gl,this.outputTexture,this.framebuffer),this.debug&&i.cu(this.gl)):i.ax(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;i.JG(r,e,this.framebuffer),this.debug&&i.cu(r),this.outputTexture=e,i.O7(r,(()=>r.viewport(0,0,t,n))),i.O7(r,(()=>r.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),i.O7(this.gl,(()=>this.gl.scissor(e,t,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}var w=n(64272),b=n(55667),C=n(28831),S=n(42490),T=n(84518),E=n(29365),R=n(84595);const I=r.GDt.ZA,k={},O=(0,r.OBj)().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");class _ extends r.Zuw{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!(0,r.OBj)().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(null!=e){if(e instanceof x)t=e;else{const n=(0,a.jl)((0,r.OBj)().getNumber("WEBGL_VERSION"),e);t=new x(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const e=(0,a.jl)((0,r.OBj)().getNumber("WEBGL_VERSION"));t=new x(e),this.binaryCache=((n=(0,r.OBj)().getNumber("WEBGL_VERSION"))in k||(k[n]={}),k[n]),this.gpgpuCreatedLocally=!0}var n;this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new S.I(this.gpgpu),this.numMBBeforeWarning=null==(0,r.OBj)().global.screen?1024:(0,r.OBj)().global.screen.height*(0,r.OBj)().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new r.JLz(this,(0,r.SRH)())}nextDataId(){return _.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,n,r,o,a){const s=this.makeTensorInfo(t,n),l=this.texData.get(s.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,o]},l.texShape=[r,o];const u=i.ih(t),c=new m(u,!1,a),d=this.runWebGLProgram(c,[s],n,[[r,o]]);return d.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(s),d.dataId}write(e,t,n){if(((0,r.OBj)().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||(0,r.OBj)().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:t,dtype:n,values:e,usage:c.v2.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){this.texData.get(e).refCount++}decRef(e){this.texData.has(e)&&this.texData.get(e).refCount--}move(e,t,n,i,o){if((0,r.OBj)().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:i,values:t,usage:c.v2.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:n,dtype:i,complexTensorInfos:o,slice:a,shape:s,isPacked:l}=t;if(null!=a){let t;t=l?new E.cc(s,T.bl):new T.l(s,T.bl);const n=this.runWebGLProgram(t,[{dataId:e,shape:s,dtype:i}],i),r=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===i)return n;const u=null!=this.activeTimers;let c,d;if(u&&(c=r.D5U.now()),"complex64"===i){const e=this.readSync(o.real.dataId),t=this.readSync(o.imag.dataId);d=r.Wap.mergeRealAndImagArrays(e,t)}else d=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=r.D5U.now()-c),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}const t=this.texData.get(e),{values:n,shape:o,slice:a,dtype:s,complexTensorInfos:l,isPacked:u}=t;if(null!=a){let t;t=u?new E.cc(o,T.bl):new T.l(o,T.bl);const n=this.runWebGLProgram(t,[{dataId:e,shape:o,dtype:s}],s),r=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),r}if(null!=n)return this.convertAndCacheOnCPU(e);if((0,r.OBj)().getBool("DEBUG")&&!(0,r.OBj)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===(0,r.OBj)().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let d,h,f=null;if("complex64"!==s&&(0,r.OBj)().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const t=this.texData.get(d.dataId);f=this.gpgpu.createBufferFromTexture(t.texture.texture,...c.Yz(o))}if(this.pendingRead.set(e,[]),"complex64"!==s&&await this.gpgpu.createAndWaitForFence(),"complex64"===s){const e=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),t=e[0],n=e[1];h=r.Wap.mergeRealAndImagArrays(t,n)}else if(null==f)h=this.getValuesFromTexture(e);else{const e=r.D5U.sizeFromShape(o);h=this.gpgpu.downloadFloat32MatrixFromBuffer(f,e)}if(null!=d&&this.disposeIntermediateTensorInfo(d),null!=f){const e=this.gpgpu.gl;i.O7(e,(()=>e.deleteBuffer(f)))}const p=this.convertAndCacheOnCPU(e,h),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach((e=>e(p))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&(0,r.SRH)().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const n=this.texData.get(e),{values:i,shape:o,slice:a,dtype:s,isPacked:l,texture:u}=n;if("complex64"===s)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=a){let n;n=l?new E.cc(o,T.bl):new T.l(o,T.bl);const r=this.runWebGLProgram(n,[{dataId:e,shape:o,dtype:s}],s),i=this.readToGPU(r,t);return this.disposeIntermediateTensorInfo(r),i}if(null==u)throw null!=i?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,t.customTexShape),d=(0,r.SRH)().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:d},h.texture)}bufferSync(e){const t=this.readSync(e.dataId);if("string"===e.dtype)try{const n=t.map((e=>r.D5U.decodeString(e)));return(0,r.f3b)(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return(0,r.f3b)(e.shape,e.dtype,t)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!i.qF(n)){if((0,r.OBj)().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:o}=this.texData.get(e),a=r.D5U.sizeFromShape(t);if((0,r.OBj)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(r.texture.texture,...c.Yz(t)).subarray(0,a);return this.disposeIntermediateTensorInfo(n),i}const s=(0,r.OBj)().getBool("WEBGL_PACK")&&!0===o,l=s?i.ih(t):t,u=s?new p(l):new f(l),d=this.runWebGLProgram(u,[{shape:l,dtype:n,dataId:e}],"float32"),h=this.texData.get(d.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,a);return this.disposeIntermediateTensorInfo(d),g}timerAvailable(){return(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,n=[];let i=!1;null==this.programTimersStack?(this.programTimersStack=n,i=!0):this.activeTimers.push(n),this.activeTimers=n,e();const o=r.D5U.flatten(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),a=r.D5U.flatten(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,i&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if((0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(o);s.kernelMs=r.D5U.sum(e),s.getExtraProfileInfo=()=>e.map(((e,t)=>({name:a[t],ms:e}))).map((e=>`${e.name}: ${e.ms}`)).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:r.D5U.now(),endMs:null}}endTimer(e){return(0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=r.D5U.now(),e)}async getQueryTime(e){if((0,r.OBj)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),s=a&&a.origDataId||e,l=this.dataRefCount.get(s);l>1?this.dataRefCount.set(s,l-1):(this.dataRefCount.delete(s),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,i,o)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=O){return(0,r.OBj)().getBool("WEBGL_CPU_FORWARD")&&e.every((e=>null==this.texData.get(e.dataId).texture&&r.D5U.sizeFromShape(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){r.Wap.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return I(e.shape,t)}packedUnaryOp(e,t,n){const i=new E.cc(e.shape,t),o=this.compileAndRun(i,[e],n);return(0,r.SRH)().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=(0,w.CJ)(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if((0,r.OBj)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,T.Et,e.dtype);const t=new T.l(e.shape,T.Et),n=this.compileAndRun(t,[e]);return(0,r.SRH)().makeTensorFromTensorInfo(n)}makeTensorInfo(e,t,n){let i;if("string"===t&&null!=n&&n.length>0&&r.D5U.isString(n[0])){const o=n.map((e=>r.D5U.encodeString(e)));i=this.write(o,e,t)}else i=this.write(n,e,t);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:t}}makeOutput(e,t,n){return(0,r.SRH)().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}unpackTensor(e){const t=new R.W(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new b.U(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[i.Cp(e.shape),...i.W8(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},o=[i.Cp(t),...i.W8(t)],a=new C.v(o,n),s=[n],l=this.runWebGLProgram(a,[r],e.dtype,s,!0);return{dataId:l.dataId,shape:t,dtype:l.dtype}}decode(e,t){const n=this.texData.get(e),{isPacked:o,shape:a,dtype:s}=n;if(null!=t){const e=r.D5U.sizeFromShape(a),n=t[0]*t[1]*4;r.D5U.assert(e<=n,(()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."))}const l=i.ih(a);let u;u=o?new h(l):new d(l);const f=[null!=t?t:c.Yz(l)];return{dtype:s,shape:a,dataId:this.runWebGLProgram(u,[{shape:l,dtype:s,dataId:e}],s,f,!0,t).dataId}}runWebGLProgram(e,t,n,o,a=!1,s){const u=this.makeTensorInfo(e.outputShape,n),d=this.texData.get(u.dataId);if(e.packedOutput&&(d.isPacked=!0),e.outPackingScheme===c.m1.DENSE){const t=null!=s?s:c.Yz(e.outputShape);d.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(d.usage=e.outTexUsage),0===r.D5U.sizeFromShape(u.shape))return d.values=r.D5U.getTypedArrayFromDType(u.dtype,0),u;const h=[],f=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&r.D5U.sizeFromShape(t.shape)<=(0,r.OBj)().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(this.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),h.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!i.oT(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),h.push(t),n=this.texData.get(t.dataId),e.shape=r}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(u.dataId);const p={shape:u.shape,texData:d,isUniform:!1},g=l.mi(e,f,p),m=this.getAndSaveBinary(g,(()=>l.IJ(this.gpgpu,e,f,p))),v=null!=this.activeTimers;let y;v&&(y=this.startTimer()),(0,r.OBj)().get("ENGINE_COMPILE_ONLY")||l._s(this.gpgpu,m,f,p,o),h.forEach((e=>this.disposeIntermediateTensorInfo(e))),v&&(y=this.endTimer(y),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(y)}));const x=(0,r.OBj)().get("WEBGL_FLUSH_THRESHOLD");if(x>0){const e=r.D5U.now();e-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=e)}if(!(0,r.OBj)().getBool("WEBGL_LAZILY_UNPACK")&&d.isPacked&&!1===a){const e=this.unpackTensor(u);return this.disposeIntermediateTensorInfo(u),e}return u}compileAndRun(e,t,n,r,i=!1){return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||((0,r.OBj)().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=(0,r.lub)((()=>{if(!(0,r.OBj)().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=(0,r.OBj)().getBool("DEBUG");(0,r.OBj)().set("DEBUG",!1);const t=this.abs((0,r.iD$)(1e-8)).dataSync()[0];if((0,r.OBj)().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:o,values:a,texture:s,usage:l,isPacked:u}=t;if(null!=s)return;const d=null!=this.activeTimers;let h;d&&(h=r.D5U.now());let f=t.texShape;if(null==f&&(f=i.Yf(n,u),t.texShape=f),null!=a){const e=i.ih(n);let s,l=f[1],p=f[0];const g=a instanceof Uint8Array||a instanceof Uint8ClampedArray;!u&&g||([l,p]=c.qe(f[0],f[1])),s=u?new v(e,g):new m(e,g);const y=g?[p,l]:f,x=this.makeTensorInfo(y,o),w=this.texData.get(x.dataId);w.usage=g?c.v2.PIXELS:c.v2.UPLOAD,w.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),l,p,a);const b=[[p,l]],C=!0,S=this.runWebGLProgram(s,[x],o,b,C),T=this.texData.get(S.dataId);t.texShape=T.texShape,t.isPacked=T.isPacked,t.usage=T.usage,(0,r.OBj)().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(t.texture=T.texture,t.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(x),d&&(this.uploadWaitMs+=r.D5U.now()-h)}else{const e=this.acquireTexture(f,l,o,u);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error(`Unknown dtype ${t}`)}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${e} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*r.D5U.bytesPerElement(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}for(const[,t]of Object.entries(this.binaryCache)){const n=new Promise((e=>{try{this.checkCompletion_(t),e(!0)}catch(e){throw e}}));e.push(n)}return Promise.all(e)}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await(0,r.glt)(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw i.w4(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}getUniformLocations(){for(const[,e]of Object.entries(this.binaryCache)){const{uniformLocations:t,customUniformLocations:n,infLoc:r,nanLoc:i,inShapesLocations:o,inTexShapesLocations:a,outShapeLocation:s,outShapeStridesLocation:u,outTexShapeLocation:c}=(0,l.Yv)(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=t,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=i,e.inShapesLocations=o,e.inTexShapesLocations=a,e.outShapeLocation=s,e.outShapeStridesLocation=u,e.outTexShapeLocation=c}}createTensorFromGPUData(e,t,n){e.channels=e.channels||"RGBA";const{texture:i,height:o,width:a,channels:s}=e,l=(0,r.SRH)().backend;if(!l.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(i,t,n,o,a,s);return(0,r.SRH)().makeTensorFromDataId(u,t,n,l)}}_.nextDataId=0;var A=n(25522);r.C2$.isBrowser()&&(0,r.jqO)("webgl",(()=>new _),2),A.kS,n(19665)},25965:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i}),i.sessions=new Map,i.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){let e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||i.extension.isInstalled()}return!0};var r={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){let t=window.setTimeout((function(){let t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){let e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){let n=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){let e=new Error("NavigatorUserMediaError");e.name="You cancelled the request for permission, giving up...",n(e)}else n(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&window.clearTimeout(t.data.id)}))}};function i(e){if((e=e||{}).success="function"==typeof e.success?e.success:i.noop,e.error="function"==typeof e.error?e.error:i.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:i.noop,!i.initDone)return e.error("Library not initialized"),{};if(!i.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(i.log("Library initialized: "+i.initDone),!e.server)return e.error("Invalid server url"),{};let t=!1,n=null,r={},o=null,a=null,s=0,l=e.server;i.isArray(l)?(i.log("Multiple servers provided ("+l.length+"), will use the first that works"),l=null,a=e.server,i.debug(a)):0===l.indexOf("ws")?(t=!0,i.log("Using WebSockets to contact Janus: "+l)):(t=!1,i.log("Using REST API to contact Janus: "+l));let u=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],c=e.iceTransportPolicy,d=e.bundlePolicy,h=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(h=!0===e.withCredentials);let f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);let p=null;void 0!==e.token&&null!==e.token&&(p=e.token);let g=null;void 0!==e.apisecret&&null!==e.apisecret&&(g=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);let m=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(m=e.keepAlivePeriod),isNaN(m)&&(m=25e3);let v=6e4;function y(e){let t={high:9e5,medium:3e5,low:1e5};return null!=e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(v=e.longPollTimeout),isNaN(v)&&(v=6e4);let x=!1,w=null,b=new Map,C=this,S=0,T=new Map;function E(){if(null==w)return;if(i.debug("Long poll..."),!x)return void i.warn("Is the server down? (connected=false)");let t=l+"/"+w+"?rid="+(new Date).getTime();f&&(t=t+"&maxev="+f),p&&(t=t+"&token="+encodeURIComponent(p)),g&&(t=t+"&apisecret="+encodeURIComponent(g)),i.httpAPICall(t,{verb:"GET",withCredentials:h,success:R,timeout:v,error:function(t,n){if(i.error(t+":",n),S++,S>3)return x=!1,void e.error("Lost connection to the server (is it down?)");E()}})}function R(e,r){if(S=0,t||null==w||!0===r||E(),t||!i.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){const t=e.sender;if(!t)return void i.warn("Missing sender...");const n=b.get(t);if(!n)return void i.debug("This handle is not attached to this session");let r=e.candidate;i.debug("Got a trickled candidate on session "+w),i.debug(r);let o=n.webrtcStuff;o.pc&&o.remoteSdp?(i.debug("Adding remote candidate:",r),r&&!0!==r.completed?o.pc.addIceCandidate(r):o.pc.addIceCandidate(i.endOfCandidates)):(i.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(r),i.debug(o.candidates))}else{if("webrtcup"===e.janus){i.debug("Got a webrtcup event on session "+w),i.debug(e);const t=e.sender;if(!t)return void i.warn("Missing sender...");const n=b.get(t);return n?void n.webrtcState(!0):void i.debug("This handle is not attached to this session")}if("hangup"===e.janus){i.debug("Got a hangup event on session "+w),i.debug(e);const t=e.sender;if(!t)return void i.warn("Missing sender...");const n=b.get(t);if(!n)return void i.debug("This handle is not attached to this session");n.webrtcState(!1,e.reason),n.hangup()}else if("detached"===e.janus){i.debug("Got a detached event on session "+w),i.debug(e);const t=e.sender;if(!t)return void i.warn("Missing sender...");const n=b.get(t);if(!n)return;n.ondetached(),n.detach()}else if("media"===e.janus){i.debug("Got a media event on session "+w),i.debug(e);const t=e.sender;if(!t)return void i.warn("Missing sender...");const n=b.get(t);if(!n)return void i.debug("This handle is not attached to this session");n.mediaState(e.type,e.receiving,e.mid)}else if("slowlink"===e.janus){i.debug("Got a slowlink event on session "+w),i.debug(e);const t=e.sender;if(!t)return void i.warn("Missing sender...");const n=b.get(t);if(!n)return void i.debug("This handle is not attached to this session");n.slowLink(e.uplink,e.lost,e.mid)}else{if("error"===e.janus){i.error("Ooops: "+e.error.code+" "+e.error.reason),i.debug(e);let t=e.transaction;if(t){let n=T.get(t);n&&n(e),T.delete(t)}return}if("event"===e.janus){i.debug("Got a plugin event on session "+w),i.debug(e);const t=e.sender;if(!t)return void i.warn("Missing sender...");let n=e.plugindata;if(!n)return void i.warn("Missing plugindata...");i.debug("  -- Event is coming from "+t+" ("+n.plugin+")");let r=n.data;i.debug(r);const o=b.get(t);if(!o)return void i.warn("This handle is not attached to this session");let a=e.jsep;a&&(i.debug("Handling SDP as well..."),i.debug(a));let s=o.onmessage;s?(i.debug("Notifying application..."),s(r,a)):i.debug("No provided notification callback")}else{if("timeout"===e.janus)return i.error("Timeout on session "+w),i.debug(e),void(t&&n.close(3504,"Gateway timeout"));i.warn("Unknown message/event  '"+e.janus+"' on session "+w),i.debug(e)}}}else{i.debug("Got a success on session "+w),i.debug(e);const t=e.transaction;if(t){const n=T.get(t);n&&n(e),T.delete(t)}}else{i.debug("Got an ack on session "+w),i.debug(e);const t=e.transaction;if(t){const n=T.get(t);n&&n(e),T.delete(t)}}else{i.debug("Got info on the Janus instance"),i.debug(e);const t=e.transaction;if(t){const n=T.get(t);n&&n(e),T.delete(t)}}else i.vdebug("Got a keepalive on session "+w);else for(let t=0;t<e.length;t++)R(e[t],!0)}function I(){if(!l||!t||!x)return;o=setTimeout(I,m);let e={janus:"keepalive",session_id:w,transaction:i.randomString(12)};p&&(e.token=p),g&&(e.apisecret=g),n.send(JSON.stringify(e))}function k(u){let c=i.randomString(12),d={janus:"create",transaction:c};if(u.reconnect&&(x=!1,d.janus="claim",d.session_id=w,n&&(n.onopen=null,n.onerror=null,n.onclose=null,o&&(clearTimeout(o),o=null))),p&&(d.token=p),g&&(d.apisecret=g),!l&&i.isArray(a)&&(l=a[s],0===l.indexOf("ws")?(t=!0,i.log("Server #"+(s+1)+": trying WebSockets to contact Janus ("+l+")")):(t=!1,i.log("Server #"+(s+1)+": trying REST API to contact Janus ("+l+")"))),t){n=i.newWebSocket(l,"janus-protocol"),r={error:function(){if(i.error("Error connecting to the Janus WebSockets server... "+l),i.isArray(a)&&!u.reconnect)return s++,s===a.length?void u.error("Error connecting to any of the provided Janus servers: Is the server down?"):(l=null,void setTimeout((function(){k(u)}),200));u.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){T.set(c,(function(e){if(i.debug(e),"success"!==e.janus)return i.error("Ooops: "+e.error.code+" "+e.error.reason),void u.error(e.error.reason);o=setTimeout(I,m),x=!0,w=e.session_id?e.session_id:e.data.id,u.reconnect?i.log("Claimed session: "+w):i.log("Created session: "+w),i.sessions.set(w,C),u.success()})),n.send(JSON.stringify(d))},message:function(e){R(JSON.parse(e.data))},close:function(){l&&x&&(x=!1,e.error("Lost connection to the server (is it down?)"))}};for(let e in r)n.addEventListener(e,r[e])}else i.httpAPICall(l,{verb:"POST",withCredentials:h,body:d,success:function(e){if(i.debug(e),"success"!==e.janus)return i.error("Ooops: "+e.error.code+" "+e.error.reason),void u.error(e.error.reason);x=!0,w=e.session_id?e.session_id:e.data.id,u.reconnect?i.log("Claimed session: "+w):i.log("Created session: "+w),i.sessions.set(w,C),E(),u.success()},error:function(e,t){if(i.error(e+":",t),i.isArray(a)&&!u.reconnect)return s++,s===a.length?void u.error("Error connecting to any of the provided Janus servers: Is the server down?"):(l=null,void setTimeout((function(){k(u)}),200));""===t?u.error(e+": Is the server down?"):t&&t.error?u.error(e+": "+t.error.message):u.error(e+": "+t)}})}function O(e,r){if((r=r||{}).success="function"==typeof r.success?r.success:i.noop,r.error="function"==typeof r.error?r.error:i.noop,!x)return i.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");let o=b.get(e);if(!o||!o.webrtcStuff)return i.warn("Invalid handle"),void r.error("Invalid handle");let a=r.message,s=r.jsep,u=i.randomString(12),c={janus:"message",body:a,transaction:u};if(o.token&&(c.token=o.token),g&&(c.apisecret=g),s){c.jsep={type:s.type,sdp:s.sdp},s.e2ee&&(c.jsep.e2ee=!0),"hml"!==s.rid_order&&"lmh"!==s.rid_order||(c.jsep.rid_order=s.rid_order),s.force_relay&&(c.jsep.force_relay=!0);let e=null,t=o.webrtcStuff;if(t.pc){let n=t.pc.getTransceivers();if(n&&n.length>0)for(let t in n){let r=n[t];if(r&&r.sender&&r.sender.track&&"video"===r.sender.track.kind){let n=r.sender.getParameters();n&&n.encodings&&n.encodings[0]&&n.encodings[0].scalabilityMode&&(e||(e=[]),e.push({mindex:parseInt(t),mid:r.mid,svc:n.encodings[0].scalabilityMode}))}}}e&&(c.jsep.svc=e)}if(i.debug("Sending message to plugin (handle="+e+"):"),i.debug(c),t)return c.session_id=w,c.handle_id=e,T.set(u,(function(e){if(i.debug("Message sent!"),i.debug(e),"success"===e.janus){let t=e.plugindata;if(!t)return i.warn("Request succeeded, but missing plugindata..."),void r.success();i.log("Synchronous transaction successful ("+t.plugin+")");let n=t.data;return i.debug(n),void r.success(n)}"ack"===e.janus?r.success():e.error?(i.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(i.error("Unknown error"),r.error("Unknown error"))})),void n.send(JSON.stringify(c));i.httpAPICall(l+"/"+w+"/"+e,{verb:"POST",withCredentials:h,body:c,success:function(e){if(i.debug("Message sent!"),i.debug(e),"success"===e.janus){let t=e.plugindata;if(!t)return i.warn("Request succeeded, but missing plugindata..."),void r.success();i.log("Synchronous transaction successful ("+t.plugin+")");let n=t.data;return i.debug(n),void r.success(n)}"ack"===e.janus?r.success():e.error?(i.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(i.error("Unknown error"),r.error("Unknown error"))},error:function(e,t){i.error(e+":",t),r.error(e+": "+t)}})}function _(e,r){if(!x)return void i.warn("Is the server down? (connected=false)");let o=b.get(e);if(!o||!o.webrtcStuff)return void i.warn("Invalid handle");let a={janus:"trickle",candidate:r,transaction:i.randomString(12)};if(o.token&&(a.token=o.token),g&&(a.apisecret=g),i.vdebug("Sending trickle candidate (handle="+e+"):"),i.vdebug(a),t)return a.session_id=w,a.handle_id=e,void n.send(JSON.stringify(a));i.httpAPICall(l+"/"+w+"/"+e,{verb:"POST",withCredentials:h,body:a,success:function(e){i.vdebug("Candidate sent!"),i.vdebug(e),"ack"===e.janus||i.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){i.error(e+":",t)}})}function A(e,t,n,r,o){let a=b.get(e);if(!a||!a.webrtcStuff)return void i.warn("Invalid handle");let s=a.webrtcStuff;if(!s.pc)return void i.warn("Invalid PeerConnection");let l=function(e){i.log("Received state change on data channel:",e);let t=e.target.label,n=e.target.protocol,r=s.dataChannel[t]?s.dataChannel[t].readyState:"null";if(i.log("State change on <"+t+"> data channel: "+r),"open"===r){if(s.dataChannel[t].pending&&s.dataChannel[t].pending.length>0){i.log("Sending pending messages on <"+t+">:",s.dataChannel[t].pending.length);for(let e of s.dataChannel[t].pending)i.log("Sending data on data channel <"+t+">"),i.debug(e),s.dataChannel[t].send(e);s.dataChannel[t].pending=[]}a.ondataopen(t,n)}};if(r)s.dataChannel[t]=r;else{let e=s.dataChannelOptions;n&&(e.protocol=n),s.dataChannel[t]=s.pc.createDataChannel(t,e)}s.dataChannel[t].onmessage=function(e){i.log("Received message on data channel:",e);let t=e.target.label;a.ondata(e.data,t)},s.dataChannel[t].onopen=l,s.dataChannel[t].onclose=l,s.dataChannel[t].onerror=function(e){i.error("Got error on data channel:",e)},s.dataChannel[t].pending=[],o&&s.dataChannel[t].pending.push(o)}function P(e,t){(t=t||{}).success="function"==typeof t.success?t.success:i.noop,t.error="function"==typeof t.error?t.error:i.noop;let n=b.get(e);if(!n||!n.webrtcStuff)return i.warn("Invalid handle"),void t.error("Invalid handle");let r=n.webrtcStuff,o=t.text||t.data;if(!o)return i.warn("Invalid data"),void t.error("Invalid data");let a=t.label?t.label:i.dataChanDefaultLabel;return r.dataChannel[a]?"open"!==r.dataChannel[a].readyState?(r.dataChannel[a].pending.push(o),void t.success()):(i.log("Sending data on data channel <"+a+">"),i.debug(o),r.dataChannel[a].send(o),void t.success()):(A(e,a,t.protocol,!1,o,t.protocol),void t.success())}function D(e,t){(t=t||{}).success="function"==typeof t.success?t.success:i.noop,t.error="function"==typeof t.error?t.error:i.noop;let n=b.get(e);if(!n||!n.webrtcStuff)return i.warn("Invalid handle"),void t.error("Invalid handle");let r=n.webrtcStuff;if(!r.dtmfSender){if(r.pc){let e=r.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!e)return i.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");r.dtmfSender=e.dtmf,r.dtmfSender&&(i.log("Created DTMF Sender"),r.dtmfSender.ontonechange=function(e){i.debug("Sent DTMF tone: "+e.tone)})}if(!r.dtmfSender)return i.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}let o=t.dtmf;if(!o)return i.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");let a=o.tones;if(!a)return i.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");let s="number"==typeof o.duration?o.duration:500,l="number"==typeof o.gap?o.gap:50;i.debug("Sending DTMF string "+a+" (duration "+s+"ms, gap "+l+"ms)"),r.dtmfSender.insertDTMF(a,s,l),t.success()}function $(e,r){(r=r||{}).success="function"==typeof r.success?r.success:i.noop,r.error="function"==typeof r.error?r.error:i.noop;let o=!0===r.noRequest;i.log("Destroying handle "+e+" (only-locally="+o+")"),X(e);let a=b.get(e);if(!a||a.detached)return b.delete(e),void r.success();if(a.detached=!0,o)return b.delete(e),void r.success();if(!x)return i.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");let s={janus:"detach",transaction:i.randomString(12)};if(a.token&&(s.token=a.token),g&&(s.apisecret=g),t)return s.session_id=w,s.handle_id=e,n.send(JSON.stringify(s)),b.delete(e),void r.success();i.httpAPICall(l+"/"+w+"/"+e,{verb:"POST",withCredentials:h,body:s,success:function(t){i.log("Destroyed handle:"),i.debug(t),"success"!==t.janus&&i.error("Ooops: "+t.error.code+" "+t.error.reason),b.delete(e),r.success()},error:function(t,n){i.error(t+":",n),b.delete(e),r.success()}})}async function F(e,t,n){(n=n||{}).success="function"==typeof n.success?n.success:i.noop,n.error="function"==typeof n.error?n.error:H;let r=n.jsep;if(t&&r)return i.error("Provided a JSEP to a createOffer"),void n.error("Provided a JSEP to a createOffer");if(!(t||r&&r.type&&r.sdp))return i.error("A valid JSEP is required for createAnswer"),void n.error("A valid JSEP is required for createAnswer");if(n.media&&!n.tracks){if(n.tracks=i.mediaToTracks(n.media),!0===n.simulcast||!0===n.simulcast2||n.svc)for(let e of n.tracks)if("video"===e.type){!0===n.simulcast||!0===n.simulcast2?e.simulcast=!0:n.svc&&(e.svc=n.svc);break}i.warn("Deprecated media object passed, use tracks instead. Automatically translated to:",n.tracks)}if(n.tracks&&!Array.isArray(n.tracks))return i.error("Tracks must be an array"),void n.error("Tracks must be an array");let o=b.get(e);if(!o||!o.webrtcStuff)return i.warn("Invalid handle"),void n.error("Invalid handle");let a=o.webrtcStuff;var s;a.trickle=(s=n.trickle,i.debug("isTrickleEnabled:",s),!1!==s);try{if(function(e,t){let n=b.get(e);if(!n||!n.webrtcStuff)throw i.warn("Invalid handle"),"Invalid handle";let r=n.webrtcStuff;if(r.pc)return;let o={iceServers:u,iceTransportPolicy:c,bundlePolicy:d,sdpSemantics:"unified-plan"},a=!1;if(t.tracks)for(let e of t.tracks)if(e.transforms&&(e.transforms.sender||e.transforms.receiver)){a=!0;break}RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&a&&(r.insertableStreams=!0,o.forceEncodedAudioInsertableStreams=!0,o.forceEncodedVideoInsertableStreams=!0,o.encodedInsertableStreams=!0),i.log("Creating PeerConnection"),r.pc=new RTCPeerConnection(o),i.debug(r.pc),r.pc.getStats&&(r.volume={},r.bitrate.value="0 kbits/sec"),i.log("Preparing local SDP and gathering candidates (trickle="+r.trickle+")"),r.pc.oniceconnectionstatechange=function(){r.pc&&n.iceState(r.pc.iceConnectionState)},r.pc.onicecandidate=function(n){if(!n.candidate||n.candidate.candidate&&n.candidate.candidate.indexOf("endOfCandidates")>0)i.log("End of candidates."),r.iceDone=!0,!0===r.trickle?_(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:i.noop,t.error="function"==typeof t.error?t.error:i.noop;let n=b.get(e);if(!n||!n.webrtcStuff)return void i.warn("Invalid handle, not sending anything");let r=n.webrtcStuff;i.log("Sending offer/answer SDP..."),r.mySdp?(r.mySdp={type:r.pc.localDescription.type,sdp:r.pc.localDescription.sdp},!1===r.trickle&&(r.mySdp.trickle=!1),i.debug(t),r.sdpSent=!0,t.success(r.mySdp)):i.warn("Local SDP instance is invalid, not sending anything...")}(e,t);else{let t={candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex};!0===r.trickle&&_(e,t)}},r.pc.ontrack=function(e){if(i.log("Handling Remote Track",e),!e.streams)return;if(!e.track)return;let t=e.transceiver?e.transceiver.mid:e.track.id;try{n.onremotetrack(e.track,t,!0,{reason:"created"})}catch(e){i.error("Error calling onremotetrack",e)}if(e.track.onended)return;let o=null;i.log("Adding onended callback to track:",e.track),e.track.onended=function(e){i.log("Remote track removed:",e),clearTimeout(o);let t=r.pc?r.pc.getTransceivers():null,a=t?t.find((t=>t.receiver.track===e.target)):null,s=a?a.mid:e.target.id;try{n.onremotetrack(e.target,s,!1,{reason:"ended"})}catch(e){i.error("Error calling onremotetrack on removal",e)}},e.track.onmute=function(e){i.log("Remote track muted:",e),o||(o=setTimeout((function(){i.log("Removing remote track");let t=r.pc?r.pc.getTransceivers():null,a=t?t.find((t=>t.receiver.track===e.target)):null,s=a?a.mid:e.target.id;try{n.onremotetrack(e.target,s,!1,{reason:"mute"})}catch(e){i.error("Error calling onremotetrack on mute",e)}o=null}),2520))},e.track.onunmute=function(e){if(i.log("Remote track flowing again:",e),null!=o)clearTimeout(o),o=null;else try{let t=r.pc?r.pc.getTransceivers():null,i=t?t.find((t=>t.receiver.track===e.target)):null,o=i?i.mid:e.target.id;n.onremotetrack(e.target,o,!0,{reason:"unmute"})}catch(e){i.error("Error calling onremotetrack on unmute",e)}}}}(e,n),t&&await N(e,n),r){if(await a.pc.setRemoteDescription(r),i.log("Remote description accepted!"),a.remoteSdp=r.sdp,a.candidates&&a.candidates.length>0){for(let e=0;e<a.candidates.length;e++){let t=a.candidates[e];i.debug("Adding remote candidate:",t),t&&!0!==t.completed?a.pc.addIceCandidate(t):a.pc.addIceCandidate(i.endOfCandidates)}a.candidates=[]}await N(e,n);let t=await async function(e,t){(t=t||{}).customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:i.noop;let n=b.get(e);if(!n||!n.webrtcStuff)throw i.warn("Invalid handle"),"Invalid handle";let r=n.webrtcStuff;i.log("Creating answer (iceDone="+r.iceDone+")");let o=await r.pc.createAnswer();i.debug(o);let a={type:"answer",sdp:o.sdp};return t.customizeSdp(a),o.sdp=a.sdp,i.log("Setting local description"),r.mySdp={type:"answer",sdp:o.sdp},await r.pc.setLocalDescription(o),r.iceDone||r.trickle?(r.insertableStreams&&(o.e2ee=!0),o):(i.log("Waiting for all candidates..."),null)}(e,n);n.success(t)}else{let t=await async function(e,t){(t=t||{}).customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:i.noop;let n=b.get(e);if(!n||!n.webrtcStuff)throw i.warn("Invalid handle"),"Invalid handle";let r=n.webrtcStuff;i.log("Creating offer (iceDone="+r.iceDone+")");let o={};!0===t.iceRestart&&(o.iceRestart=!0),i.debug(o);let a=await r.pc.createOffer(o);i.debug(a);let s={type:"offer",sdp:a.sdp};return t.customizeSdp(s),a.sdp=s.sdp,i.log("Setting local description"),r.mySdp={type:"offer",sdp:a.sdp},await r.pc.setLocalDescription(a),r.mediaConstraints=o,r.iceDone||r.trickle?(r.insertableStreams&&(a.e2ee=!0),a):(i.log("Waiting for all candidates..."),null)}(e,n);n.success(t)}}catch(e){i.error(e),n.error(e)}}function L(e,t){(t=t||{}).success="function"==typeof t.success?t.success:i.noop,t.error="function"==typeof t.error?t.error:H,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:i.noop;let n=t.jsep,r=b.get(e);if(!r||!r.webrtcStuff)return i.warn("Invalid handle"),void t.error("Invalid handle");let o=r.webrtcStuff;if(n){if(!o.pc)return i.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");t.customizeSdp(n),o.pc.setRemoteDescription(n).then((function(){if(i.log("Remote description accepted!"),o.remoteSdp=n.sdp,o.candidates&&o.candidates.length>0){for(let e=0;e<o.candidates.length;e++){let t=o.candidates[e];i.debug("Adding remote candidate:",t),t&&!0!==t.completed?o.pc.addIceCandidate(t):o.pc.addIceCandidate(i.endOfCandidates)}o.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}async function M(e,t){if((t=t||{}).success="function"==typeof t.success?t.success:i.noop,t.error="function"==typeof t.error?t.error:i.noop,t.tracks&&!Array.isArray(t.tracks))return i.error("Tracks must be an array"),void t.error("Tracks must be an array");for(let e of t.tracks)(e.add||!e.replace&&!e.remove)&&(e.replace=!0);try{await N(e,t),t.success()}catch(e){i.error(e),t.error(e)}}async function N(e,t){let n=b.get(e);if(!n||!n.webrtcStuff)throw i.warn("Invalid handle, not sending anything"),"Invalid handle";let r=n.webrtcStuff;if(!r.pc)throw i.warn("Invalid PeerConnection"),"Invalid PeerConnection";let o=t.tracks;if(!o||!Array.isArray(o)||0===o.length)return;let a=!1,s={};for(let e of o){if(delete e.gumGroup,!e.type||!["audio","video"].includes(e.type))continue;if(!e.capture||e.capture instanceof MediaStreamTrack)continue;let t=e.group?e.group:"default";s[t]||(s[t]={}),s[t][e.type]||(e.gumGroup=t,s[t][e.type]=e)}let l=Object.keys(s);for(let e of l){let t=s[e];t.audio&&t.video||(t.audio&&delete t.audio.gumGroup,t.video&&delete t.video.gumGroup,delete s[e])}let u=!!t.jsep;for(let t of o){if(!t.type){i.warn("Missing track type:",t);continue}if("data"===t.type){if(r.pc.ondatachannel){i.warn("Data channel exists already, not creating another one");continue}i.log("Creating default data channel"),A(e,i.dataChanDefaultLabel,null,!1),r.pc.ondatachannel=function(t){i.log("Data channel created by Janus:",t),A(e,t.channel.label,t.channel.protocol,t.channel)};continue}if(void 0!==t.add&&null!==t.add||void 0!==t.remove&&null!==t.remove||void 0!==t.replace&&null!==t.replace||(t.add=!0),t.add&&t.remove||t.add&&t.remove&&t.replace){i.warn("Conflicting actions for track, ignoring:",t);continue}t.add&&t.replace?(i.warn("Both add and replace provided, falling back to replace:",t),delete t.add):t.remove&&t.replace&&(i.warn("Both remove and replace provided, falling back to remove:",t),delete t.replace);let o=t.type;"screen"===t.type&&(o="video");let l=null,c=null;if(l=t.mid?r.pc.getTransceivers().find((e=>e.mid===t.mid&&e.receiver.track.kind===o)):r.pc.getTransceivers().find((e=>e.receiver.track.kind===o)),t.replace||t.remove){if(!l){i.warn("Couldn't find a transceiver for track:",t);continue}if(!l.sender){i.warn("No sender in the transceiver for track:",t);continue}c=l.sender}if(u&&!l&&(l=r.pc.getTransceivers().find((e=>e.receiver.track.kind===o)),!l)){i.warn("Couldn't find a transceiver for track:",t);continue}let d=null,h=null;if((t.remove||t.replace)&&(i.log("Removing track from PeerConnection",t),h=c.track?c.track.id:null,await c.replaceTrack(null),h&&r.myStream)){let e=null;if("audio"===o&&r.myStream.getAudioTracks()&&r.myStream.getAudioTracks().length)for(let t of r.myStream.getAudioTracks())t.id===h&&(e=t,i.log("Removing audio track:",e));else if("video"===o&&r.myStream.getVideoTracks()&&r.myStream.getVideoTracks().length)for(let t of r.myStream.getVideoTracks())t.id===h&&(e=t,i.log("Removing video track:",e));if(e){try{r.myStream.removeTrack(e),n.onlocaltrack(e,!1)}catch(e){i.error("Error calling onlocaltrack on removal for renegotiation",e)}if(!0!==e.dontStop)try{e.stop()}catch(e){}}}if(t.capture){if(t.gumGroup&&s[t.gumGroup]&&s[t.gumGroup].stream){let e=s[t.gumGroup].stream;d="audio"===t.type?e.getAudioTracks()[0]:e.getVideoTracks()[0],delete s[t.gumGroup].stream,delete s[t.gumGroup],delete t.gumGroup}else if(t.capture instanceof MediaStreamTrack)d=t.capture;else{a||(a=!0,n.consentDialog(!0));let e=i.trackConstraints(t),r=null;if("audio"===t.type||"video"===t.type){if(t.gumGroup){let n="audio"===t.type?"video":"audio";if(s[t.gumGroup]&&s[t.gumGroup][n]){let r=s[t.gumGroup][n],o=i.trackConstraints(r);e[n]=o[n]}}r=await navigator.mediaDevices.getUserMedia(e),t.gumGroup&&e.audio&&e.video&&(s[t.gumGroup].stream=r,delete t.gumGroup)}else r=await navigator.mediaDevices.getDisplayMedia(e);d="audio"===t.type?r.getAudioTracks()[0]:r.getVideoTracks()[0]}if(t.replace){await c.replaceTrack(d);let e="sendrecv";!1!==t.recv&&"inactive"!==l.direction&&"sendonly"!==l.direction||(e="sendonly"),l.setDirection?l.setDirection(e):l.direction=e}else{if(r.myStream||(r.myStream=new MediaStream),"audio"===o||!t.simulcast&&!t.svc)c=r.pc.addTrack(d,r.myStream),l=r.pc.getTransceivers().find((e=>e.sender===c));else if(t.simulcast){if("firefox"!==i.webRTCAdapter.browserDetails.browser){i.log("Enabling rid-based simulcasting:",d);let e=y(t.simulcastMaxBitrates);l=r.pc.addTransceiver(d,{direction:"sendrecv",streams:[r.myStream],sendEncodings:t.sendEncodings||[{rid:"h",active:!0,scalabilityMode:"L1T2",maxBitrate:e.high},{rid:"m",active:!0,scalabilityMode:"L1T2",maxBitrate:e.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,scalabilityMode:"L1T2",maxBitrate:e.low,scaleResolutionDownBy:4}]})}else if(i.log("Enabling Simulcasting for Firefox (RID)"),l=r.pc.addTransceiver(d,{direction:"sendrecv",streams:[r.myStream]}),c=l?l.sender:null,c){let e=c.getParameters();e||(e={});let n=y(t.simulcastMaxBitrates);e.encodings=t.sendEncodings||[{rid:"h",active:!0,maxBitrate:n.high},{rid:"m",active:!0,maxBitrate:n.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:n.low,scaleResolutionDownBy:4}],c.setParameters(e)}}else i.log("Enabling SVC ("+t.svc+"):",d),l=r.pc.addTransceiver(d,{direction:"sendrecv",streams:[r.myStream],sendEncodings:[{scalabilityMode:t.svc}]});if(c||(c=l?l.sender:null),t.codec)if("firefox"===i.webRTCAdapter.browserDetails.browser)i.warn("setCodecPreferences not supported in Firefox, ignoring codec for track:",t);else if("string"!=typeof t.codec)i.warn("Invalid codec value, ignoring for track:",t);else{let e=o+"/"+t.codec.toLowerCase(),n=RTCRtpReceiver.getCapabilities(o).codecs.filter((function(t){return t.mimeType.toLowerCase()===e}));if(n&&0!==n.length){if(l)try{l.setCodecPreferences(n)}catch(e){i.warn("Failed enforcing codec for this "+o+" track:",e)}}else i.warn("Codec not supported in this browser for this track, ignoring:",t)}if(t.bitrate)if(t.simulcast||t.svc)i.warn("Ignoring bitrate for simulcast/SVC track, use sendEncodings for that");else if(isNaN(t.bitrate)||t.bitrate<0)i.warn("Ignoring invalid bitrate for track:",t);else if(c){let e=c.getParameters();e&&e.encodings&&0!==e.encodings.length?(e.encodings[0].maxBitrate=t.bitrate,await c.setParameters(e)):i.warn("No encodings in the sender parameters, ignoring bitrate for track:",t)}if("video"===o&&t.framerate)if(t.simulcast||t.svc)i.warn("Ignoring framerate for simulcast/SVC track, use sendEncodings for that");else if(isNaN(t.framerate)||t.framerate<0)i.warn("Ignoring invalid framerate for track:",t);else if(c){let e=c.getParameters();e&&e.encodings&&0!==e.encodings.length?(e.encodings[0].maxFramerate=t.framerate,await c.setParameters(e)):i.warn("No encodings in the sender parameters, ignoring framerate for track:",t)}if(t.transforms){if(c&&t.transforms.sender){let e=null;RTCRtpSender.prototype.createEncodedStreams?e=c.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===o?e=c.createEncodedAudioStreams():"video"===o&&(e=c.createEncodedVideoStreams())),e&&(e.readableStream&&e.writableStream?e.readableStream.pipeThrough(t.transforms.sender).pipeTo(e.writableStream):e.readable&&e.writable&&e.readable.pipeThrough(t.transforms.sender).pipeTo(e.writable))}if(l&&l.receiver&&t.transforms.receiver){let e=null;RTCRtpReceiver.prototype.createEncodedStreams?e=l.receiver.createEncodedStreams():(RTCRtpReceiver.prototype.createAudioEncodedStreams||RTCRtpReceiver.prototype.createEncodedVideoStreams)&&("audio"===o?e=l.receiver.createEncodedAudioStreams():"video"===o&&(e=l.receiver.createEncodedVideoStreams())),e&&(e.readableStream&&e.writableStream?e.readableStream.pipeThrough(t.transforms.receiver).pipeTo(e.writableStream):e.readable&&e.writable&&e.readable.pipeThrough(t.transforms.receiver).pipeTo(e.writable))}}}d&&!0===t.dontStop&&(d.dontStop=!0)}else if(t.recv&&(l||(l=r.pc.addTransceiver(o)),l)){if(t.codec)if("firefox"===i.webRTCAdapter.browserDetails.browser)i.warn("setCodecPreferences not supported in Firefox, ignoring codec for track:",t);else if("string"!=typeof t.codec)i.warn("Invalid codec value, ignoring for track:",t);else{let e=o+"/"+t.codec.toLowerCase(),n=RTCRtpReceiver.getCapabilities(o).codecs.filter((function(t){return t.mimeType.toLowerCase()===e}));if(n&&0!==n.length)try{l.setCodecPreferences(n)}catch(e){i.warn("Failed enforcing codec for this "+o+" track:",e)}else i.warn("Codec not supported in this browser for this track, ignoring:",t)}if(l.receiver&&t.transforms&&t.transforms.receiver){let e=null;RTCRtpReceiver.prototype.createEncodedStreams?e=l.receiver.createEncodedStreams():(RTCRtpReceiver.prototype.createAudioEncodedStreams||RTCRtpReceiver.prototype.createEncodedVideoStreams)&&("audio"===o?e=l.receiver.createEncodedAudioStreams():"video"===o&&(e=l.receiver.createEncodedVideoStreams())),e&&(e.readableStream&&e.writableStream?e.readableStream.pipeThrough(t.transforms.receiver).pipeTo(e.writableStream):e.readable&&e.writable&&e.readable.pipeThrough(t.transforms.receiver).pipeTo(e.writable))}}if(d){r.myStream.addTrack(d),d.onended=function(e){i.log("Local track removed:",e);try{n.onlocaltrack(e.target,!1)}catch(e){i.error("Error calling onlocaltrack following end",e)}};try{n.onlocaltrack(d,!0)}catch(e){i.error("Error calling onlocaltrack for track add",e)}}if(l){let e=l.direction,n=null,r=d&&l.sender.track,o=!1!==t.recv&&l.receiver.track;r&&o?n="sendrecv":r&&!o?n="sendonly":!r&&o?n="recvonly":r||o||(n="inactive"),n&&n!==e&&(i.warn("Changing direction of transceiver to "+n+" (was "+e+")",t),l.setDirection?l.setDirection(n):l.direction=n)}}a&&n.consentDialog(!1)}function B(e){let t=b.get(e);if(!t||!t.webrtcStuff)return i.warn("Invalid handle"),null;let n=t.webrtcStuff;if(!n.pc)return i.warn("Invalid PeerConnection"),null;let r=[],o=n.pc.getTransceivers();for(let e of o){let t=null;e.sender&&e.sender.track&&(t={mid:e.mid},t.type=e.sender.track.kind,t.id=e.sender.track.id,t.label=e.sender.track.label),t&&r.push(t)}return r}function U(e){let t=b.get(e);if(!t||!t.webrtcStuff)return i.warn("Invalid handle"),null;let n=t.webrtcStuff;if(!n.pc)return i.warn("Invalid PeerConnection"),null;let r=[],o=n.pc.getTransceivers();for(let e of o){let t=null;e.receiver&&e.receiver.track&&(t={mid:e.mid},t.type=e.receiver.track.kind,t.id=e.receiver.track.id,t.label=e.receiver.track.label),t&&r.push(t)}return r}function W(e,t,n,r){r="function"==typeof r?r:i.noop;let o=b.get(e);if(!o||!o.webrtcStuff)return i.warn("Invalid handle"),void r(0);let a=n?"remote":"local",s=o.webrtcStuff;if(s.volume[a]||(s.volume[a]={value:0}),s.pc&&s.pc.getStats&&("chrome"===i.webRTCAdapter.browserDetails.browser||"safari"===i.webRTCAdapter.browserDetails.browser)){let e=s.pc;if(t){let o=s.pc.getTransceivers().find((e=>e.mid===t&&"audio"===e.receiver.track.kind));if(!o)return i.warn("No audio transceiver with mid "+t),void r(0);if(n&&!o.receiver)return i.warn("Remote transceiver track unavailable"),void r(0);if(!n&&!o.sender)return i.warn("Local transceiver track unavailable"),void r(0);e=n?o.receiver:o.sender}return e.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(n&&!e.remoteSource||!n&&"media-source"!==e.type||r(e.audioLevel?e.audioLevel:0))}))})),s.volume[a].value}return i.warn("Getting the "+a+" volume unsupported by browser"),void r(0)}function V(e,t,n){let r=b.get(e);if(!r||!r.webrtcStuff)return i.warn("Invalid handle"),!0;let o=r.webrtcStuff;if(!o.pc)return i.warn("Invalid PeerConnection"),!0;if(!o.myStream)return i.warn("Invalid local MediaStream"),!0;if(n){if(!o.myStream.getVideoTracks()||0===o.myStream.getVideoTracks().length)return i.warn("No video track"),!0;if(t){let e=o.pc.getTransceivers().find((e=>e.mid===t&&"video"===e.receiver.track.kind));return e?e.sender&&e.sender.track?!e.sender.track.enabled:(i.warn("No video sender with mid "+t),!0):(i.warn("No video transceiver with mid "+t),!0)}return!o.myStream.getVideoTracks()[0].enabled}if(!o.myStream.getAudioTracks()||0===o.myStream.getAudioTracks().length)return i.warn("No audio track"),!0;if(t){let e=o.pc.getTransceivers().find((e=>e.mid===t&&"audio"===e.receiver.track.kind));return e?e.sender&&e.sender.track?!e.sender.track.enabled:(i.warn("No audio sender with mid "+t),!0):(i.warn("No audio transceiver with mid "+t),!0)}return!o.myStream.getAudioTracks()[0].enabled}function G(e,t,n,r){let o=b.get(e);if(!o||!o.webrtcStuff)return i.warn("Invalid handle"),!1;let a=o.webrtcStuff;if(!a.pc)return i.warn("Invalid PeerConnection"),!1;if(!a.myStream)return i.warn("Invalid local MediaStream"),!1;if(n){if(!a.myStream.getVideoTracks()||0===a.myStream.getVideoTracks().length)return i.warn("No video track"),!1;if(t){let e=a.pc.getTransceivers().find((e=>e.mid===t&&"video"===e.receiver.track.kind));if(!e)return i.warn("No video transceiver with mid "+t),!1;if(!e.sender||!e.sender.track)return i.warn("No video sender with mid "+t),!1;e.sender.track.enabled=!r}else for(const e of a.myStream.getVideoTracks())e.enabled=!r}else{if(!a.myStream.getAudioTracks()||0===a.myStream.getAudioTracks().length)return i.warn("No audio track"),!1;if(t){let e=a.pc.getTransceivers().find((e=>e.mid===t&&"audio"===e.receiver.track.kind));if(!e)return i.warn("No audio transceiver with mid "+t),!1;if(!e.sender||!e.sender.track)return i.warn("No audio sender with mid "+t),!1;e.sender.track.enabled=!r}else for(const e of a.myStream.getAudioTracks())e.enabled=!r}return!0}function j(e,t){let n=b.get(e);if(!n||!n.webrtcStuff)return i.warn("Invalid handle"),"Invalid handle";let r=n.webrtcStuff;if(!r.pc)return"Invalid PeerConnection";if(r.pc.getStats){let e=r.pc,n=t||"default";if(t){let n=r.pc.getTransceivers().find((e=>e.mid===t&&"video"===e.receiver.track.kind));if(!n)return i.warn("No video transceiver with mid "+t),"No video transceiver with mid "+t;if(!n.receiver)return i.warn("No video receiver with mid "+t),"No video receiver with mid "+t;e=n.receiver}return r.bitrate[n]||(r.bitrate[n]={timer:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,value:"0 kbits/sec"}),r.bitrate[n].timer?r.bitrate[n].value:(i.log("Starting bitrate timer"+(t?" for mid "+t:"")+" (via getStats)"),r.bitrate[n].timer=setInterval((function(){e.getStats().then((function(e){e.forEach((function(e){if(!e)return;let t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(r.bitrate[n].bsnow=e.bytesReceived,r.bitrate[n].tsnow=e.timestamp,null===r.bitrate[n].bsbefore||null===r.bitrate[n].tsbefore)r.bitrate[n].bsbefore=r.bitrate[n].bsnow,r.bitrate[n].tsbefore=r.bitrate[n].tsnow;else{let e=r.bitrate[n].tsnow-r.bitrate[n].tsbefore;"safari"===i.webRTCAdapter.browserDetails.browser&&(e/=1e3);let t=Math.round(8*(r.bitrate[n].bsnow-r.bitrate[n].bsbefore)/e);"safari"===i.webRTCAdapter.browserDetails.browser&&(t=parseInt(t/1e3)),r.bitrate[n].value=t+" kbits/sec",r.bitrate[n].bsbefore=r.bitrate[n].bsnow,r.bitrate[n].tsbefore=r.bitrate[n].tsnow}}))}))}),1e3),"0 kbits/sec")}return i.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"}function z(e,t,n){let r=b.get(e);if(!r||!r.webrtcStuff)return void i.warn("Invalid handle");let o=r.webrtcStuff;if(!o.pc)return void i.warn("Invalid PeerConnection");let a=o.pc.getTransceivers().find((e=>e.mid===t));if(!a)return void i.warn("No transceiver with mid",t);if(!a.sender)return void i.warn("No sender for transceiver with mid",t);let s=a.sender.getParameters();s&&s.encodings&&0!==s.encodings.length?s.encodings.length>1?i.warn("Ignoring bitrate for simulcast track, use sendEncodings for that"):isNaN(n)||n<0?i.warn("Invalid bitrate (must be a positive integer)"):(s.encodings[0].maxBitrate=n,a.sender.setParameters(s)):i.warn("No parameters encodings")}function H(e){i.error("WebRTC error:",e)}function X(e,r){i.log("Cleaning WebRTC stuff");let o=b.get(e);if(!o)return;let a=o.webrtcStuff;if(a){if(!0===r){let r={janus:"hangup",transaction:i.randomString(12)};o.token&&(r.token=o.token),g&&(r.apisecret=g),i.debug("Sending hangup request (handle="+e+"):"),i.debug(r),t?(r.session_id=w,r.handle_id=e,n.send(JSON.stringify(r))):i.httpAPICall(l+"/"+w+"/"+e,{verb:"POST",withCredentials:h,body:r})}a.volume&&(a.volume.local&&a.volume.local.timer&&clearInterval(a.volume.local.timer),a.volume.remote&&a.volume.remote.timer&&clearInterval(a.volume.remote.timer));for(let e in a.bitrate)a.bitrate[e].timer&&clearInterval(a.bitrate[e].timer);a.bitrate={},!a.streamExternal&&a.myStream&&(i.log("Stopping local stream tracks"),i.stopAllTracks(a.myStream)),a.streamExternal=!1,a.myStream=null;try{a.pc.close()}catch(e){}a.pc=null,a.candidates=null,a.mySdp=null,a.remoteSdp=null,a.iceDone=!1,a.dataChannel={},a.dtmfSender=null,a.insertableStreams=!1}o.oncleanup()}k(e),this.getServer=function(){return l},this.isConnected=function(){return x},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:i.noop,e.error="function"==typeof e.error?e.error:i.noop,e.reconnect=!0,k(e)},this.getSessionId=function(){return w},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:i.noop,e.error="function"==typeof e.error?e.error:i.noop,i.log("Getting info on Janus instance"),!x)return i.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");let r=i.randomString(12),o={janus:"info",transaction:r};if(p&&(o.token=p),g&&(o.apisecret=g),t)return T.set(r,(function(t){i.log("Server info:"),i.debug(t),"server_info"!==t.janus&&i.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)})),void n.send(JSON.stringify(o));i.httpAPICall(l,{verb:"POST",withCredentials:h,body:o,success:function(t){i.log("Server info:"),i.debug(t),"server_info"!==t.janus&&i.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},error:function(t,n){i.error(t+":",n),""===n?e.error(t+": Is the server down?"):e.error(t+": "+n)}})}(e)},this.destroy=function(a){!function(a){(a=a||{}).success="function"==typeof a.success?a.success:i.noop,a.error="function"==typeof a.error?a.error:i.noop;let s=!0===a.unload,u=!0;void 0!==a.notifyDestroyed&&null!==a.notifyDestroyed&&(u=!0===a.notifyDestroyed);let c=!0===a.cleanupHandles;if(i.log("Destroying session "+w+" (unload="+s+")"),!w)return i.warn("No session to destroy"),a.success(),void(u&&e.destroyed());if(c)for(const e of b.keys())$(e,{noRequest:!0});if(!x)return i.warn("Is the server down? (connected=false)"),w=null,void a.success();let d={janus:"destroy",transaction:i.randomString(12)};if(p&&(d.token=p),g&&(d.apisecret=g),s)return t?(n.onclose=null,n.close(),n=null):navigator.sendBeacon(l+"/"+w,JSON.stringify(d)),i.log("Destroyed session:"),w=null,x=!1,a.success(),void(u&&e.destroyed());if(t){d.session_id=w;let t=function(){for(let e in r)n.removeEventListener(e,r[e]);n.removeEventListener("message",i),n.removeEventListener("error",s),o&&clearTimeout(o),n.close()},i=function(n){let r=JSON.parse(n.data);r.session_id==d.session_id&&r.transaction==d.transaction&&(t(),a.success(),u&&e.destroyed())},s=function(){t(),a.error("Failed to destroy the server: Is the server down?"),u&&e.destroyed()};return n.addEventListener("message",i),n.addEventListener("error",s),void(1===n.readyState?n.send(JSON.stringify(d)):s())}i.httpAPICall(l+"/"+w,{verb:"POST",withCredentials:h,body:d,success:function(t){i.log("Destroyed session:"),i.debug(t),w=null,x=!1,"success"!==t.janus&&i.error("Ooops: "+t.error.code+" "+t.error.reason),a.success(),u&&e.destroyed()},error:function(t,n){i.error(t+":",n),w=null,x=!1,a.success(),u&&e.destroyed()}})}(a)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:i.noop,e.error="function"==typeof e.error?e.error:i.noop,e.dataChannelOptions=e.dataChannelOptions||{ordered:!0},e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:i.noop,e.iceState="function"==typeof e.iceState?e.iceState:i.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:i.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:i.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:i.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:i.noop,e.onlocaltrack="function"==typeof e.onlocaltrack?e.onlocaltrack:i.noop,e.onremotetrack="function"==typeof e.onremotetrack?e.onremotetrack:i.noop,e.ondata="function"==typeof e.ondata?e.ondata:i.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:i.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:i.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:i.noop,!x)return i.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");let r=e.plugin;if(!r)return i.error("Invalid plugin"),void e.error("Invalid plugin");let o=e.opaqueId,a=e.loopIndex,s=e.token?e.token:p,u=i.randomString(12),c={janus:"attach",plugin:r,opaque_id:o,loop_index:a,transaction:u};if(s&&(c.token=s),g&&(c.apisecret=g),t)return T.set(u,(function(t){if(i.debug(t),"success"!==t.janus)return i.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);let n=t.data.id;i.log("Created handle: "+n);let o={session:C,plugin:r,id:n,token:s,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,bitrate:{}},getId:function(){return n},getPlugin:function(){return r},getVolume:function(e,t){return W(n,e,!0,t)},getRemoteVolume:function(e,t){return W(n,e,!0,t)},getLocalVolume:function(e,t){return W(n,e,!1,t)},isAudioMuted:function(e){return V(n,e,!1)},muteAudio:function(e){return G(n,e,!1,!0)},unmuteAudio:function(e){return G(n,e,!1,!1)},isVideoMuted:function(e){return V(n,e,!0)},muteVideo:function(e){return G(n,e,!0,!0)},unmuteVideo:function(e){return G(n,e,!0,!1)},getBitrate:function(e){return j(n,e)},setMaxBitrate:function(e,t){return z(n,e,t)},send:function(e){O(n,e)},data:function(e){P(n,e)},dtmf:function(e){D(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){F(n,!0,e)},createAnswer:function(e){F(n,!1,e)},handleRemoteJsep:function(e){L(n,e)},replaceTracks:function(e){M(n,e)},getLocalTracks:function(){return B(n)},getRemoteTracks:function(){return U(n)},onlocaltrack:e.onlocaltrack,onremotetrack:e.onremotetrack,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){X(n,!0===e)},detach:function(e){$(n,e)}};b.set(n,o),e.success(o)})),c.session_id=w,void n.send(JSON.stringify(c));i.httpAPICall(l+"/"+w,{verb:"POST",withCredentials:h,body:c,success:function(t){if(i.debug(t),"success"!==t.janus)return i.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);let n=t.data.id;i.log("Created handle: "+n);let o={session:C,plugin:r,id:n,token:s,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,bitrate:{}},getId:function(){return n},getPlugin:function(){return r},getVolume:function(e,t){return W(n,e,!0,t)},getRemoteVolume:function(e,t){return W(n,e,!0,t)},getLocalVolume:function(e,t){return W(n,e,!1,t)},isAudioMuted:function(e){return V(n,e,!1)},muteAudio:function(e){return G(n,e,!1,!0)},unmuteAudio:function(e){return G(n,e,!1,!1)},isVideoMuted:function(e){return V(n,e,!0)},muteVideo:function(e){return G(n,e,!0,!0)},unmuteVideo:function(e){return G(n,e,!0,!1)},getBitrate:function(e){return j(n,e)},setMaxBitrate:function(e,t){return z(n,e,t)},send:function(e){O(n,e)},data:function(e){P(n,e)},dtmf:function(e){D(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){F(n,!0,e)},createAnswer:function(e){F(n,!1,e)},handleRemoteJsep:function(e){L(n,e)},replaceTracks:function(e){M(n,e)},getLocalTracks:function(){return B(n)},getRemoteTracks:function(){return U(n)},onlocaltrack:e.onlocaltrack,onremotetrack:e.onremotetrack,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){X(n,!0===e)},detach:function(e){$(n,e)}};b.set(n,o),e.success(o)},error:function(t,n){i.error(t+":",n),""===n?e.error(t+": Is the server down?"):e.error(t+": "+n)}})}(e)}}i.useDefaultDependencies=function(e){let t=e&&e.fetch||fetch,n=e&&e.Promise||Promise,o=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new o(e,t)},extension:e&&e.extension||r,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,r){let o={method:r.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===r.verb&&(o.headers["Content-Type"]="application/json"),void 0!==r.withCredentials&&(o.credentials=!0===r.withCredentials?"include":r.withCredentials?r.withCredentials:"omit"),r.body&&(o.body=JSON.stringify(r.body));let a=t(e,o).catch((function(e){return n.reject({message:"Probably a network error, is the server down?",error:e})}));if(r.timeout){let e=new n((function(e,t){let n=setTimeout((function(){return clearTimeout(n),t({message:"Request timed out",timeout:r.timeout})}),r.timeout)}));a=n.race([a,e])}return a.then((function(e){return e.ok?typeof r.success==typeof i.noop?e.json().then((function(e){try{r.success(e)}catch(e){i.error("Unhandled httpAPICall success callback error",e)}}),(function(t){return n.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:n.reject({message:"API call failed",response:e})})).catch((function(e){typeof r.error==typeof i.noop&&r.error(e.message||"<< internal error >>",e)})),a}}},i.useOldDependencies=function(e){let t=e&&e.jQuery||jQuery,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||r,webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,n){let r=void 0!==n.body?{contentType:"application/json",data:JSON.stringify(n.body)}:{},o=void 0!==n.withCredentials?{xhrFields:{withCredentials:n.withCredentials}}:{};return t.ajax(t.extend(r,o,{url:e,type:n.verb,cache:!1,dataType:"json",async:n.async,timeout:n.timeout,success:function(e){typeof n.success==typeof i.noop&&n.success(e)},error:function(e,t,r){typeof n.error==typeof i.noop&&n.error(t,r)}}))}}},i.mediaToTracks=function(e){let t=[];if(e){if(!e.keepAudio&&!1!==e.audio&&(void 0===e.audio||e.audio||e.audioSend||e.audioRecv||e.addAudio||e.replaceAudio||e.removeAudio)){let n={type:"audio"};e.removeAudio?n.remove=!0:(e.addAudio?n.add=!0:e.replaceAudio&&(n.replace=!0),!1!==e.audioSend&&(n.capture=e.audio||!0),!1!==e.audioRecv&&(n.recv=!0)),(n.remove||n.capture||n.recv)&&t.push(n)}if(!e.keepVideo&&!1!==e.video&&(void 0===e.video||e.video||e.videoSend||e.videoRecv||e.addVideo||e.replaceVideo||e.removeVideo)){let n={type:"video"};e.removeVideo?n.remove=!0:(e.addVideo?n.add=!0:e.replaceVideo&&(n.replace=!0),!1!==e.videoSend&&(n.capture=e.video||!0,["screen","window","desktop"].includes(n.capture)&&(n.type="screen",n.capture={video:{}},e.screenshareFrameRate&&(n.capture.frameRate=e.screenshareFrameRate),e.screenshareHeight&&(n.capture.height=e.screenshareHeight),e.screenshareWidth&&(n.capture.width=e.screenshareWidth))),!1!==e.videoRecv&&(n.recv=!0)),(n.remove||n.capture||n.recv)&&t.push(n)}e.data&&t.push({type:"data"})}else t.push({type:"audio",capture:!0,recv:!0}),t.push({type:"video",capture:!0,recv:!0});return t},i.trackConstraints=function(e){let t={};if(!e||!e.capture)return t;if("audio"===e.type)t.audio=e.capture;else if("video"===e.type)if((e.simulcast||e.svc)&&!0===e.capture&&(e.capture="hires"),!0===e.capture||"object"==typeof e.capture)t.video=e.capture;else{let n=0,r=0;"lowres"===e.capture?(n=320,r=240):"lowres-16:9"===e.capture?(n=320,r=180):"hires"===e.capture||"hires-16:9"===e.capture||"hdres"===e.capture?(n=1280,r=720):"fhdres"===e.capture?(n=1920,r=1080):"4kres"===e.capture?(n=3840,r=2160):"stdres"===e.capture?(n=640,r=480):"stdres-16:9"===e.capture?(n=640,r=360):(i.log("Default video setting is stdres 4:3"),n=640,r=480),t.video={width:{ideal:n},height:{ideal:r}}}else"screen"===e.type&&(t.video=e.capture);return t},i.noop=function(){},i.dataChanDefaultLabel="JanusDataChannel",i.endOfCandidates=null,i.stopAllTracks=function(e){try{let t=e.getTracks();for(let e of t)i.log(e),e&&!0!==e.dontStop&&e.stop()}catch(e){}},i.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:i.noop,i.initDone)e.callback();else{if(void 0===console.log&&(console.log=function(){}),i.trace=i.noop,i.debug=i.noop,i.vdebug=i.noop,i.log=i.noop,i.warn=i.noop,i.error=i.noop,!0===e.debug||"all"===e.debug)i.trace=console.trace.bind(console),i.debug=console.debug.bind(console),i.vdebug=console.debug.bind(console),i.log=console.log.bind(console),i.warn=console.warn.bind(console),i.error=console.error.bind(console);else if(Array.isArray(e.debug))for(let t of e.debug)switch(t){case"trace":i.trace=console.trace.bind(console);break;case"debug":i.debug=console.debug.bind(console);break;case"vdebug":i.vdebug=console.debug.bind(console);break;case"log":i.log=console.log.bind(console);break;case"warn":i.warn=console.warn.bind(console);break;case"error":i.error=console.error.bind(console)}i.log("Initializing library");let t=e.dependencies||i.useDefaultDependencies();i.isArray=t.isArray,i.webRTCAdapter=t.webRTCAdapter,i.httpAPICall=t.httpAPICall,i.newWebSocket=t.newWebSocket,i.extension=t.extension,i.extension.init(),i.listDevices=function(e,t){e="function"==typeof e?e:i.noop,t||(t={audio:!0,video:!0}),i.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(n){i.debug(n),e(n),i.stopAllTracks(t)}))})).catch((function(t){i.error(t),e([])})):(i.warn("navigator.mediaDevices unavailable"),e([]))},i.attachMediaStream=function(e,t){try{e.srcObject=t}catch(n){try{e.src=URL.createObjectURL(t)}catch(e){i.error("Error attaching stream to element",e)}}},i.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(n){try{e.src=t.src}catch(e){i.error("Error reattaching stream to element",e)}}};let n=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",r=window["on"+n];if(window.addEventListener(n,(function(){i.log("Closing window");for(const[e,t]of i.sessions)t&&t.destroyOnUnload&&(i.log("Destroying session "+e),t.destroy({unload:!0,notifyDestroyed:!1}));r&&"function"==typeof r&&r()})),i.safariVp8=!1,i.safariVp9=!1,"safari"===i.webRTCAdapter.browserDetails.browser&&i.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(let e of RTCRtpSender.getCapabilities("video").codecs)e&&e.mimeType&&"video/vp8"===e.mimeType.toLowerCase()?i.safariVp8=!0:e&&e.mimeType&&"video/vp9"===e.mimeType.toLowerCase()&&(i.safariVp9=!0);i.safariVp8?i.log("This version of Safari supports VP8"):i.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{let e=new RTCPeerConnection({});e.createOffer({offerToReceiveVideo:!0}).then((function(t){i.safariVp8=-1!==t.sdp.indexOf("VP8"),i.safariVp9=-1!==t.sdp.indexOf("VP9"),i.safariVp8?i.log("This version of Safari supports VP8"):i.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),e.close(),e=null}))}i.initDone=!0,e.callback()}},i.isWebrtcSupported=function(){return!!window.RTCPeerConnection},i.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},i.randomString=function(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="";for(let r=0;r<e;r++){let e=Math.floor(Math.random()*t.length);n+=t.charAt(e)}return n}},43720:e=>{e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var i={},o={};function a(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=o[e])?r:(n=l(e,(0|e)<0?-1:0,!0),a&&(o[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=l(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function s(e,t){if(isNaN(e))return t?v:m;if(t){if(e<0)return v;if(e>=f)return C}else{if(e<=-p)return S;if(e+1>=p)return b}return e<0?s(-e,t).neg():l(e%h|0,e/h|0,t)}function l(e,t,r){return new n(e,t,r)}n.fromInt=a,n.fromNumber=s,n.fromBits=l;var u=Math.pow;function c(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(e.substring(1),t,n).neg();for(var i=s(u(n,8)),o=m,a=0;a<e.length;a+=8){var l=Math.min(8,e.length-a),d=parseInt(e.substring(a,a+l),n);if(l<8){var h=s(u(n,l));o=o.mul(h).add(s(d))}else o=(o=o.mul(i)).add(s(d))}return o.unsigned=t,o}function d(e,t){return"number"==typeof e?s(e,t):"string"==typeof e?c(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=c,n.fromValue=d;var h=4294967296,f=h*h,p=f/2,g=a(1<<24),m=a(0);n.ZERO=m;var v=a(0,!0);n.UZERO=v;var y=a(1);n.ONE=y;var x=a(1,!0);n.UONE=x;var w=a(-1);n.NEG_ONE=w;var b=l(-1,2147483647,!1);n.MAX_VALUE=b;var C=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=C;var S=l(0,-2147483648,!1);n.MIN_VALUE=S;var T=n.prototype;T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=s(u(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),c=(o.sub(l.mul(i)).toInt()>>>0).toString(e);if((o=l).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return r(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){if(r(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(y)},T.neg=T.negate,T.add=function(e){r(e)||(e=d(e));var t=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,a=e.high>>>16,s=65535&e.high,u=e.low>>>16,c=0,h=0,f=0,p=0;return f+=(p+=o+(65535&e.low))>>>16,h+=(f+=i+u)>>>16,c+=(h+=n+s)>>>16,c+=t+a,l((f&=65535)<<16|(p&=65535),(c&=65535)<<16|(h&=65535),this.unsigned)},T.subtract=function(e){return r(e)||(e=d(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=d(e)),t)return l(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(S))return e.isOdd()?S:m;if(e.eq(S))return this.isOdd()?S:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,o=this.low>>>16,a=65535&this.low,u=e.high>>>16,c=65535&e.high,h=e.low>>>16,f=65535&e.low,p=0,v=0,y=0,x=0;return y+=(x+=a*f)>>>16,v+=(y+=o*f)>>>16,y&=65535,v+=(y+=a*h)>>>16,p+=(v+=i*f)>>>16,v&=65535,p+=(v+=o*h)>>>16,v&=65535,p+=(v+=a*c)>>>16,p+=n*f+i*h+o*c+a*u,l((y&=65535)<<16|(x&=65535),(p&=65535)<<16|(v&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(e){if(r(e)||(e=d(e)),e.isZero())throw Error("division by zero");var n,i,o;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return x;o=v}else{if(this.eq(S))return e.eq(y)||e.eq(w)?S:e.eq(S)?y:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?y:w:(i=this.sub(e.mul(n)),o=n.add(i.div(e)));if(e.eq(S))return this.unsigned?v:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=m}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),c=a<=48?1:u(2,a-48),h=s(n),f=h.mul(e);f.isNegative()||f.gt(i);)f=(h=s(n-=c,this.unsigned)).mul(e);h.isZero()&&(h=y),o=o.add(h),i=i.sub(f)}return o},T.div=T.divide,T.modulo=function(e){return r(e)||(e=d(e)),t?l((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return l(~this.low,~this.high,this.unsigned)},T.and=function(e){return r(e)||(e=d(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return r(e)||(e=d(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return r(e)||(e=d(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return r(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},57539:e=>{"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let i=3;i<r.length;i++){const o=r[i],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){const r=t.parseRtpMap(a),i=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=i.length?t.parseFmtp(i[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let l;const u=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));u.length>0&&u[0].length>1&&u[0][0]===s&&(l=u[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&l&&(t.rtx={ssrc:l}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let c=t.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substring(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=c}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t},36377:(e,t,n)=>{var r=n(84832),i=n(68652),o=n(90801),a=n(92030),s=n(3618),l=n(89049),u=n(51971);u.alea=r,u.xor128=i,u.xorwow=o,u.xorshift7=a,u.xor4096=s,u.tychei=l,e.exports=u},84832:function(e,t,n){var r;!function(e,i,o){function a(e){var t,n=this,r=(t=4022871197,function(e){e=String(e);for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function l(e,t){var n=new a(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(t,n,t,i))||(i.exports=r):this.alea=l}(0,e=n.nmd(e),n.amdD)},89049:function(e,t,n){var r;!function(e,i,o){function a(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function l(e,t){var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(t,n,t,i))||(i.exports=r):this.tychei=l}(0,e=n.nmd(e),n.amdD)},68652:function(e,t,n){var r;!function(e,i,o){function a(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function l(e,t){var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(t,n,t,i))||(i.exports=r):this.xor128=l}(0,e=n.nmd(e),n.amdD)},3618:function(e,t,n){var r;!function(e,i,o){function a(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,n=i[o+34&127],e=i[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[o]=n^e,t.i=o,n+(r^r>>>16)|0},function(e,t){var n,r,i,o,a,s=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),i=0,o=-32;o<l;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,i=0==(n=s[127&o]^=r+a)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=a,e.X=s,e.i=i}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function l(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(t,n,t,i))||(i.exports=r):this.xor4096=l}(0,e=n.nmd(e),n.amdD)},92030:function(e,t,n){var r;!function(e,i,o){function a(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function l(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(t,n,t,i))||(i.exports=r):this.xorshift7=l}(0,e=n.nmd(e),n.amdD)},90801:function(e,t,n){var r;!function(e,i,o){function a(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function l(e,t){var n=new a(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=l:n.amdD&&n.amdO?void 0===(r=function(){return l}.call(t,n,t,i))||(i.exports=r):this.xorwow=l}(0,e=n.nmd(e),n.amdD)},51971:function(e,t,n){var r;!function(i,o,a){var s,l=256,u=a.pow(l,6),c=a.pow(2,52),d=2*c,h=255;function f(e,t,n){var r=[],h=v(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(o)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(l):(e=new Uint8Array(l),(i.crypto||i.msCrypto).getRandomValues(e)),y(e)}catch(e){var t=i.navigator,n=t&&t.plugins;return[+new Date,i,n,i.screen,y(o)]}}():e,3),r),f=new p(r),x=function(){for(var e=f.g(6),t=u,n=0;e<c;)e=(e+n)*l,t*=l,n=f.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|f.g(4)},x.quick=function(){return f.g(4)/4294967296},x.double=x,v(y(f.S),o),(t.pass||n||function(e,t,n,r){return r&&(r.S&&g(r,f),e.state=function(){return g(f,{})}),n?(a.random=e,t):e})(x,h,"global"in t?t.global:this==a,t.state)}function p(e){var t,n=e.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];for(n||(e=[n++]);i<l;)a[i]=i++;for(i=0;i<l;i++)a[i]=a[o=h&o+e[i%n]+(t=a[i])],a[o]=t;(r.g=function(e){for(var t,n=0,i=r.i,o=r.j,a=r.S;e--;)t=a[i=h&i+1],n=n*l+a[h&(a[i]=a[o=h&o+t])+(a[o]=t)];return r.i=i,r.j=o,n})(l)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(m(e[n],t-1))}catch(e){}return r.length?r:"string"==i?e:e+"\0"}function v(e,t){for(var n,r=e+"",i=0;i<r.length;)t[h&i]=h&(n^=19*t[h&i])+r.charCodeAt(i++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(v(a.random(),o),e.exports){e.exports=f;try{s=n(75042)}catch(e){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}("undefined"!=typeof self?self:this,[],Math)}}]);