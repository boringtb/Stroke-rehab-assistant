(()=>{var e,t={17512:(e,t,s)=>{"use strict";var i=s(88478),n=(s(38795),s(96064));class o{constructor(){this.DBKeypoints=[["nose_x","nose_y","left_eye_x","left_eye_y","right_eye_x","right_eye_y","left_ear_x","left_ear_y","right_ear_x","right_ear_y","left_shoulder_x","left_shoulder_y","right_shoulder_x","right_shoulder_y","left_elbow_x","left_elbow_y","right_elbow_x","right_elbow_y","left_wrist_x","left_wrist_y","right_wrist_x","right_wrist_y","left_hip_x","left_hip_y","right_hip_x","right_hip_y","left_knee_x","left_knee_y","right_knee_x","right_knee_y","left_ankle_x","left_ankle_y","right_ankle_x","right_ankle_y"]]}addKeypoints=e=>{this.DBKeypoints.push(e)};saveToCSV=()=>{const e=this.DBKeypoints.map((e=>e.join(","))).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=new File([t],"datasetX.csv",{type:"text/csv"});console.log(s),this.uploadFile(s);const i=encodeURI(`data:text/csv;charset=utf-8,${e}`),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download","datasetX.csv"),document.body.appendChild(n),n.click(),this.DBKeypoints=[this.DBKeypoints[0]],document.body.removeChild(n)};uploadFile=async e=>{const t=new FormData;t.append("file",e,e.name);try{const e=await fetch("http://18.190.173.191:3000/upload",{method:"POST",body:t});if(e.ok)alert("File uploaded successfully");else{const t=await e.text();alert("File upload failed: "+t)}}catch(e){console.error("There was an error uploading the file:",e)}}}var a=s(93202);class r{constructor(){this.model=null,this.label=[],this.stdConfig=null}setup=async(e,t)=>{this.label=e.label,this.stdConfig=t,this.model=await(0,a.FB)(e.path)};standarization=e=>e.map(((e,t)=>t%2==0?e/this.stdConfig.width:e/this.stdConfig.height));predict=async e=>{if(!this.model&&!this.stdConfig)return null;const t=(0,i.XeE)([this.standarization(e)]),s=await this.model.predict(t).data();return Array.from(s).map(((e,t)=>({class:this.label[t],confidence:e})))}}class l{constructor(e){this.src=e.src,this.audioCtx=null,this.audioBuffer=null,this.isLoaded=!1}setup=async()=>{const e=window.AudioContext||window.webkitAudioContext;this.audioCtx=new e,this.audioBuffer=await this.getFile()};getFile=async()=>{const e=await fetch(this.src);if(!e.ok)throw new Error(`HTTP error${e.status}`);const t=await e.arrayBuffer(),s=await this.audioCtx.decodeAudioData(t);return this.isLoaded=!0,s};play=()=>{if(this.audioCtx&&this.audioBuffer){const e=this.audioCtx.createBufferSource();e.buffer=this.audioBuffer,e.connect(this.audioCtx.destination),e.start()}}}class c{constructor(e){this.count=0,this.rules=null,this.ctxPose=e,this.lastStage={},this.nextStage={},this.currStage={},this.sumObsPoints=0,this.obsStages=[],this.listAngles=[],this.isNewAssetsImgStages=!1,this.isPlayAudStage=!0,this.listAudStages={},this.audCount=new l({src:"./audio/count-from-pixabay.webm"}),this.audCount.setup()}initStage=()=>{this.currStage={},this.obsStages=[],this.sumObsPoints=0,this.rules.nameStage.forEach(((e,t)=>{this.obsStages.push({idStage:t,nameStage:e,sum:0,detail:{}})})),this.obsStages.push({idStage:-1,nameStage:"None",sum:0,detail:{}})};setup=e=>{this.rules=e,this.isNewAssetsImgStages=!0,this.initStage(),this.rules.nameStage.forEach(((e,t)=>{this.listAudStages[e]=new l({src:this.rules.pathAudioStage[t]}),this.listAudStages[e].setup()}))};resetCount=()=>{this.count=0};determineCurrStage=()=>{if(0!==this.obsStages.length){const e=[...this.obsStages].sort(((e,t)=>t.sum-e.sum)),t=e[0].sum===this.sumObsPoints?"FULL":"PARTIAL";if(this.currStage={statusStage:t,idStage:e[0].idStage,nameStage:e[0].nameStage},"FULL"===t&&this.currStage.nameStage!==this.lastStage.nameStage&&this.currStage.idStage===this.rules.nameStage.length-1&&(this.count+=1,this.isPlayAudStage&&this.audCount.isLoaded&&this.audCount.play()),"FULL"===t&&"None"!==e[0].nameStage&&(0===Object.keys(this.lastStage).length||this.lastStage.nameStage!==e[0].nameStage)){this.lastStage={idStage:e[0].idStage,nameStage:e[0].nameStage};const t=this.lastStage.idStage+1!==this.rules.nameStage.length?this.lastStage.idStage+1:0;this.nextStage={idStage:t,nameStage:this.rules.nameStage[t]}}}};getAdvice=()=>{if(0===Object.keys(this.nextStage).length)return"";let e="",t=1;const s=this.obsStages[this.nextStage.idStage].detail;return this.obsStages.forEach((i=>{i.nameStage!==this.nextStage.nameStage&&Object.keys(i.detail).forEach((n=>{if(n in s)return;1===t&&(e+=`<p>To move ${this.nextStage.nameStage} :</p>`);const{rangeAngle:o}=this.rules.anglePoint[n];e+=`<p>${t}) Angle <b>${i.detail[n].name.split("_").map((e=>e.charAt(0).toUpperCase()+e.substr(1))).join(" ")}</b> (${i.detail[n].angle}°) must between ${o[this.nextStage.idStage].min}° and ${o[this.nextStage.idStage].max}°</p>`,t+=1}))})),e};detectAnglesAndStages=(e,t)=>{this.rules&&this.ctxPose&&t===this.rules.nameWorkout&&(e.forEach(((t,s)=>{if(!(s in this.rules.anglePoint))return;const{spouseIdx:i,rangeAngle:n}=this.rules.anglePoint[s],o=e[i[0]],a=e[i[1]];let r=Math.atan2(o.y-t.y,o.x-t.x),l=Math.atan2(a.y-t.y,a.x-t.x),c=parseInt((l-r)/Math.PI*180+360,10)%360;this.ctxPose.moveTo(t.x,t.y),c>180&&(c=360-c,[r,l]=[l,r]),this.ctxPose.arc(t.x,t.y,20,r,l),this.ctxPose.fill(),this.listAngles.push([c,t.x+5,t.y]),this.sumObsPoints+=1;let d=!0;n.forEach(((t,i)=>{c>=t.min&&c<=t.max&&(this.obsStages[i].sum+=1,this.obsStages[i].detail[s]={name:e[s].name,angle:c},d=!1)})),d&&(this.obsStages[this.obsStages.length-1].sum+=1,this.obsStages[this.obsStages.length-1].detail[s]={name:e[s].name,angle:c})})),this.determineCurrStage())}}class d{constructor(e,t="user"){this._webcamElement=e,this._addVideoConfig={},this._facingMode=t,this._webcamList=[],this._streamList=[],this._selectedDeviceId=""}get facingMode(){return this._facingMode}set facingMode(e){this._facingMode=e}get webcamList(){return this._webcamList}get webcamCount(){return this._webcamList.length}get selectedDeviceId(){return this._selectedDeviceId}getVideoInputs(e){return this._webcamList=[],e.forEach((e=>{"videoinput"===e.kind&&this._webcamList.push(e)})),1===this._webcamList.length&&(this._facingMode="user"),this._webcamList}getMediaConstraints(){let e={};return""===this._selectedDeviceId?e.facingMode=this._facingMode:e.deviceId={exact:this._selectedDeviceId},e={...e,...this._addVideoConfig},{video:e,audio:!1}}selectCamera(){for(const e of this._webcamList)if("user"===this._facingMode&&e.label.toLowerCase().includes("front")||"environment"===this._facingMode&&e.label.toLowerCase().includes("back")){this._selectedDeviceId=e.deviceId;break}}flip(e){this._facingMode=e,"user"===this._facingMode?this._webcamElement.style.transform="scale(-1,1)":this._webcamElement.style.transform="",this.selectCamera()}async start(e=!0){return new Promise(((t,s)=>{this.stop(),navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then((i=>{this._streamList.push(i),this.info().then((()=>{this.selectCamera(),e?this.stream().then((()=>{t(this._facingMode)})).catch((e=>{s(e)})):t(this._selectedDeviceId)})).catch((e=>{s(e)}))})).catch((e=>{s(e)}))}))}async info(){return new Promise(((e,t)=>{navigator.mediaDevices.enumerateDevices().then((t=>{this.getVideoInputs(t),e(this._webcamList)})).catch((e=>{t(e)}))}))}async stream(){return new Promise(((e,t)=>{navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then((t=>{this._streamList.push(t),this._webcamElement.srcObject=t,"user"===this._facingMode&&(this._webcamElement.style.transform="scale(-1,1)"),this._webcamElement.play(),e(this._facingMode)})).catch((e=>{console.log(e),t(e)}))}))}stop(){this._streamList.forEach((e=>{e.getTracks().forEach((e=>{e.stop()}))}))}}class u{constructor(e,t){this.DBHandler=new o,this.isExtractKeypoints=!1,this.camHandler=new d(e),this.isVideoMode=!1,this.scaler=null,this.classifier=new r,this.isClassify=!0,this.currClass="",this.frameClassify=6,this.frame=0,this.fps=0,this.times=[],this.isLoop=!1,this.additionalElem={},this.webcamElem=e,this.cnvPoseElem=t,this.ctxPose=this.cnvPoseElem.getContext?this.cnvPoseElem.getContext("2d"):null,this.nameModel="",this.model=null,this.detector=null,this.detectorConfig={},this.estimationConfig={},this.thresholdPoints=.5,this.lines={0:[[0,1],[0,2],[0,17]],1:[[1,3]],2:[[2,4]],3:[],4:[],5:[[5,7],[5,11],[5,17]],6:[[6,8],[6,12],[6,17]],7:[[7,9]],8:[[8,10]],9:[],10:[],11:[[11,12],[11,13]],12:[[12,14]],13:[[13,15]],14:[[14,16]],15:[],16:[],17:[]},this.counter=new c(this.ctxPose),this.isShowAdvice=!1,this.isShowDirectionSign=!0,this.tmpStage=""}setup=async e=>{this.estimationConfig=e.estimationConfig,this.nameModel===e.model&&JSON.stringify(this.detectorConfig)===JSON.stringify(e.detectorConfig)||(this.nameModel=e.model,this.model=n.oV[this.nameModel],this.detectorConfig=e.detectorConfig,this.detector=await n.cH(this.model,this.detectorConfig))};getPose=async()=>this.detector.estimatePoses(this.webcamElem,this.estimationConfig);drawSkeleton=e=>{if(!this.ctxPose)return null;this.ctxPose.clearRect(0,0,this.cnvPoseElem.width,this.cnvPoseElem.height),this.ctxPose.save(),this.ctxPose.beginPath(),"user"===this.camHandler._facingMode&&(this.ctxPose.translate(this.cnvPoseElem.width,0),this.ctxPose.scale(-1,1)),this.scaler&&this.ctxPose.scale(this.scaler.w,this.scaler.h),this.ctxPose.fillStyle="#eab308",this.counter.initStage(),this.counter.detectAnglesAndStages(e,this.currClass),this.ctxPose.stroke(),this.ctxPose.fill(),this.ctxPose.beginPath(),this.ctxPose.fillStyle="rgba(45,253,255,255)",this.ctxPose.strokeStyle="black";const t=[];return e.forEach(((s,i)=>{t.push(s.x,s.y),s.score>this.thresholdPoints&&(this.ctxPose.moveTo(s.x,s.y),this.ctxPose.arc(s.x,s.y,5,0,2*Math.PI),this.lines[i].forEach((t=>{e[t[1]].score>this.thresholdPoints&&(this.ctxPose.moveTo(s.x,s.y),this.ctxPose.lineTo(e[t[1]].x,e[t[1]].y))})))})),this.isExtractKeypoints&&this.DBHandler.addKeypoints(t),this.ctxPose.stroke(),this.ctxPose.fill(),this.ctxPose.restore(),this.ctxPose.strokeStyle="white",this.counter.listAngles?(this.counter.listAngles.forEach((e=>{"user"===this.camHandler._facingMode&&(e[1]=1.15*e[1],e[2]=1.1*e[2],e[1]=640-e[1]),this.scaler&&(console.log("1",e[1]),e[1]=e[1]*this.scaler.w,e[2]=e[2]*this.scaler.h,console.log("2",e[1])),this.ctxPose.font="bold 18px Arial",this.ctxPose.fillStyle="white",this.ctxPose.fillText(`${e[0]}°`,e[1]+5,e[2]),this.ctxPose.strokeText(`${e[0]}°`,e[1]+5,e[2])})),this.counter.listAngles=[],t):t};FTV_threshold=.5;AddFTV=e=>(e&&0!==e.length&&e[0].keypoints[5].score>this.FTV_threshold&&e[0].keypoints[6].score>this.FTV_threshold?e[0].keypoints[17]={x:(e[0].keypoints[5].x+e[0].keypoints[6].x)/2,y:(e[0].keypoints[5].y+e[0].keypoints[6].y)/2,score:1,name:"FTV"}:e[0].keypoints[17]={x:0,y:0,score:0,name:"FTV"},e);drawPose=()=>{this.getPose().then((e=>{if(e&&0!==e.length){console.log("what do pose before?",e),e=this.AddFTV(e),console.log("what do we get of pose?",e);const t=this.drawSkeleton(e[0].keypoints);t&&this.isClassify&&this.additionalElem.confidenceElem&&this.frame%this.frameClassify==0&&this.classifier.predict(t).then((e=>{this.currClass=e[0].confidence>e[1].confidence?e[0].class:e[1].class,this.additionalElem.confidenceElem.style.clipPath=`inset(${100*(1-e[1].confidence.toFixed(6))}% 0 0 0)`}))}if(this.isClassify){if(this.additionalElem.countElem&&(this.additionalElem.countElem.innerText=this.counter.count),this.isShowDirectionSign&&this.additionalElem.imgDirectionSignElem&&0!==Object.keys(this.counter.nextStage).length&&this.tmpStage!==this.counter.nextStage.nameStage){if(this.tmpStage=this.counter.nextStage.nameStage,this.counter.isNewAssetsImgStages){this.counter.isNewAssetsImgStages=!1;let e="";this.counter.rules.pathImageStage.forEach((t=>{e+=`<img\n                class="animate-bounce"\n                style="width: 56px; display: none"\n                src="${t}"\n                alt="Direction Sign"\n              />`})),this.additionalElem.imgDirectionSignElem.innerHTML=e}this.additionalElem.imgDirectionSignElem.style.display=this.counter.nextStage.nameStage?"block":"none",this.additionalElem.imgDirectionSignElem.children[this.counter.lastStage.idStage].style.display="none",this.additionalElem.imgDirectionSignElem.children[this.counter.nextStage.idStage].style.display="block",this.counter.isPlayAudStage&&this.counter.listAudStages[this.counter.nextStage.nameStage].isLoaded&&this.counter.listAudStages[this.counter.nextStage.nameStage].play()}if(this.isShowAdvice&&this.additionalElem.adviceWrapElem){const e=this.counter.getAdvice();this.additionalElem.adviceWrapElem.style.display=e?"flex":"none",this.additionalElem.adviceWrapElem.children[0].innerText="Advice each frame",this.additionalElem.adviceWrapElem.children[1].innerHTML=e}}if(this.isLoop&&window.requestAnimationFrame(this.drawPose),this.additionalElem.fpsElem){const e=performance.now();for(;this.times.length>0&&this.times[0]<=e-1e3;)this.times.shift();this.times.push(e),this.fps=this.times.length-1,this.frame+=1,this.fps<15?this.frameClassify=Math.ceil(this.fps/3):this.fps>=15&&this.fps<30?this.frameClassify=Math.floor(this.fps/5):this.fps>=30&&this.fps<45?this.frameClassify=Math.floor(this.fps/7):this.frameClassify=Math.floor(this.fps/10),this.additionalElem.fpsElem.innerText=`FPS: ${this.fps}`}}))}}class h{constructor(){this.currTime=0,this.targetTime=null,this.interval=1e3,this.duration=null,this.isPaused=!0,this.runner=null,this.type="INC",this.firstDelayDuration=null,this.currDelayTime=0,this.isFirstDelay=!0,this.isPlayAudTimer=!0,this.audStart=new l({src:"./audio/start-from-google-translate.webm"}),this.audDone=new l({src:"./audio/done-from-freesound.webm"}),this.listAudCounts=[new l({src:"./audio/one-from-google-translate.webm"}),new l({src:"./audio/two-from-google-translate.webm"}),new l({src:"./audio/three-from-google-translate.webm"})],this.audStart.setup(),this.audDone.setup(),this.listAudCounts.forEach((e=>{e.setup()}))}setup=e=>{this.interval=e.interval,this.duration=e.duration,this.type=e.type,this.firstDelayDuration=e.firstDelayDuration,this.reset()};reset=()=>{this.isPaused=!1,this.currDelayTime=this.firstDelayDuration,this.targetTime="INC"===this.type?this.duration:0,this.currTime="INC"===this.type?0:this.duration};start=(e,t,s,i)=>{this.reset(),null===this.runner&&null!==this.targetTime&&(this.runner=setInterval((()=>{this.isPaused||(this.isFirstDelay?(this.isPlayAudTimer&&0!==this.currDelayTime&&this.listAudCounts[this.currDelayTime-1].isLoaded&&this.listAudCounts[this.currDelayTime-1].play(),e(this.currDelayTime),0===this.currDelayTime&&(t(),this.isFirstDelay=!1,this.isPaused=!1),this.currDelayTime-=1):(this.isPlayAudTimer&&this.audStart.isLoaded&&Math.abs(this.currTime-this.targetTime)===this.duration&&this.audStart.play(),"INC"===this.type&&(this.currTime+=1),"DEC"===this.type&&(this.currTime-=1),s(this.getCurrTime()),this.currTime===this.targetTime&&(this.isPlayAudTimer&&this.audDone.isLoaded&&this.audDone.play(),i(),this.isPaused=!1,this.remove())))}),this.interval))};resume=()=>{this.isPaused&&(this.isPaused=!1)};pause=()=>{this.isPaused||(this.isPaused=!0)};remove=()=>{clearInterval(this.runner),this.runner=null};getCurrTime=()=>({minutes:Math.floor(this.currTime/60),seconds:this.currTime%60})}class m{constructor(){this.DBWOScore=[],this.isLocalStorageAvailable=null,this.keyData="DBWOScore",this.bestScore={}}setup=e=>{if(this.bestScore={},e.nameWorkout.forEach((t=>{this.bestScore[t]={},e.duration.forEach((e=>{this.bestScore[t][e]=0}))})),"undefined"==typeof localStorage)return this.isLocalStorageAvailable=!1,void alert("Warning! Local storage unavailable. Please use newest browser");this.isLocalStorageAvailable=!0;const t=localStorage.getItem(this.keyData);null!==t?this.DBWOScore=JSON.parse(t):this.saveToLocalStorage()};saveToLocalStorage=()=>{this.isLocalStorageAvailable&&localStorage.setItem(this.keyData,JSON.stringify(this.DBWOScore))};addNewData=e=>{this.DBWOScore.push({id:+new Date,nameWorkout:e.nameWorkout,duration:e.duration,repetition:e.repetition,date:(new Date).toLocaleString()}),this.saveToLocalStorage()};getBestScoreByReps=()=>0===Object.keys(this.bestScore).length?{}:(this.DBWOScore.forEach((e=>{(0===this.bestScore[e.nameWorkout][e.duration]||e.repetition>=this.bestScore[e.nameWorkout][e.duration])&&(this.bestScore[e.nameWorkout][e.duration]=e.repetition)})),this.bestScore)}class g{constructor(){this.DBWOSettings={},this.isGetPrevSettings=!1,this.isLocalStorageAvailable=null,this.keyData="DBWOSettings"}setup=(e,t)=>{if(0!==Object.keys(this.DBWOSettings).length)return;if("undefined"==typeof localStorage)return void alert("Warning! Local storage unavailable. Please use newest browser");this.isLocalStorageAvailable=!0;const s=localStorage.getItem(this.keyData);if(null!==s){const e=JSON.parse(s);"None"!==e.currWorkout&&(this.isGetPrevSettings=!0,this.change(e,t))}else this.DBWOSettings=e,this.saveToLocalStorage()};saveToLocalStorage=()=>{this.isLocalStorageAvailable&&localStorage.setItem(this.keyData,JSON.stringify(this.DBWOSettings))};getEffectChange=(e,t)=>{const s=this.DBWOSettings,i=0===Object.keys(s).length;Object.keys(t).forEach((n=>{"currWorkoutDuration"===n&&(e.currWorkout!==s.currWorkout||e.currDuration!==s.currDuration||i&&this.isGetPrevSettings)?t[n]({nameWO:{isChange:i?e.currWorkout:e.currWorkout!==s.currWorkout,value:e.currWorkout},durationWO:{isChange:i?e.currDuration:e.currDuration!==s.currDuration,value:e.currDuration}}):(i&&this.isGetPrevSettings||e[n]!==s[n])&&t[n](e[n])}))};change=(e,t={})=>{const s={...this.DBWOSettings,...e};this.getEffectChange(s,t),this.DBWOSettings=s,this.saveToLocalStorage()}}var y=s(50835),p=s(25965);let f,x;window.adapter=y.Z,p.Z&&"function"==typeof p.Z.init?(console.log("Attempting to initialize Janus..."),p.Z.init({debug:"all",callback:function(){p.Z.isWebrtcSupported()?f=new p.Z({server:"wss://wss.airehab.sbmi.uth.edu:8989",success:function(){console.log("Connected to Janus"),f.attach({plugin:"janus.plugin.videoroom",success:function(e){x=e,console.log("VideoRoom plugin attached"),x.send({message:{request:"join",room:1234,ptype:"publisher",display:"Demo User"},success:function(e){console.log("Joined the video room!")}})},error:function(e){console.error("Error attaching Video Room plugin:",e)}})},error:function(e){console.error("Janus error:",e)},destroyed:function(){console.log("Janus session destroyed")}}):console.error("No WebRTC support...")}})):console.error("Janus is not initialized or the init method is missing."),document.addEventListener("DOMContentLoaded",(async()=>{let e=document.getElementById("webcamBox");const t=document.getElementById("cnvPoseBox"),s=document.getElementById("parentWebcamBox"),i=document.getElementById("loaderBox"),n=document.getElementById("fpsBox"),o=document.getElementById("countBox"),a=document.getElementById("timerBox"),r=document.getElementById("delayBox"),l=document.getElementById("pauseBtn"),c=document.getElementById("resumeBtn"),d=document.getElementById("accessCamBtn"),y=document.getElementById("chooseWOBox"),p=document.getElementById("formChooseWOBox"),f=document.getElementById("accessCamBox"),b=document.getElementById("titleWOBox"),S=document.getElementById("confidenceBox"),v=document.getElementById("resultBox"),w=document.getElementById("resultRepBox"),E=document.getElementById("resultTitleBox"),B=document.getElementById("resultOKBtn"),D=document.getElementById("uploadVideoBtn"),k=document.getElementById("goWebcamBtn"),C=document.getElementById("settingsBtn"),L=document.getElementById("settingsBox"),_=document.getElementById("saveSettingsBtn"),W=document.getElementById("cancelSettingsBtn"),O=document.getElementById("segSettingsWOBtn"),P=document.getElementById("segSettingsAdvBtn"),T=document.getElementById("bodySettingsWOBox"),M=document.getElementById("bodySettingsAdvBox"),A=document.getElementById("scoresBtn"),I=document.getElementById("scoresBox"),$=document.getElementById("scoresOKBtn"),F=document.getElementById("segJourneyBtn"),V=document.getElementById("segBestBtn"),j=document.getElementById("bodyJourneyBox"),N=document.getElementById("bodyBestScoreBox"),H=document.getElementById("helpBox"),q=document.getElementById("helpBtn"),R=document.getElementById("segHowToUseBtn"),J=document.getElementById("segAboutBtn"),K=document.getElementById("bodyHowToUseBox"),U=document.getElementById("bodyAboutBox"),G=document.getElementById("helpOKBtn"),z=document.getElementById("developerModeBox"),Z=document.getElementById("imgDirectionSignBox"),X=document.getElementById("goAdviceBtn"),Q=document.getElementById("adviceWrapBox"),Y=document.getElementById("sliderAdviceBox"),ee=document.getElementById("sliderCameraBox"),te=document.getElementById("recordKeypointsBtn"),se=document.getElementById("pingRecordBox"),ie=document.getElementById("restartBtn");let ne=!0,oe=!1,ae=640,re=360,le=0,ce=0;const de=new u(e,t),ue=new h,he=new m,me=new g;de.additionalElem={fpsElem:n,countElem:o,adviceWrapElem:Q,confidenceElem:S,imgDirectionSignElem:Z},de.camHandler._addVideoConfig={width:ae,height:re};const ge=()=>{le=window.innerWidth>1280?1280:window.innerWidth,ce=Math.floor(le*(9/16)),ce>window.innerHeight&&(ce=window.innerHeight,le=Math.floor(ce*(16/9))),s.setAttribute("style",`width:${le}px;height:${ce}px`);for(let e=0;e<s.children.length;e+=1){const i=s.children[e];"CANVAS"===i.tagName?(t.width=le,t.height=ce):(i.style.width=`${le}px`,i.style.height=`${ce}px`)}de.scaler={w:le/ae,h:ce/re}};ge(),window.addEventListener("resize",(()=>{ge()}));const ye=(e,t)=>{let s="";return s+=t?'\n      <div class="mb-3">What exercise do you want to practice?</div>\n      ':'\n      <div class="flex-1 overflow-y-auto flex flex-col items-center w-full">\n          <h1 class="font-bold text-2xl mt-3 mb-5">\n            Stroke Rehab Assistant\n          </h1>\n        <div class="relative w-full flex flex-row justify-center items-center">\n          <img\n            src="./img/tb_wheelchair_workout.svg"\n            alt="Ilustration of Workout"\n            class="w-1/2"\n          />\n          <div id="chooseHelpBtn" class="top-0 right-0 bg-yellow-500 text-black font-bold py-1 px-2 rounded-lg cursor-pointer hover:bg-amber-500">Need Help ?</div>\n        </div>\n        <div class="mt-5 mb-3">What exercise do you want to practice?</div>\n      ',e.nameWorkout.forEach(((i,n)=>{0===n&&(s+='<fieldset class="grid grid-cols-2 gap-3 w-full" role="group" aria-labelledby="exercise-name">'),s+=`\n        <label\n          for="${t?`settingsName${n}`:`chooseName${n}`}"\n          class="flex cursor-pointer items-center pl-4 border border-gray-200 rounded-lg"\n        >\n          <input\n            id="${t?`settingsName${n}`:`chooseName${n}`}"\n            type="radio"\n            value="${e.slugWorkout[n]}"\n            name="${t?"settingsNameWO":"chooseNameWO"}"\n            class="w-4 h-4 text-yellow-600"\n            required\n          />\n          <span class="w-full py-4 ml-2 text-sm font-medium text-black"\n            >${i}</span\n          >\n        </label>\n        `,n===e.nameWorkout.length-1&&(s+="</fieldset>")})),s+=`<div class="${t?"mt-3":"mt-5"} mb-3">How long?</div>`,e.duration.forEach(((i,n)=>{0===n&&(s+='<fieldset class="grid grid-cols-2 gap-3 w-full" role="group" aria-labelledby="exercise-duration">'),s+=`\n        <label\n          for="${t?`settingsDuration${n}`:`chooseDuration${n}`}"\n          class="flex cursor-pointer items-center pl-4 border border-gray-200 rounded-lg"\n        >\n          <input\n            id="${t?`settingsDuration${n}`:`chooseDuration${n}`}"\n            type="radio"\n            value="${i}"\n            name="${t?"settingsDurationWO":"chooseDurationWO"}"\n            class="w-4 h-4 text-yellow-600"\n            required\n          />\n          <span class="w-full py-4 ml-2 text-sm font-medium text-black"\n            >${i}</span\n          >\n        </label>\n        `,n===e.duration.length-1&&(s+="</fieldset>")})),s+=t?"":'\n        </div>\n        <button\n          id="submitWOBtn"\n          type="submit"\n          class="w-full bg-yellow-500 text-black py-2 text-xl font-bold rounded-lg mb-2 mt-5 hover:bg-amber-600"\n        >\n          Next\n        </button>\n      ',s},pe=async()=>{!e.paused&&de.isLoop||(i.style.display="flex",await de.camHandler.start().then((()=>{me.change({isAccessCamera:!0}),i.style.display="none",f.style.display="none"})).catch((e=>{console.log("Permission Denied: Webcam Access is Not Granted"),console.error(e),alert("Webcam Access is Not Granted, Try to Refresh Page")})))},fe=()=>{const e=ue.getCurrTime();a.innerHTML=`${`0${e.minutes}`.slice(-2)}:${`0${e.seconds}`.slice(-2)}`},xe=async t=>{await fetch(t).then((e=>{if(!e.ok)throw new Error(`HTTP error${e.status}`);return e.json()})).then((async t=>{de.counter.setup(t.rulesCountConfig);const s=`${t.rulesCountConfig.nameWorkout} - ${me.DBWOSettings.currDuration}`;b.innerText=s,E.innerText=s,ue.remove(),ue.setup({interval:1e3,duration:de.isVideoMode?Math.floor(e.duration):60*+me.DBWOSettings.currDuration.split(" ")[0],type:"DEC",firstDelayDuration:de.isVideoMode?0:3}),ue.isFirstDelay=!de.isVideoMode,fe(),await de.setup(t.poseDetectorConfig).then((()=>{console.log("Detector Loaded")})).catch((e=>{console.error(e)})),await de.classifier.setup(t.classifierConfig,{width:ae,height:re}).then((async()=>{console.log("Classifier Ready to Use"),y.style.display="none",me.DBWOSettings.isAccessCamera?de.isVideoMode||await pe():(i.style.display="none",f.style.display="flex")})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))};q.addEventListener("click",(()=>{H.style.display="flex"})),G.addEventListener("click",(()=>{H.style.display="none"})),R.addEventListener("click",(()=>{"none"===K.style.display&&(U.style.display="none",K.style.display="flex",J.classList.remove("bg-amber-300","text-black"),J.classList.add("bg-amber-200","text-black"),R.classList.remove("bg-amber-200","text-black"),R.classList.add("bg-amber-300","text-black"))})),J.addEventListener("click",(()=>{"none"===U.style.display&&(K.style.display="none",U.style.display="flex",R.classList.remove("bg-amber-300","text-black"),R.classList.add("bg-amber-200","text-black"),J.classList.remove("bg-amber-200","text-black"),J.classList.add("bg-amber-300","text-black"))})),ie.addEventListener("click",(()=>{i.style.display="flex",r.innerText="",ue.setup({interval:1e3,duration:de.isVideoMode?Math.floor(e.duration):60*+me.DBWOSettings.currDuration.split(" ")[0],type:"DEC",firstDelayDuration:de.isVideoMode?0:3}),de.counter.resetCount(),o.innerText="0",ue.isFirstDelay=!de.isVideoMode,de.isVideoMode&&0!==e.currentTime&&(e.currentTime=0,e.load()),fe(),ue.pause(),e.pause(),de.isLoop=!1,ne=!0,oe=!0,de.counter.lastStage={},de.counter.nextStage={},Z.style.display="none",Q.style.display="none",c.style.display="flex",ie.style.display="none",l.style.display="none",i.style.display="none"})),te.addEventListener("click",(()=>{de.isExtractKeypoints=!de.isExtractKeypoints,de.isExtractKeypoints?(se.classList.remove("bg-gray-500"),se.classList.add("bg-red-500"),se.children[0].style.display="block"):(se.classList.remove("bg-red-500"),se.classList.add("bg-gray-500"),se.children[0].style.display="none",de.DBHandler.saveToCSV())})),A.addEventListener("click",(()=>{let e="",t="";const s=he.getBestScoreByReps();Object.keys(s).forEach((e=>{t+=`\n        <div class="mb-3 text-black font-bold border-t-2 pt-1">\n          ${e}\n        </div>\n      `,Object.keys(s[e]).forEach(((i,n)=>{0===n&&(t+='\n            <div class="mb-3 grid grid-cols-2 gap-3 w-full">\n          '),t+=`\n          <div\n            class="flex flex-col w-full bg-white rounded-lg overflow-hidden shadow-sm"\n          >\n            <div\n              class="p-1 bg-yellow-500 text-center font-medium text-sm text-black"\n            >\n              ${i}\n            </div>\n            <div class="p-1 text-center text-black font-medium text-lg">\n              ${s[e][i]}<span class="text-xs"> Reps</span>\n            </div>\n          </div>\n        `,n===Object.keys(s[e]).length-1&&(t+="\n            </div>\n          ")}))})),0===he.DBWOScore.length&&(e+='\n      <div class="flex flex-row w-full h-full justify-center items-center">\n        <div class="flex flex-col items-center">\n          <img\n            src="./img/undraw_void_-3-ggu.svg"\n            alt="Ilustration of Void"\n            class="w-1/2"\n          />\n          <div class="p-3 text-sm text-black text-center">There are no Journey Scores. Let\'s do Workout to change that!</div>\n        </div>\n      </div>\n      '),[...he.DBWOScore].sort(((e,t)=>t.id-e.id)).forEach((t=>{e+=`\n        <div\n          class="mb-3 w-full border-t-2 border-yellow-200 bg-white flex flex-row justify justify-between px-3 py-1.5"\n        >\n          <div class="flex flex-col items-start justify-between">\n            <div class="flex flex-row items-center">\n              <div class="text-md text-black font-semibold mr-2">\n                ${t.nameWorkout}\n              </div>\n              <div\n                class="text-xs px-1 py-0.5 bg-gray-200 rounded-lg text-black font-semibold"\n              >\n                ${t.duration}\n              </div>\n            </div>\n            <div class="text-xs">${t.date}</div>\n          </div>\n          <div class="flex flex-col items-center justify-between">\n            <div class="text-xl font-semibold text-black">${t.repetition}</div>\n            <div class="text-xs">Reps</div>\n          </div>\n        </div>\n      `})),j.innerHTML=e,N.innerHTML=t,I.style.display="flex"})),$.addEventListener("click",(()=>{I.style.display="none"})),F.addEventListener("click",(()=>{"none"===j.style.display&&(N.style.display="none",j.style.display="block",V.classList.remove("bg-amber-300","text-gray-600"),V.classList.add("bg-amber-200","text-gray-400"),F.classList.remove("bg-amber-200","text-gray-400"),F.classList.add("bg-amber-300","text-gray-600"))})),V.addEventListener("click",(()=>{"none"===N.style.display&&(j.style.display="none",N.style.display="block",F.classList.remove("bg-amber-300","text-gray-600"),F.classList.add("bg-amber-200","text-gray-400"),V.classList.remove("bg-amber-200","text-gray-400"),V.classList.add("bg-amber-300","text-gray-600"))})),O.addEventListener("click",(()=>{"none"===T.style.display&&(M.style.display="none",T.style.display="block",P.classList.remove("bg-amber-300","text-gray-600"),P.classList.add("bg-amber-200","text-gray-400"),O.classList.remove("bg-amber-200","text-gray-400"),O.classList.add("bg-amber-300","text-gray-600"))})),P.addEventListener("click",(()=>{"none"===M.style.display&&(T.style.display="none",M.style.display="block",O.classList.remove("bg-amber-300","text-gray-600"),O.classList.add("bg-amber-200","text-gray-400"),P.classList.remove("bg-amber-200","text-gray-400"),P.classList.add("bg-amber-300","text-gray-600"))})),C.addEventListener("click",(()=>{L.style.display="flex",document.querySelector(`input[value="${me.DBWOSettings.currWorkout}"][name="settingsNameWO"]`).checked=!0,document.querySelector(`input[value="${me.DBWOSettings.currDuration}"][name="settingsDurationWO"]`).checked=!0,document.querySelector('input[name="settingsAEBox"]').checked=void 0===me.DBWOSettings.isAudioEffect||me.DBWOSettings.isAudioEffect,document.querySelector('input[name="settingsFSBox"]').checked=void 0!==me.DBWOSettings.isFullscreen&&me.DBWOSettings.isFullscreen,document.querySelector('input[name="settingsFCBox"]').checked=void 0!==me.DBWOSettings.isFlipCamera&&me.DBWOSettings.isFlipCamera,document.querySelector('input[name="settingsDSBox"]').checked=void 0===me.DBWOSettings.isDirectionSign||me.DBWOSettings.isDirectionSign,document.querySelector('input[name="settingsDMBox"]').checked=void 0!==me.DBWOSettings.isDeveloperMode&&me.DBWOSettings.isDeveloperMode}));const be={currWorkoutDuration:async t=>{if(i.style.display="flex",r.innerText="",e.pause(),de.isLoop=!1,ne=!0,oe=!0,de.counter.lastStage={},de.counter.nextStage={},t.durationWO.isChange){ue.setup({interval:1e3,duration:de.isVideoMode?Math.floor(e.duration):60*+t.durationWO.value.split(" ")[0],type:"DEC",firstDelayDuration:de.isVideoMode?0:3}),fe();const s=`${de.counter.rules.nameWorkout} - ${t.durationWO.value}`;b.innerText=s,E.innerText=s}t.nameWO.isChange&&await xe(`./rules/${t.nameWO.value}.json`),ue.isFirstDelay=!de.isVideoMode,de.isVideoMode&&0!==e.currentTime&&(e.currentTime=0,e.load()),ue.pause(),Z.style.display="none",Q.style.display="none",c.style.display="flex",ie.style.display="none",l.style.display="none",i.style.display="none"},isAudioEffect:e=>{de.counter.isPlayAudStage=e,ue.isPlayAudTimer=e},isFullscreen:e=>{e&&!document.fullscreenElement?document.documentElement.requestFullscreen():!e&&document.exitFullscreen&&document.fullscreenElement&&document.exitFullscreen()},isFlipCamera:e=>{const t=e?"environment":"user";de.camHandler.flip(t)},isDirectionSign:e=>{de.isShowDirectionSign=e,de.isClassify&&(Z.style.display=e?"block":"none")},isDeveloperMode:e=>{z.style.display=e?"flex":"none"}};_.addEventListener("click",(()=>{const e=document.querySelector('input[name="settingsNameWO"]:checked').value,t=document.querySelector('input[name="settingsDurationWO"]:checked').value,s=document.querySelector('input[name="settingsAEBox"]').checked,i=document.querySelector('input[name="settingsFSBox"]').checked,n=document.querySelector('input[name="settingsFCBox"]').checked,o=document.querySelector('input[name="settingsDSBox"]').checked,a=document.querySelector('input[name="settingsDMBox"]').checked;me.change({currWorkout:e,currDuration:t,isAudioEffect:s,isFullscreen:i,isFlipCamera:n,isDirectionSign:o,isDeveloperMode:a},be),L.style.display="none"})),W.addEventListener("click",(()=>{L.style.display="none"})),await(async e=>{await fetch("./mock-data/workout.json").then((e=>{if(!e.ok)throw new Error(`HTTP error${e.status}`);return e.json()})).then((async e=>{p.innerHTML=ye(e,!1),T.innerHTML=ye(e,!0),document.getElementById("chooseHelpBtn").addEventListener("click",(()=>{H.style.display="flex"})),he.setup(e),me.setup(e.settingsConfig,{isFlipCamera:be.isFlipCamera,isDeveloperMode:be.isDeveloperMode}),me.isGetPrevSettings&&me.DBWOSettings.currWorkout&&"None"!==me.DBWOSettings.currWorkout?(i.style.display="flex",await xe(`./rules/${me.DBWOSettings.currWorkout}.json`)):(y.style.display="flex",i.style.display="none")})).catch((e=>{console.error(e)}))})(),e.addEventListener("loadeddata",(()=>{de.isVideoMode||(de.isClassify&&(de.isClassify=!1),de.isLoop=!0,ee.checked=!0,oe&&(oe=!1),r.innerText="",ue.pause(),de.counter.resetCount(),de.drawPose())})),d.addEventListener("click",(async()=>{await pe()})),p.addEventListener("submit",(async e=>{e.preventDefault();const t=document.querySelector('input[name="chooseNameWO"]:checked').value,s=document.querySelector('input[name="chooseDurationWO"]:checked').value;"submitWOBtn"===e.submitter.id&&(me.change({currWorkout:t,currDuration:s}),y.style.display="flex",i.style.display="flex",await xe(`./rules/${t}.json`))}));const Se=e=>{r.innerText=e},ve=()=>{r.innerText=""},we=e=>{a.innerText=`${`0${e.minutes}`.slice(-2)}:${`0${e.seconds}`.slice(-2)}`},Ee=()=>{de.isVideoMode||he.addNewData({id:+new Date,nameWorkout:de.counter.rules.nameWorkout,duration:me.DBWOSettings.currDuration,repetition:de.counter.count,date:(new Date).toLocaleString()}),fe(),ue.isFirstDelay=!de.isVideoMode,w.innerText=de.counter.count,ue.start(Se,ve,we,Ee),ue.pause(),e.pause(),ne=!0,de.isLoop=!1,de.counter.resetCount(),de.counter.lastStage={},de.counter.nextStage={},v.style.display="flex",c.style.display="flex",ie.style.display="none",l.style.display="none",Z.style.display="none",Q.style.display="none"};B.addEventListener("click",(()=>{v.style.display="none",ne&&de.isVideoMode?(e.pause(),e.currentTime=0,e.load()):(ue.reset(),fe())})),l.addEventListener("click",(()=>{ue.pause(),e.pause(),de.isLoop=!1,c.style.display="flex",ie.style.display="flex",l.style.display="none",x?x.send({message:{request:"unpublish"},success:function(e){console.log("Stream paused successfully!")},error:function(e){console.error("Error pausing the stream:",e)}}):console.error("Janus VideoRoom handle not available.")})),c.addEventListener("click",(()=>{if(!ne&&!e.paused&&de.isLoop)return;l.style.display="flex",ie.style.display="none",c.style.display="none";const t=ne;ne&&(ne=!1,de.isClassify=!0,ue.start(Se,ve,we,Ee)),ue.resume(),de.isLoop=!0,e.play().then((()=>{if(!oe&&t&&!de.isVideoMode)return console.log("It run?"),void(oe=!0);de.drawPose()})),x?(navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((e=>{x.createOffer({media:{audioSend:!0,videoSend:!0},stream:e,success:function(e){x.send({message:{request:"publish",audio:!0,video:!0},jsep:e})},error:function(e){console.error("WebRTC error:",e)}})})).catch((e=>{console.error("Could not get user media",e)})),x.onmessage=function(e,t){t&&x.handleRemoteJsep({jsep:t})}):console.error("Janus VideoRoom handle not available.")})),D.addEventListener("change",(t=>{if(t.target.files&&t.target.files[0]){de.camHandler.stop(),de.isClassify=!0,de.isLoop=!1,de.isVideoMode=!0,e.pause(),e.remove();const i=document.createElement("video");i.setAttribute("id","webcamBox"),i.setAttribute("class","bg-gray-200 z-10"),i.setAttribute("style",`width: ${le}px; height: ${ce}px`),i.muted=!0,s.insertBefore(i,s.firstChild),i.setAttribute("src",URL.createObjectURL(t.target.files[0])),i.load(),i.play(),me.change({isFlipCamera:!0},{isFlipCamera:be.isFlipCamera}),i.addEventListener("loadeddata",(()=>{de.isVideoMode&&(e=i,de.webcamElem=i,de.camHandler._webcamElement=i),de.counter.resetCount(),o.innerText="0",r.innerText="",ue.setup({interval:1e3,duration:de.isVideoMode?Math.floor(e.duration):60*+me.DBWOSettings.currDuration.split(" ")[0],type:"DEC",firstDelayDuration:de.isVideoMode?0:3}),ue.isFirstDelay=!de.isVideoMode,ue.pause(),fe(),e.pause(),de.counter.lastStage={},de.counter.nextStage={},0!==ae&&de.isVideoMode&&(re=i.videoHeight,ae=i.videoWidth),de.scaler={w:le/ae,h:ce/re},de.classifier.stdConfig={width:ae,height:re},c.style.display="flex",ie.style.display="none",l.style.display="none",Z.style.display="none",Q.style.display="none",ee.checked=!de.isVideoMode}))}})),X.addEventListener("click",(e=>{e.preventDefault(),de.isShowAdvice=!de.isShowAdvice,Y.checked=de.isShowAdvice,de.isClassify&&(Q.style.display=de.isShowAdvice?"flex":"none")})),k.addEventListener("click",(async e=>{e.preventDefault(),de.isVideoMode&&(ae=640,re=360,de.camHandler._addVideoConfig={width:ae,height:re},de.classifier.stdConfig={width:ae,height:re},de.isLoop=!1,oe=!0,ee.checked=!0,de.isVideoMode=!1,await de.camHandler.start())})),console.log("Hello World!")}))},75410:()=>{},48628:()=>{},75042:()=>{}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=t,i.amdD=function(){throw new Error("define cannot be used indirect")},i.amdO={},e=[],i.O=(t,s,n,o)=>{if(!s){var a=1/0;for(d=0;d<e.length;d++){for(var[s,n,o]=e[d],r=!0,l=0;l<s.length;l++)(!1&o||a>=o)&&Object.keys(i.O).every((e=>i.O[e](s[l])))?s.splice(l--,1):(r=!1,o<a&&(a=o));if(r){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,n,o]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={826:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,o,[a,r,l]=s,c=0;if(a.some((t=>0!==e[t]))){for(n in r)i.o(r,n)&&(i.m[n]=r[n]);if(l)var d=l(i)}for(t&&t(s);c<a.length;c++)o=a[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},s=self.webpackChunkai_workout_assistant=self.webpackChunkai_workout_assistant||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var n=i.O(void 0,[470,50,887,985,370,320,306,858,482],(()=>i(17512)));n=i.O(n)})();